
# 美团O2O广告营销中的机器学习技术 - 喜欢打酱油的老鸟 - CSDN博客


2018年08月18日 10:32:30[喜欢打酱油的老鸟](https://me.csdn.net/weixin_42137700)阅读数：223


[http://blog.itpub.net/31077337/viewspace-2200247/](http://blog.itpub.net/31077337/viewspace-2200247/)
AI（人工智能）技术已经广泛应用于美团的众多业务，从美团App到大众点评App，从外卖到打车出行，从旅游到婚庆亲子，美团数百名最优秀的算法工程师正致力于将AI技术应用于搜索、推荐、广告、风控、智能调度、语音识别、机器人、无人配送等多个领域，帮助美团数亿消费者和数百万商户改善服务和体验，帮大家吃得更好，生活更好。
基于AI技术，美团搭建了世界上规模最大，复杂度最高的多人、多点实时智能配送调度系统；基于AI技术，美团推出了业内第一款大规模落地的企业应用级语音交互产品，为50万骑手配备了智能语音系统；基于AI技术，美团构建了世界上最大的菜品知识库，为200多万商家、3亿多件商品绘制了知识图谱，为数亿用户提供了精准的用户画像，并构建了世界上用户规模最大、复杂度最高的O2O智能推荐平台。
美团这个全球最大生活服务互联网平台的“大脑”是怎么构建的？我们已经连续发表数篇“AI in 美团”系列文章，希望给大家全面揭开各项技术的内幕（文末附有链接）。
另外，业界第一部全面讲述互联网机器学习实践的图书《美团机器学习实践》也即将上市，敬请期待，本文选自书中第十一章。
美团作为国内最大的在线本地生活服务平台，覆盖了餐饮、酒店、旅行、休闲娱乐、外卖配送等方方面面生活场景，连接了数亿用户和数百万商户。如何帮助本地商户开展在线营销，使得他们能快速有效地触达目标用户群体提升经营效率，是美团的核心问题之一，而机器学习相关技术在本地在线营销场景下发挥着非常关键作用。
本文将从5个方面来介绍。首先，介绍O2O场景下广告业务的特点，及其与B2B和B2C广告业务的差别；其次，从商户效果感知、用户体验和媒体平台收益三个维度，介绍O2O广告业务的最重要的考量指标；第三，从前两节阐述的业务特点和考量指标出发，介绍O2O场景下在线广告营销的机制设计；第四，介绍O2O特有的实时场景化下的推送广告；最后，简要介绍O2O广告系统相关的工具。
**O2O场景下的广告业务特点**
在O2O业务模式和相关的平台崛起之前，大品牌的商家由于收入规模大、营销费用充分，为了提升品牌知名度依靠如下的途径开展宣传：传统媒体（如电视、广播、报纸）；互联网流量（如传统搜索引擎、门户网站等）；户外广告（如公交地铁车身、广告牌、灯箱等）。通过上述媒介，商户能快速接触大量的用户，宣传品牌的形象。上述营销方式也有其局限。首先广告投放的资金门槛较高，营销预算有限的商户无法承担相关费用；其次对于以直接效果为导向的商家来说，上述投放形式过于粗放且无法形成直接的购买转化效果闭环。
对于大多数的中小商家来说，他们营销预算有限且更加注重直接的购买转化，获取潜在客户的主要途径是散发传单、派发礼物、沿街喇叭广告。但是，这些线下的营销手段覆盖到的潜在消费者较为有限，并且这些方式无法长期持续开展。
以美团为代表的O2O本地生活服务平台快速成长壮大，逐渐成为广大本地服务商户在线营销的最重要的手段之一。美团平台上聚集了上亿的消费者，他们使用平台寻找商家、查询优惠信息、浏览评论。对于商户而言，他们是最直接的潜在消费者。通过在美团平台开展在线营销，商户能够获得更多的展示机会吸引更多客户到店消费。借助于便利的在线咨询、预定和支付手段，平台上的广告业务可以形成了效果闭环，商户能清晰准确掌握广告投放的效果并以此优化广告投放策略。
对于美团而言，平台可以基于对用户大数据的挖掘和分析，在由时间、地点、用户和关系构成的特定场景下，连接用户线上和线下行为，理解并判断用户情感、态度和需求，为用户提供实时、定向、创意的信息和内容服务。
O2O场景下的在线营销广告相较于传统的B2C和B2B商业模式下的广告有其独特属性，独特性主要体现在移动化、本地化、场景化以及多样性4个维度。
随着宽带无线接入技术和移动终端技术的飞速发展，人们逐渐开始使用手机等移动设备随时随地从互联网上获取信息和服务。在这个时代，无论是新闻阅读、社交通信还是电子购物，人们都习惯于通过手机应用来直接满足自身的需求。事实上，美团在移动互联网发展的初期就主动适应了这一历史潮流，大力发展移动服务能力，目前已经有超过90%的交易行为是通过移动互联网服务达成的。O2O广告作为连接人和服务的本地化生活服务营销模式，它有鲜明的移动化和本地化的特点。
移动化。它主要体现在精确性、即时性和互动性三个方面。通过移动设备的传感器，我们能精确了解用户所处的地理位置，推送更加精准的广告。绝大多数用户随时都把手机带在身边，所以广告信息能及时推送给用户。功能强大的各种移动应用，为广告提供了多种互动可能性，例如在美团App上，用户直接可以完成推广商户的信息查询、排队和交易。
本地化。以转化效果为导向的O2O广告营销，营销的目标用户是提供服务的本地商户附近的人群。在淘宝上，一双皮鞋可以对全国的用户开展推广和售卖，无论消费者在何地，物流和快递都会准确地把货物送达到消费者的手上。而在美团上，一家在五道口的火锅店最佳的推广对象是五道口附近的食客，这些食客才最有可能直接到火锅店来消费。实际上，通过观测实际的交易数据，我们发现超过90%的交易中用户和商户的距离小于3公里。营销活动要取得好的效果，必须针对性地选择目标群体，在O2O广告中目标群体就是本地化的用户人群。移动设备的精确定位为商户发现目标人群提供了保证。
场景化。消费者、移动设备、时间、空间构成了用户消费需求的精准场景。PC时代，用户的标识以Cookie为载体，但Cookie极易清除，同时一台电脑可能会被多人使用，这导致用户信息很难有效串联，连受众年龄、居住地等基础信息都无法准确把握。而在移动互联网时代一机一人的模式下，通过分析和挖掘用户在平台上留下的各种行为足迹，我们能对用户方方面面的属性和偏好进行解析和重构，产出十分精准的用户画像。在了解用户的地理位置、消费意图和行为轨迹等用户信息前提下，O2O广告营销能在由时间、地点、用户和需求构成的特定场景下，为用户提供实时、定向和富有创意的营销内容，连接用户线上和线下的行为。例如在一个阳光明媚的下午，对一个在CBD上班并有喝下午茶习惯的白领，平台可以适时地推送下午茶或者咖啡店商户。
多样性。O2O商业模式面对的是各式各样的本地生活服务业务，不同的业务有着不同的特点，并对O2O广告营销也提出了不同的需求。举个简单的例子，不同的服务业务对目标用户的本地性要求也大相径庭：餐饮类服务对距离比较敏感，这一类服务商家的目标用户群体是商户周边的食客；婚纱摄影类服务对距离就没那么敏感了，这一类服务商家的目标群体是全城的新婚夫妇。
**商户、用户和平台三者利益平衡**
广告系统和搜索系统、推荐系统，有着十分相似的系统架构：它们大都采用了检索加排序的流程体系。基于这一点，有很多人认为广告业务和搜索推荐业务没有区别。实际上，广告业务有其独特规律。广告首先是一项商业活动，它的出现远远早于互联网。作为一种商业活动，商户、消费者和媒体平台三者的利益都要被重视和考虑，这些利益指标是广告业务得以可持续健康发展的启明灯。本节将从商业活动的角度出发，分析美团O2O广告营销中的商户效果感知、用户体验和平台收益这三项重要指标。
**商户效果感知**
商户在美团广告平台上进行广告营销的根本目的，是通过美团触达更多的潜在消费者，获得最大的增量利益。
本地生活服务类型的商家的成本可以分为两个部分：变动成本和固定成本。变动成本是随着业务量变动而线性变动的成本，主要来自原料消耗。而固定成本是在一定时期内是不会随着业务量的改变而改变的成本，如门面装修的投入、店铺的租金、店铺服务人员的基本工资等。商户如果没有足够的业务量，不能招揽足够多的消费者，则单位业务量的成本会居高不下，导致严重亏损。因此，对于餐饮行业，商家的首要目标是提升翻桌率、减小空座率，而对于酒店行业，商家的首要目标是提升满房率、减少空房情况。固定成本的存在是本地商户开展O2O广告营销的基本前提。
从商户的角度出发，O2O广告营销的效果可以从三个维度来衡量：广告的可见性、广告带来的线上增量收益和广告带来的整体增量收益。
对于商户来说，可见性是最初步且最直接的营销结果，是商户得到的最快的效果反馈。广告的可见性表示商户的营销信息已经开始通过媒体平台去触达潜在的消费群体。因此，稳定可靠的广告展现预期是赢得广大商户对O2O广告营销信任的最基础要求。
广告带来的线上增量收益是指通过在美团等媒体平台上的广告投放带来的线上收益。这一部分收益可以分为两类：一类是直接的在线订单带来的收入，例如团购、酒店预订等；另一类则是在线预约等非直接交易带来的收益。对这一部分收益，平台方能给出准确的统计、分析并反馈给广告商户。对于外卖、婚纱摄影和酒店旅游等对线上流量、线上交易依附度很高的行业来说，它们的线上收益占整体收益的比例非常大，这个比例直接反映了商户的经营活动的状况。
除了直接使用在线交易，用户使用美团的另一种场景是通过平台查看商户菜品、评价和地理位置等信息，然后直接到店进行消费。广告给商户带来的整体增量收益即包含了这部分离线客户引流带来的收益。餐饮类的商户的线上交易只占门店整体收益的一小部分，因此，对广告效果的衡量需要综合考虑在线和离线两部分收益。离线引流部分收益相对于在线交易收益较难准确统计，但是平台可以通过用户的实时地理位置准确统计部分用户的到店情况，或者通过曝光、点击至到店的数据漏斗模型对到店数据进行估计。未来随着电子化支付方式的普及，平台将能更好地对商户的整体收益进行统计。
了解了O2O广告营销效果的主要衡量指标后，要确定商户的广告投放成本是否真的较低，需要用到投入产出比（Return over Investment，ROI）这一常用的评价指标，即某次广告活动的总产出与总投入的比例。对应于两种广告收益指标，ROI也可以分为在线支付ROI和整体ROI：在线支付ROI等于在线增量交易额除以广告费消耗，整体支付ROI等于整体门店收入增量除以广告费消耗。在广告费预算有限的情况下，商户总是寻求优化广告投放，提升ROI。
**用户体验**
有效地保障用户体验，是美团开展O2O广告营销的基本前提条件。平台只有保障用户体验、对用户有用，它的价值才能得到体现。美团通过让更多的用户留存并活跃在平台上，才能吸引更多的本地生活服务商户来进行广告投放，才能生成更大的流量用以广告变现。
美团主要从短期和长期两个维度来进行用户体验指标的设计和度量。从信息曝光、用户点击和用户交易这个用户行为漏斗出发，短期用户体验指标主要考虑了点击和交易情况。第一个短期用户体验指标是点击率（Click through Rate，CTR），其数学表达为点击次数（Click）除以曝光次数（Impression）。
点击率反映了给用户展示的商户信息的质量和相关性，与用户意向无关的、与用户所处时间地点场景不匹配的广告信息展示，不能满足用户的需求、吸引用户的点击，从而导致较低的点击率。点击率这一指标又细分为广告曝光的点击率和整体页面的点击率，前者度量了广告本身的优劣，后者反映了广告对整体信息呈现效果（自然结果加广告结果）的影响。劣质的广告除自身点击率较低之外，还会搅扰用户整体浏览行为，使得用户不能愉悦获取需要的本地生活服务信息。
**CTR=点击次数/曝光次数**
为了获得真实的曝光，一般会在移动端进行埋点监控每个POI在手机屏幕上实际展现的比例和时间，将超过一定展示比例和时间阈值的POI纳入曝光次数的统计。
第二个短期用户体验指标是转化率（Conversion Rate，CVR），其数学表达为交易次数（Order）除以点击次数（Click）。转化率同样反映了商户信息展示的相关性和质量，和用户需求不相匹配的商户展示将不能促成交易的达成，从而导致较低的转化率。和点击率指标类似，转化率指标亦可分为广告转化率和整体页面转化率。其中广告转化率还和商户的在线交易ROI成正比，准确有效的广告投放，不仅可以提升用户体验，还能提升商户的ROI。
**CVR = 交易次数/点击次数**
长期用户体验指标以更长的时间跨度为出发点，评价广告对用户的长期持续影响。长期用户体验指标主要包括回访率和复购率两个指标。回访率是一个反映用户长期留存的指标，其意义为一定时期内用户是否还会重新登录和使用美团平台。回访率指标包括周回访率、月回访率等。
低质量的广告投放，搅扰了用户使用平台方便获取商户信息的感受和体验，使得用户脱离平台以致流失，从而导致回访率降低。复购率则反映了用户消费体验的指标，其意义是一定时期内用户是否会重新购买某一个商家的服务。同样，低质量的商户服务会损害了用户的消费体验，使得用户不再进行同样的消费，进而导致了复购率的下降。
为了准确衡量广告投放带来的用户体验影响，除了进行策略变更对比测试之外，平台会长期保留一小部分流量作为对照组，不对这部分用户开展广告投放，通过比较整体流量和对照组上相关用户体验指标的差异，来确定广告对用户体验的长期影响，进而督促和指导平台优化广告投放策略。
**平台收益**
美团作为媒体平台的目标是，在保障商户ROI和用户体验的情况下，优化流量变现效率，实现商户营销诉求和用户消费诉求的最佳连接。
前两节已经介绍了商户ROI和用户体验的基本概念。我们知道只有保障商户的ROI，才会有更多的商户、更多的预算进入到广告投放系统内；只有保障用户的体验，才会有更多的用户、更多的流量用于广告变现。这两者决定了广告业务这一块奶酪的大小。
流量变现效率衡量单位流量所能带来广告收益。对于展示广告业务，流量变现效率主要用千次广告展示收益（Revenue per Mille，RPM）来表示。对于搜索广告，流量变现效率主要用单次搜索广告收益（Revenue per Search，RPS）来表示。
**广告收入=曝光次数×CTR×CPC**
**广告收入=广告主数×ARPU**
从流量供给端来看，广告收入（Revenue）是广告曝光次数、点击率和点击单价（CPC）的乘积；从流量需求端来看，广告收入是广告主数量和每用户平均收入（Average Revenue Per User，ARPU）的乘积。在广告商户数、预算和流量情况稳定的前提条件下，流量变现效率的提高主要通过点击率和点击单价两个关键指标驱动，而这两个指标的良性提高依赖于广告投放的机制设计和投放算法，详细内容将在下文展开陈述。
**O2O广告机制设计**
前面介绍了美团O2O广告营销的特点，分析了商户、用户和平台三者的利益情况。本节将从上述特点和利益情况出发，阐述美团实际业务中O2O广告机制的设计原理，包括广告位设定、广告召回机制和广告排序机制。
**广告位设定**
在移动端，美团的自然结果以列表的样式进行信息呈现，而广告占用列表中的固定位置（区间浮动固定位置）进行展现。从商户的效果感知角度出发，固定位广告形式能给商户以较为确定的广告展现预期，使得商户有明确的竞价标的（即固定展现位置）。
广告位的设定，需要综合考虑和平衡商户、用户和平台三者的利益关系。过于密集的广告位置设计和广告展现会降低用户寻找商户信息的效率，影响用户使用体验。过于稀疏的广告位置设计导致广告展现机会过少，导致平台流量变现效率能力不足。头部广告位对用户体验影响较大，但是能获取更多的曝光，更有价值，更能激发商户的出价意愿。腰尾部广告位对用户体验影响较小，但是广告位曝光概率小，不能有效刺激商户出价。
美团的实际广告位设定，一方面考虑了各个展位和业务的自身特点，另一方面通过A/B测试进行多种方案的比较和选择，最终选择能有效兼顾用户体验、商户效果和平台收入的设计方案。
**广告召回机制**
广告召回在技术上与搜索和推荐十分相似。搜索场景广告会使用用户的查询词去广告商户索引中去寻找匹配的商户，推荐场景广告会根据用户的意图、位置等场景信息去匹配合适的商户。
搜索广告匹配中，一项重要技术是查询改写。一方面，我们使用传统的自然语言处理方法，对查询进行有效分析（例如成分分析），完成同义和近义改写；另一方面，我们使用深度语义相似度神经网络模型（DSSM）和序列到序列模型（Sequence to Sequence）进行查询的改写，进一步提升广告匹配的覆盖率和准确性。
针对O2O商业模式的特点和广告业务各方的利益，广告召回机制在传统搜索推荐召回机制基础上进行了优化改进。我们在召回中引入了逐层召回的理念，各层依次设置由紧到松的相关性水准（Match Level）控制召回广告的质量，在当前相关性水准已经召回足够数量广告候选的情况下，不再进行后续召回。
相关性水准考虑多种相关性因素：查询匹配模式、距离和星级等。例如针对Query匹配模式，广告召回时会优先使用Query精确匹配模式召回，其次选择模糊匹配模式，最后才尝试采用语义匹配模式。针对距离因素，广告召回会优先召回距离3公里内的商户，其次选择5公里内的商户，最后尝试全城召回。
相关性水准的设置应该充分考虑到不同O2O业务的特点。例如距离的设置上，对于餐饮类流量，系统会优先召回3公里内的商户，而对于距离相对不敏感的婚纱摄影类流量，系统则会放宽限制，优先召回10公里内的商户，或者直接采用全城召回策略。
**广告排序机制**
和传统的搜索广告业务一样，美团的广告是按点击计费（Cost Per Click，CPC）广告，广告主依据广告的点击价值进行出价（bid），广告系统按照RankScore（RankScore为出价和广告质量度的乘积）进行广告排序。在广告系统中，广告质量度一般用广告的预估点击率来衡量。
**RankScore=bid×CTR**
广告按照RankScore排序后，会依据广义第二价格（Generalized Second Price）进行计费。
![](http://img.blog.itpub.net/blog/2018/08/17/5b4de62aa8cea204.jpeg?x-oss-process=style/bb)
由此可知，准确的预测广告的点击率是保障广告收入和用户体验的前提。广告点击率预估问题是一个典型的监督机器学习问题，它的目标是在给定广告商户、用户和查询上下文的前提下准确预测点击行为发生的概率。这个监督学习问题的特征我们用x表示，目标用y∈{1，-1}表示（广告曝光后获得点击为1，否则为-1）。通过收集线上的广告曝光和点击日志，我们可以获得大量的标注样本{（

