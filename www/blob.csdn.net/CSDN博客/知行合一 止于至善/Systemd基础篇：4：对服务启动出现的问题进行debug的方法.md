
# Systemd基础篇：4：对服务启动出现的问题进行debug的方法 - 知行合一 止于至善 - CSDN博客

2019年04月09日 05:11:53[liumiaocn](https://me.csdn.net/liumiaocn)阅读数：72


![在这里插入图片描述](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
Systemd被诟病的很多的点之一就是出现问题之后很难确认原因，其实在很早的时候systemd就提供了debug的方法，这篇文章介绍常用的一种方式，并结合一个常见的很容易忽视的问题来进行说明。
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 场景
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
> workingdirectory事前不存在，但是status提示信息过少，journalctl没有有益信息提示，详细可参看下述文章：
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)[https://liumiaocn.blog.csdn.net/article/details/88860759](https://liumiaocn.blog.csdn.net/article/details/88860759)
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 设定方式
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)使用如下方式可以在CentOS7上得到验证可以对服务启动进行debug，与其说debug，更准确地说是打出相关的日志信息以进行辅助。
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## Step 1: 设定system.conf
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
> 对象文件：/etc/systemd/system.conf
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)修改内容：设定LogLevel
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
> LogLevel=debug
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)设定例
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@liumiaocn systemd
```
```python
]
```
```python
# cat system
```
```python
.
```
```python
conf
#  This file is part
```
```python
of
```
```python
systemd
```
```python
.
```
```python
#
#  systemd is free software
```
```python
;
```
```python
you can redistribute it and
```
```python
/
```
```python
or modify it
#  under the terms
```
```python
of
```
```python
the
```
```python
GNU
```
```python
Lesser General Public License
```
```python
as
```
```python
published by
#  the Free Software Foundation
```
```python
;
```
```python
either version
```
```python
2.1
```
```python
of
```
```python
the License
```
```python
,
```
```python
or
#
```
```python
(
```
```python
at your option
```
```python
)
```
```python
any later version
```
```python
.
```
```python
#
# Entries
```
```python
in
```
```python
this
```
```python
file show the compile time defaults
```
```python
.
```
```python
# You can change settings by editing
```
```python
this
```
```python
file
```
```python
.
```
```python
# Defaults can be restored by simply deleting
```
```python
this
```
```python
file
```
```python
.
```
```python
#
# See systemd
```
```python
-
```
```python
system
```
```python
.
```
```python
conf
```
```python
(
```
```python
5
```
```python
)
```
```python
for
```
```python
details
```
```python
.
```
```python
[
```
```python
Manager
```
```python
]
```
```python
LogLevel
```
```python
=
```
```python
debug
#LogLevel
```
```python
=
```
```python
info
#LogTarget
```
```python
=
```
```python
journal
```
```python
-
```
```python
or
```
```python
-
```
```python
kmsg
#LogColor
```
```python
=
```
```python
yes
#LogLocation
```
```python
=
```
```python
no
#DumpCore
```
```python
=
```
```python
yes
#CrashShell
```
```python
=
```
```python
no
#ShowStatus
```
```python
=
```
```python
yes
#CrashChVT
```
```python
=
```
```python
1
```
```python
#CtrlAltDelBurstAction
```
```python
=
```
```python
reboot
```
```python
-
```
```python
force
#CPUAffinity
```
```python
=
```
```python
1
```
```python
2
```
```python
#JoinControllers
```
```python
=
```
```python
cpu
```
```python
,
```
```python
cpuacct net_cls
```
```python
,
```
```python
net_prio
#RuntimeWatchdogSec
```
```python
=
```
```python
0
```
```python
#ShutdownWatchdogSec
```
```python
=
```
```python
10
```
```python
min
#CapabilityBoundingSet
```
```python
=
```
```python
#SystemCallArchitectures
```
```python
=
```
```python
#TimerSlackNSec
```
```python
=
```
```python
#DefaultTimerAccuracySec
```
```python
=
```
```python
1
```
```python
min
#DefaultStandardOutput
```
```python
=
```
```python
journal
#DefaultStandardError
```
```python
=
```
```python
inherit
#DefaultTimeoutStartSec
```
```python
=
```
```python
90
```
```python
s
#DefaultTimeoutStopSec
```
```python
=
```
```python
90
```
```python
s
#DefaultRestartSec
```
```python
=
```
```python
100
```
```python
ms
#DefaultStartLimitInterval
```
```python
=
```
```python
10
```
```python
s
#DefaultStartLimitBurst
```
```python
=
```
```python
5
```
```python
#DefaultEnvironment
```
```python
=
```
```python
#DefaultCPUAccounting
```
```python
=
```
```python
no
#DefaultBlockIOAccounting
```
```python
=
```
```python
no
#DefaultMemoryAccounting
```
```python
=
```
```python
no
#DefaultTasksAccounting
```
```python
=
```
```python
no
#DefaultTasksMax
```
```python
=
```
```python
#DefaultLimitCPU
```
```python
=
```
```python
#DefaultLimitFSIZE
```
```python
=
```
```python
#DefaultLimitDATA
```
```python
=
```
```python
#DefaultLimitSTACK
```
```python
=
```
```python
#DefaultLimitCORE
```
```python
=
```
```python
#DefaultLimitRSS
```
```python
=
```
```python
#DefaultLimitNOFILE
```
```python
=
```
```python
#DefaultLimitAS
```
```python
=
```
```python
#DefaultLimitNPROC
```
```python
=
```
```python
#DefaultLimitMEMLOCK
```
```python
=
```
```python
#DefaultLimitLOCKS
```
```python
=
```
```python
#DefaultLimitSIGPENDING
```
```python
=
```
```python
#DefaultLimitMSGQUEUE
```
```python
=
```
```python
#DefaultLimitNICE
```
```python
=
```
```python
#DefaultLimitRTPRIO
```
```python
=
```
```python
#DefaultLimitRTTIME
```
```python
=
```
```python
[
```
```python
root@liumiaocn systemd
```
```python
]
```
```python
#
```
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## Step 2: reboot
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)重启操作系统
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## Step 3: 添加Environment
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
# cat liumiaocn
```
```python
.
```
```python
service
```
```python
[
```
```python
Unit
```
```python
]
```
```python
Description
```
```python
=
```
```python
Systemd Service Sample By liumiaocn
Documentation
```
```python
=
```
```python
https
```
```python
:
```
```python
/
```
```python
/liumiaocn.blog.csdn.net/
```
```python
[
```
```python
Service
```
```python
]
```
```python
Environment
```
```python
=
```
```python
SYSTEMD_LOG_LEVEL
```
```python
=
```
```python
debug
WorkingDirectory
```
```python
=
```
```python
/
```
```python
tmp
```
```python
/
```
```python
systemd_working_dir
ExecStart
```
```python
=
```
```python
/
```
```python
usr
```
```python
/
```
```python
bin
```
```python
/
```
```python
echo
```
```python
"hello world"
```
```python
[
```
```python
Install
```
```python
]
```
```python
WantedBy
```
```python
=
```
```python
multi
```
```python
-
```
```python
user
```
```python
.
```
```python
target
```
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
#
```
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 确认结果
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)再次启动测试用的服务
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
# systemctl daemon
```
```python
-
```
```python
reload
```
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
# systemctl start liumiaocn
```
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)然后使用status或者journalctl均可看到更加详细的输入
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
# systemctl status liumiaocn
● liumiaocn
```
```python
.
```
```python
service
```
```python
-
```
```python
Systemd Service Sample By liumiaocn
   Loaded
```
```python
:
```
```python
loaded
```
```python
(
```
```python
/
```
```python
usr
```
```python
/
```
```python
lib
```
```python
/
```
```python
systemd
```
```python
/
```
```python
system
```
```python
/
```
```python
liumiaocn
```
```python
.
```
```python
service
```
```python
;
```
```python
disabled
```
```python
;
```
```python
vendor preset
```
```python
:
```
```python
disabled
```
```python
)
```
```python
Active
```
```python
:
```
```python
failed
```
```python
(
```
```python
Result
```
```python
:
```
```python
exit
```
```python
-
```
```python
code
```
```python
)
```
```python
since Fri
```
```python
2019
```
```python
-
```
```python
04
```
```python
-
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
CST
```
```python
;
```
```python
7
```
```python
s ago
     Docs
```
```python
:
```
```python
https
```
```python
:
```
```python
/
```
```python
/liumiaocn.blog.csdn.net/
```
```python
Process
```
```python
:
```
```python
3311
```
```python
ExecStart
```
```python
=
```
```python
/
```
```python
usr
```
```python
/
```
```python
bin
```
```python
/
```
```python
echo hello
```
```python
world
```
```python
(
```
```python
code
```
```python
=
```
```python
exited
```
```python
,
```
```python
status
```
```python
=
```
```python
200
```
```python
/
```
```python
CHDIR
```
```python
)
```
```python
Main
```
```python
PID
```
```python
:
```
```python
3311
```
```python
(
```
```python
code
```
```python
=
```
```python
exited
```
```python
,
```
```python
status
```
```python
=
```
```python
200
```
```python
/
```
```python
CHDIR
```
```python
)
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
Forked
```
```python
/
```
```python
usr
```
```python
/
```
```python
bin
```
```python
/
```
```python
echo
```
```python
as
```
```python
3311
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
liumiaocn
```
```python
.
```
```python
service changed dead
```
```python
-
```
```python
>
```
```python
running
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
Job liumiaocn
```
```python
.
```
```python
service
```
```python
/
```
```python
start finished
```
```python
,
```
```python
result
```
```python
=
```
```python
done
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
Started Systemd Service Sample By liumiaocn
```
```python
.
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
Child
```
```python
3311
```
```python
belongs to liumiaocn
```
```python
.
```
```python
service
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
liumiaocn
```
```python
.
```
```python
service
```
```python
:
```
```python
main process exited
```
```python
,
```
```python
code
```
```python
=
```
```python
exited
```
```python
,
```
```python
status
```
```python
=
```
```python
200
```
```python
/
```
```python
CHDIR
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
liumiaocn
```
```python
.
```
```python
service changed running
```
```python
-
```
```python
>
```
```python
failed
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
Unit liumiaocn
```
```python
.
```
```python
service entered failed state
```
```python
.
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
liumiaocn
```
```python
.
```
```python
service failed
```
```python
.
```
```python
Apr
```
```python
05
```
```python
20
```
```python
:
```
```python
31
```
```python
:
```
```python
25
```
```python
liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
:
```
```python
liumiaocn
```
```python
.
```
```python
service
```
```python
:
```
```python
cgroup is empty
```
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
#
```
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)journalctl输出
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
# journalctl -u liumiaocn
```
```python
-- Logs begin at Fri 2019-04-05 20:30:17 CST, end at Fri 2019-04-05 20:31:42 CST. --
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Trying to enqueue job liumiaocn.service/start/replace
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Installed new job liumiaocn.service/start as 4624
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Enqueued job liumiaocn.service/start as 4624
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: About to execute: /usr/bin/echo
```
```python
'hello world'
```
```python
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Forked /usr/bin/echo as 3311
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: liumiaocn.service changed dead -
```
```python
>
```
```python
running
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Job liumiaocn.service/start finished, result
```
```python
=
```
```python
done
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Started Systemd Service Sample By liumiaocn.
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Child 3311 belongs to liumiaocn.service
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: liumiaocn.service: main process exited, code
```
```python
=
```
```python
exited, status
```
```python
=
```
```python
200/CHDIR
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: liumiaocn.service changed running -
```
```python
>
```
```python
failed
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: Unit liumiaocn.service entered failed state.
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: liumiaocn.service failed.
Apr 05 20:31:25 liumiaocn systemd
```
```python
[
```
```python
1
```
```python
]
```
```python
: liumiaocn.service: cgroup is empty
```
```python
[
```
```python
root@liumiaocn system
```
```python
]
```
```python
#
```
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 总结
[
](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)按照本文的步骤即可对服务进行debug信息的输出，但是至于从日志中能否看出期待的结果，那是systemd需要回答的另外一个问题了，所以经验的总结和归纳也非常重要，毕竟systemd已经是目前的主要方式了。
[
            ](https://img-blog.csdnimg.cn/20190408194440902.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

