
# Android Camera框架 - 嵌入式Linux - CSDN博客

2015年11月10日 16:18:37[写代码的篮球球痴](https://me.csdn.net/weiqifa0)阅读数：2324


**总体介绍**
Android Camera 框架从整体上看是一个 client/service 的架构,
有两个进程:
**client 进程**,可以看成是 AP 端,主要包括 JAVA 代码与一些 native c/c++代码;
**service 进 程**,属于服务端,是 native c/c++代码,主要负责和 linux kernel 中的 camera driver 交互,搜集 linux kernel 中 camera driver 传上来的数据,并交给显示系统显示。
client 进程与 service 进程通过 Binder 机制通信, client 端通过调用 service 端的接口实现各个具体的功能。
## １总体框图
![这里写图片描述](https://img-blog.csdn.net/20151110153631408)
## ２应用层
主要代码在packages/apps/Camera/
## ３Framework层
## 3.1 Framework.jar
这层的代码主要编译成framework.jar frameworks/base/core/java/android/hardware/Camera.java
这部分是提供给Android的应用接口
## 3.2 libandroid_runtime.so
这层是Camera的JAVA native调用部分：./frameworks/base/core/jni/android_hardware_Camera.cpp
libandroid_runtime.so除了给camera调用外，还有其他的功能
## 3.3Camera client
这里主要是编译生成libcamera_client.so  client和libcameraservice.so进行通信（IPC　binder通信）
```python
weiqifa
```
```python
@weiqifa
```
```python
-
```
```python
Inspiron
```
```python
-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100
```
```python
$
```
```python
ls frameworks/av/camera/
```
```python
Android
```
```python
.mk
```
```python
Camera
```
```python
.cpp
```
```python
ICameraClient
```
```python
.cpp
```
```python
ICameraRecordingProxyListener
```
```python
.cpp
```
```python
IProCameraCallbacks
```
```python
.cpp
```
```python
NOTICE
```
```python
camera2
```
```python
CameraMetadata
```
```python
.cpp
```
```python
ICamera
```
```python
.cpp
```
```python
ICameraService
```
```python
.cpp
```
```python
IProCameraUser
```
```python
.cpp
```
```python
ProCamera
```
```python
.cpp
```
```python
CameraBase
```
```python
.cpp
```
```python
CameraParameters
```
```python
.cpp
```
```python
ICameraRecordingProxy
```
```python
.cpp
```
```python
ICameraServiceListener
```
```python
.cpp
```
```python
MODULE_LICENSE_APACHE2
```
```python
tests
weiqifa
```
```python
@weiqifa
```
```python
-
```
```python
Inspiron
```
```python
-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100
```
```python
$
```
既然client和service用的是binder通信，那么就必须把service注册到servicemanager里面去，查看代码
./frameworks/av/media/mediaserver/**main_mediaserver.cpp**
里面有一句**CameraService::instantiate();**这一句就是用来注册这个service的
**这样，Camera就在ServiceManager完成服务注册，提供给client随时使用。**
## 3.4Camera service
Camera service是实现client的接口，并且和HAL层进行通信的，是camera的服务层
代码位置：/frameworks/av/services/camera/libcameraservice
```python
weiqifa
```
```python
@weiqifa
```
```python
-
```
```python
Inspiron
```
```python
-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100
```
```python
$
```
```python
ls ./frameworks/av/services/camera/libcameraservice
```
```python
Android
```
```python
.mk  api2
```
```python
CameraDeviceFactory
```
```python
.cpp
```
```python
CameraService
```
```python
.cpp  common   device2  gui
```
```python
NOTICE
```
```python
api1        api_pro
```
```python
CameraDeviceFactory
```
```python
.h
```
```python
CameraService
```
```python
.h    device1  device3
```
```python
MODULE_LICENSE_APACHE2
```
```python
utils
weiqifa
```
```python
@weiqifa
```
```python
-
```
```python
Inspiron
```
```python
-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100
```
```python
$
```
## 4Camera Hal
Camera Hal层是各个不同厂商的不通之处，上面的层次是Android系统特有的。
怎么确定我们使用这个系统的hal层呢？
首先用busybox在开发板上面确定一下我们so的名字
![这里写图片描述](https://img-blog.csdn.net/20151110160347716)[ ](https://img-blog.csdn.net/20151110160347716)
这样我们可以看出我们的so名字是camera.default.so
然后再通过命令在代码里面找到我们的代码位置
```python
weiqifa
```
```python
@weiqifa
```
```python
-Inspiron-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100$ find ./ -iname
```
```python
*.
```
```python
mk|xargs grep -wrn
```
```python
camera
```
```python
.
```
```python
default
```
```python
./mediatek/
```
```python
hardware
```
```python
/mtkcam/module/Android.mk:
```
```python
67
```
```python
:LOCAL_MODULE :=
```
```python
camera
```
```python
.
```
```python
default
```
```python
.module
./mediatek/
```
```python
hardware
```
```python
/mtkcam/devicemgr/Android.mk:
```
```python
72
```
```python
:LOCAL_MODULE :=
```
```python
camera
```
```python
.
```
```python
default
```
```python
.devicemgrbase
./mediatek/platform/mt8127/
```
```python
hardware
```
```python
/mtkcam/devicemgr/Android.mk:
```
```python
73
```
```python
:LOCAL_WHOLE_STATIC_LIBRARIES +=
```
```python
camera
```
```python
.
```
```python
default
```
```python
.module
./mediatek/platform/mt8127/
```
```python
hardware
```
```python
/mtkcam/devicemgr/Android.mk:
```
```python
74
```
```python
:LOCAL_WHOLE_STATIC_LIBRARIES +=
```
```python
camera
```
```python
.
```
```python
default
```
```python
.devicemgrbase
./mediatek/platform/mt8127/
```
```python
hardware
```
```python
/mtkcam/devicemgr/Android.mk:
```
```python
96
```
```python
:LOCAL_MODULE :=
```
```python
camera
```
```python
.
```
```python
default
```
```python
./build/target/product/common.mk:
```
```python
302
```
```python
:
```
```python
camera
```
```python
.
```
```python
default
```
```python
\
./
```
```python
hardware
```
```python
/libhardware/modules/
```
```python
camera
```
```python
/Android.mk:
```
```python
19
```
```python
:LOCAL_MODULE :=
```
```python
camera
```
```python
.
```
```python
default
```
```python
weiqifa
```
```python
@weiqifa
```
```python
-Inspiron-
```
```python
3847
```
```python
:~/weiqifa/new_tm100/tm100$
```
可以看出我们的代码位置应该在：./mediatek/platform/mt8127/hardware/mtkcam/
## ５driver
驱动层的话一定要遵循v4l2的框架，并且生成设备节点给hal层调用，我们驱动层的代码可以从添加一个摄像头那个文章里面看出来。
mediatek/custom/mid713l_lp_lvds/kernel/imgsensor/bf3703_yuv/

[
](https://img-blog.csdn.net/20151110160347716)
