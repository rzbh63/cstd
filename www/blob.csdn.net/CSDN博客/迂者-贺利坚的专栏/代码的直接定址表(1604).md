
# 代码的直接定址表(1604) - 迂者-贺利坚的专栏 - CSDN博客

2017年05月12日 21:57:43[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：498


本文为《汇编语言程序设计》1604小节例程。点击[链接…](http://blog.csdn.net/sxhelijian/article/details/56671827)进课程主页。
任务：编程实现一个子程序setscreen，为显示输出提供如下功能：
(1) 清屏。
(2) 设置前景色。
(3) 设置背景色。
(4) 向上滚动一行。
```python
assume cs:code
code segment
```
```python
start:
```
```python
mov
```
```python
ah,
```
```python
3
```
```python
mov
```
```python
al,
```
```python
5
```
```python
call
```
```python
setscreen
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
    int
```
```python
21
```
```python
h
```
```python
setscreen:
```
```python
jmp
```
```python
short
```
```python
set
```
```python
table  dw sub1,sub2,sub3,sub4
```
```python
set:
```
```python
push
```
```python
bx
    cmp ah,
```
```python
3
```
```python
;判断传递的是否大于 3
```
```python
ja sret
```
```python
mov
```
```python
bl,ah
```
```python
mov
```
```python
bh,
```
```python
0
```
```python
add
```
```python
bx,bx
```
```python
;根据ah中的功能号计算对应子程序的地址在table表中的偏移
```
```python
call
```
```python
word ptr table[bx]
```
```python
;调用对应的功能子程序
```
```python
sret:
```
```python
pop
```
```python
bx
```
```python
ret
```
```python
;功能子程序入口参数说明：
```
```python
;(1) 用 ah 寄存器传递功能号：0 表示清屏，1表示设置前景色，2 表示设置背景色，3 表示向上滚动一行；
```
```python
;(2) 对于2、3号功能，用 al 传送颜色值，(al) ∈{0,1,2,3,4,5,6,7}
```
```python
;功能子程序1：清屏
```
```python
sub1:
```
```python
push
```
```python
bx
```
```python
push
```
```python
cx
```
```python
push
```
```python
es
```
```python
mov
```
```python
bx,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,bx
```
```python
mov
```
```python
bx,
```
```python
0
```
```python
mov
```
```python
cx,
```
```python
2000
```
```python
sub1s:
```
```python
mov
```
```python
byte ptr es:[bx],
```
```python
' '
```
```python
add
```
```python
bx,
```
```python
2
```
```python
loop sub1s
```
```python
pop
```
```python
es
```
```python
pop
```
```python
cx
```
```python
pop
```
```python
bx
```
```python
ret
```
```python
;sub1 ends
```
```python
;功能子程序2：设置前景色
```
```python
sub2:
```
```python
push
```
```python
bx
```
```python
push
```
```python
cx
```
```python
push
```
```python
es
```
```python
mov
```
```python
bx,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,bx
```
```python
mov
```
```python
bx,
```
```python
1
```
```python
mov
```
```python
cx,
```
```python
2000
```
```python
sub2s:
```
```python
and
```
```python
byte ptr es:[bx],
```
```python
11111000
```
```python
b
```
```python
or
```
```python
es:[bx],al
```
```python
add
```
```python
bx,
```
```python
2
```
```python
loop sub2s
```
```python
pop
```
```python
es
```
```python
pop
```
```python
cx
```
```python
pop
```
```python
bx
```
```python
ret
```
```python
;sub2 ends
```
```python
;功能子程序3：设置背景色
```
```python
sub3:
```
```python
push
```
```python
bx
```
```python
push
```
```python
cx
```
```python
push
```
```python
es
```
```python
mov
```
```python
cl,
```
```python
4
```
```python
shl al,cl
```
```python
mov
```
```python
bx,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,bx
```
```python
mov
```
```python
bx,
```
```python
1
```
```python
mov
```
```python
cx,
```
```python
2000
```
```python
sub3s:
```
```python
and
```
```python
byte ptr es:[bx],
```
```python
10001111
```
```python
b
```
```python
or
```
```python
es:[bx],al
```
```python
add
```
```python
bx,
```
```python
2
```
```python
loop sub2s
```
```python
pop
```
```python
es
```
```python
pop
```
```python
cx
```
```python
pop
```
```python
bx
```
```python
ret
```
```python
; sub3 ends
```
```python
;功能子程序4：向上滚动一行
```
```python
sub4:
```
```python
push
```
```python
cx
```
```python
push
```
```python
si
```
```python
push
```
```python
di
```
```python
push
```
```python
es
```
```python
push
```
```python
ds
```
```python
mov
```
```python
si,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,si
```
```python
mov
```
```python
ds,si
```
```python
mov
```
```python
si,
```
```python
160
```
```python
;ds:si指向第n+1行
```
```python
mov
```
```python
di,
```
```python
0
```
```python
;es:di指向第n行
```
```python
cld
```
```python
mov
```
```python
cx,
```
```python
24
```
```python
;共复制24行
```
```python
sub4s:
```
```python
push
```
```python
cx
```
```python
mov
```
```python
cx,
```
```python
160
```
```python
rep movsb
```
```python
;复制
```
```python
pop
```
```python
cx
    loop sub4s
```
```python
mov
```
```python
cx,
```
```python
80
```
```python
mov
```
```python
si,
```
```python
0
```
```python
sub4s1:
```
```python
mov
```
```python
byte ptr es:[
```
```python
160
```
```python
*
```
```python
24
```
```python
+si],
```
```python
' '
```
```python
;最后一行清空
```
```python
add
```
```python
si,
```
```python
2
```
```python
loop sub4s1
```
```python
pop
```
```python
ds
```
```python
pop
```
```python
es
```
```python
pop
```
```python
di
```
```python
pop
```
```python
si
```
```python
pop
```
```python
cx
```
```python
ret
```
```python
;sub4 ends
```
```python
code ends
end start
```

