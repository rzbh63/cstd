
# Kubernetes安装系列之Kubelet指标获取方式 - 知行合一 止于至善 - CSDN博客

2019年04月02日 21:07:50[liumiaocn](https://me.csdn.net/liumiaocn)阅读数：109所属专栏：[深入浅出kubernetes](https://blog.csdn.net/column/details/12761.html)



这篇文章整理来介绍一下使用kubelet中使用api来确认指标数据的方式，为后续使用metrics server/heapster/prometheus打下一点基础。
# 整体操作
[https://blog.csdn.net/liumiaocn/article/details/88413428](https://blog.csdn.net/liumiaocn/article/details/88413428)
# kubelet vs cadvisor
cadvisor在其他文章中已经早有介绍，现在已经成为kubelet的一部分，这篇文章也将演示一下如何使用api方式来访问cadvisor
# 事前准备
> 可参看如下文章进行设定：

> [https://liumiaocn.blog.csdn.net/article/details/88882893](https://liumiaocn.blog.csdn.net/article/details/88882893)

# 事前确认
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
# netstat -tunlp |grep kubelet
```
```python
tcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      9028/kubelet        
tcp        0      0 192.168.163.131:10250   0.0.0.0:*               LISTEN      9028/kubelet        
tcp        0      0 127.0.0.1:38593         0.0.0.0:*               LISTEN      9028/kubelet
```
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
#
```
# curl方式访问
## 访问metrics
示例命令如下所示。
> curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem
> [https://192.168.163.131:10250/metrics](https://192.168.163.131:10250/metrics)
执行示例
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
# curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem https://192.168.163.131:10250/metrics | head -n 10
```
```python
# HELP apiserver_audit_event_total Counter of audit events generated and sent to the audit backend.
```
```python
# TYPE apiserver_audit_event_total counter
```
```python
apiserver_audit_event_total 0
```
```python
# HELP apiserver_audit_requests_rejected_total Counter of apiserver requests rejected due to an error in audit logging backend.
```
```python
# TYPE apiserver_audit_requests_rejected_total counter
```
```python
apiserver_audit_requests_rejected_total 0
```
```python
# HELP apiserver_client_certificate_expiration_seconds Distribution of the remaining lifetime on the certificate used to authenticate a request.
```
```python
# TYPE apiserver_client_certificate_expiration_seconds histogram
```
```python
apiserver_client_certificate_expiration_seconds_bucket
```
```python
{
```
```python
le
```
```python
=
```
```python
"0"
```
```python
}
```
```python
0
apiserver_client_certificate_expiration_seconds_bucket
```
```python
{
```
```python
le
```
```python
=
```
```python
"21600"
```
```python
}
```
```python
0
```
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
#
```
## 访问metrics/cadvisor
示例命令如下所示。
> curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem
> [https://192.168.163.131:10250/metrics/cadvisor](https://192.168.163.131:10250/metrics/cadvisor)
执行示例
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
# curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem https://192.168.163.131:10250/metrics/cadvisor |head -n 10
```
```python
# HELP cadvisor_version_info A metric with a constant '1' value labeled by kernel version, OS version, docker version, cadvisor version & cadvisor revision.
```
```python
# TYPE cadvisor_version_info gauge
```
```python
cadvisor_version_info
```
```python
{
```
```python
cadvisorRevision
```
```python
=
```
```python
""
```
```python
,cadvisorVersion
```
```python
=
```
```python
""
```
```python
,dockerVersion
```
```python
=
```
```python
"17.03.2-ce"
```
```python
,kernelVersion
```
```python
=
```
```python
"3.10.0-957.el7.x86_64"
```
```python
,osVersion
```
```python
=
```
```python
"CentOS Linux 7 (Core)"
```
```python
}
```
```python
1
```
```python
# HELP container_cpu_load_average_10s Value of container cpu load average over the last 10 seconds.
```
```python
# TYPE container_cpu_load_average_10s gauge
```
```python
container_cpu_load_average_10s
```
```python
{
```
```python
container_name
```
```python
=
```
```python
""
```
```python
,id
```
```python
=
```
```python
"/"
```
```python
,image
```
```python
=
```
```python
""
```
```python
,name
```
```python
=
```
```python
""
```
```python
,namespace
```
```python
=
```
```python
""
```
```python
,pod_name
```
```python
=
```
```python
""
```
```python
}
```
```python
0
container_cpu_load_average_10s
```
```python
{
```
```python
container_name
```
```python
=
```
```python
""
```
```python
,id
```
```python
=
```
```python
"/kube-proxy"
```
```python
,image
```
```python
=
```
```python
""
```
```python
,name
```
```python
=
```
```python
""
```
```python
,namespace
```
```python
=
```
```python
""
```
```python
,pod_name
```
```python
=
```
```python
""
```
```python
}
```
```python
0
container_cpu_load_average_10s
```
```python
{
```
```python
container_name
```
```python
=
```
```python
""
```
```python
,id
```
```python
=
```
```python
"/kubepods"
```
```python
,image
```
```python
=
```
```python
""
```
```python
,name
```
```python
=
```
```python
""
```
```python
,namespace
```
```python
=
```
```python
""
```
```python
,pod_name
```
```python
=
```
```python
""
```
```python
}
```
```python
0
container_cpu_load_average_10s
```
```python
{
```
```python
container_name
```
```python
=
```
```python
""
```
```python
,id
```
```python
=
```
```python
"/kubepods/besteffort"
```
```python
,image
```
```python
=
```
```python
""
```
```python
,name
```
```python
=
```
```python
""
```
```python
,namespace
```
```python
=
```
```python
""
```
```python
,pod_name
```
```python
=
```
```python
""
```
```python
}
```
```python
0
container_cpu_load_average_10s
```
```python
{
```
```python
container_name
```
```python
=
```
```python
""
```
```python
,id
```
```python
=
```
```python
"/kubepods/besteffort/pod564c319b-525c-11e9-92c4-080027f8be6f"
```
```python
,image
```
```python
=
```
```python
""
```
```python
,name
```
```python
=
```
```python
""
```
```python
,namespace
```
```python
=
```
```python
"kube-system"
```
```python
,pod_name
```
```python
=
```
```python
"kubernetes-dashboard-57df4db6b-hn4jr"
```
```python
}
```
```python
0
```
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
#
```
## 访问stats/container
示例命令如下所示。
> curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem
> [https://192.168.163.131:10250/metrics/cadvisor](https://192.168.163.131:10250/metrics/cadvisor)
执行示例
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
# curl -s --cacert /etc/ssl/ca/ca.pem --cert /etc/ssl/ca/kubeadmin.pem --key /etc/ssl/ca/kubeadmin-key.pem https://192.168.163.131:10250/stats/container/|head -n 10
```
```python
{
```
```python
"/"
```
```python
:
```
```python
{
```
```python
"name"
```
```python
:
```
```python
"/"
```
```python
,
```
```python
"subcontainers"
```
```python
:
```
```python
[
```
```python
{
```
```python
"name"
```
```python
:
```
```python
"/kube-proxy"
```
```python
}
```
```python
,
```
```python
{
```
```python
"name"
```
```python
:
```
```python
"/kubepods"
```
```python
}
```
```python
,
```
```python
[
```
```python
root@host131 kubernetes
```
```python
]
```
```python
#
```
# https页面方式访问
## 访问metrics
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190402110513691.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## 访问metrics/cadvisor
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190402110529151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## 访问stats/container
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190402110541173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
注意事项：
一般来说只要HTTPS的6443能通，kubelet设定正确的情况下，页面访问也没有问题，一键安装的脚本中缺省设置即可。客户端设定可参看：
[https://liumiaocn.blog.csdn.net/article/details/88945671](https://liumiaocn.blog.csdn.net/article/details/88945671)
[
						](https://img-blog.csdnimg.cn/20190402110541173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
[
	](https://img-blog.csdnimg.cn/20190402110541173.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
