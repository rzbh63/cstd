
# beeline连接hiveserver2报错：User: root is not allowed to impersonate root - Magician的博客 - CSDN博客


2018年08月29日 18:07:51[春雨里de太阳](https://me.csdn.net/qq_16633405)阅读数：821


最近在生产中搭建HA机制的集群，碰到不少坑，会在接下来的时间里好好总结下，先说下遇到的一个大坑。我们的需求是：希望通过hive的thrift服务来实现跨语言访问Hive数据仓库。但是第一步，你得需要在节点中打通服务器端（启动hiveserver2的节点）和客户端（启动beeline的节点）的链接。整体的结构如下图所示：
![这里写图片描述](https://img-blog.csdn.net/2018082917131428?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/2018082917131428?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
但是整个的配置过程可谓是一波三折，先在数据1节点启动hiveserver2，接着在数据3节点启动beeline链接数据1。出现了以下错误：
**坑：**
```python
Error:
```
```python
Could not open client transport with JDBC Uri: jdbc:hive2://ha1:
```
```python
10000
```
```python
/hive: Failed to open new session: java
```
```python
.lang
```
```python
.RuntimeException
```
```python
: org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.RemoteException
```
```python
(org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.authorize
```
```python
.AuthorizationException
```
```python
): User: root  is not allowed to impersonate root(state=
```
```python
08
```
```python
S01,code=
```
```python
0
```
```python
)
```
![这里写图片描述](https://img-blog.csdn.net/20180829171807767?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
|解决方法：参考网上的一般的解决方法|
---

```python
在hadoop的配置文件core-site.xml中添加如下属性：
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
hadoop.proxyuser.root.hosts
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
*
```
```python
</
```
```python
value
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
hadoop.proxyuser.root.groups
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
*
```
```python
</
```
```python
value
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
报错：User: root is not allowed to impersonate root(state=08S01,code=0)
就将上面配置hadoop.proxyuser.xxx.hosts和hadoop.proxyuser.xxx.groups中的xxx设置为root(即你的错误日志中显示的User：xxx为什么就设置为什么)。“*”表示可通过超级代理“xxx”操作hadoop的用户、用户组和主机。重启hdfs。
这样改的原因：
主要原因是hadoop引入了一个安全伪装机制，使得hadoop 不允许上层系统直接将实际用户传递到hadoop层，而是将实际用户传递给一个超级代理，由此代理在hadoop上执行操作，避免任意客户端随意操作hadoop，如下图：
![这里写图片描述](https://img-blog.csdn.net/20180829173558249?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180829173558249?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
图上的超级代理是“Oozie”，你自己的超级代理是上面设置的“xxx”。
而hadoop内部还是延用linux对应的用户和权限。即你用哪个linux用户启动hadoop，对应的用户也就成为hadoop的内部用户，如下图我的linux用户为root，对应的hadoop中用户也就是root：
![这里写图片描述](https://img-blog.csdn.net/2018082918150527?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/2018082918150527?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
如果是这么简单就好了，改完之后错误依旧，只不过是在自己虚拟机搭建的HA集群中可以正常连接，但是生产中的集群依旧不能正常链接，纠结了大半天，**参考了网上的各种解决方案如刷新HDFS的用户的配置权限：**
[
](https://img-blog.csdn.net/2018082918150527?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
```python
bin/hdfs dfsadmin –refreshSuperUserGroupsConfiguration
bin/yarn rmadmin –refreshSuperUserGroupsConfiguration
```
[
](https://img-blog.csdn.net/2018082918150527?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)但是都没有效果，后来仔细对比了虚拟机正常连接的集群对应的日志和生产启动失败的集群的日志发现了一些“蛛丝马迹”：
虚拟机的日志（正常启动）：
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
11
```
```python
,
```
```python
661
```
```python
INFO [main] metastore
```
```python
.MetaStoreDirectSql
```
```python
: Using direct SQL, underlying DB is MYSQL
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
11
```
```python
,
```
```python
665
```
```python
INFO [main] metastore
```
```python
.ObjectStore
```
```python
: Initialized ObjectStore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
11
```
```python
,
```
```python
813
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: Added admin role
```
```python
in
```
```python
metastore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
11
```
```python
,
```
```python
814
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: Added public role
```
```python
in
```
```python
metastore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
11
```
```python
,
```
```python
834
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: No user is added
```
```python
in
```
```python
admin role, since config is empty
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
12
```
```python
,
```
```python
032
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: get_all_functions
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
12
```
```python
,
```
```python
036
```
```python
INFO [main] HiveMetaStore
```
```python
.audit
```
```python
: ugi=root      ip=unknown-ip-addr      cmd=get_all_functions
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
841
```
```python
INFO [main] session
```
```python
.SessionState
```
```python
: Created HDFS directory: /tmp/hive/root/ca0849bf-
```
```python
7
```
```python
b5f-
```
```python
44
```
```python
fb-af7e-ebcdfe04d13f
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
895
```
```python
INFO [main] session
```
```python
.SessionState
```
```python
: Created local directory: /tmp/root/ca0849bf-
```
```python
7
```
```python
b5f-
```
```python
44
```
```python
fb-af7e-ebcdfe04d13f
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
908
```
```python
INFO [main] session
```
```python
.SessionState
```
```python
: Created HDFS directory: /tmp/hive/root/ca0849bf-
```
```python
7
```
```python
b5f-
```
```python
44
```
```python
fb-af7e-ebcdfe04d13f/_tmp_space
```
```python
.db
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
936
```
```python
INFO [main] sqlstd
```
```python
.SQLStdHiveAccessController
```
```python
: Created SQLStdHiveAccessController for session context : HiveAuthzSessionContext [sessionString=ca0849bf-
```
```python
7
```
```python
b5f-
```
```python
44
```
```python
fb-af7e-ebcdfe04d13f, clientType=HIVESERVER2]
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
938
```
```python
WARN [main] session
```
```python
.SessionState
```
```python
: METASTORE_FILTER_HOOK will be ignored, since hive
```
```python
.security
```
```python
.authorization
```
```python
.manager
```
```python
is
```
```python
set
```
```python
to instance of HiveAuthorizerFactory.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
940
```
```python
INFO [main] hive
```
```python
.metastore
```
```python
: Mestastore configuration hive
```
```python
.metastore
```
```python
.filter
```
```python
.hook
```
```python
changed from org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.metastore
```
```python
.DefaultMetaStoreFilterHookImpl
```
```python
to org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.security
```
```python
.authorization
```
```python
.plugin
```
```python
.AuthorizationMetaStoreFilterHook
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
996
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: Cleaning up thread local RawStore...
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
996
```
```python
INFO [main] HiveMetaStore
```
```python
.audit
```
```python
: ugi=root      ip=unknown-ip-addr      cmd=Cleaning up thread local RawStore...
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
996
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: Done cleaning up thread local RawStore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
13
```
```python
,
```
```python
997
```
```python
INFO [main] HiveMetaStore
```
```python
.audit
```
```python
: ugi=root      ip=unknown-ip-addr      cmd=Done cleaning up thread local RawStore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
606
```
```python
INFO [main] service
```
```python
.CompositeService
```
```python
: Operation log root directory is created: /tmp/root/operation_logs
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
618
```
```python
INFO [main] service
```
```python
.CompositeService
```
```python
: HiveServer2: Background operation thread pool size:
```
```python
100
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
624
```
```python
INFO [main] service
```
```python
.CompositeService
```
```python
: HiveServer2: Background operation thread wait queue size:
```
```python
100
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
624
```
```python
INFO [main] service
```
```python
.CompositeService
```
```python
: HiveServer2: Background operation thread keepalive time:
```
```python
10
```
```python
seconds
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
653
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:OperationManager is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
653
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:SessionManager is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
653
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:CLIService is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
653
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:ThriftBinaryCLIService is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
653
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:HiveServer2 is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
654
```
```python
INFO [main] server
```
```python
.HiveServer
```
```python
2: Starting Web UI on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
903
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:OperationManager is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
903
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:SessionManager is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
915
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:CLIService is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
916
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:ThriftBinaryCLIService is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
916
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:HiveServer2 is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
14
```
```python
,
```
```python
918
```
```python
INFO [main] server
```
```python
.Server
```
```python
: jetty-
```
```python
7.6
```
```python
.0
```
```python
.v
```
```python
20120127
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
054
```
```python
INFO [main] webapp
```
```python
.WebInfConfiguration
```
```python
: Extract jar:file:/root/apps/hive-
```
```python
2.1
```
```python
.1
```
```python
/lib/hive-service-
```
```python
2.1
```
```python
.1
```
```python
.jar
```
```python
!/hive-webapps/hiveserver2/ to /tmp/jetty-
```
```python
0.0
```
```python
.0
```
```python
.0
```
```python
-
```
```python
10002
```
```python
-hiveserver2-_-any-/webapp
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
090
```
```python
INFO [Thread-
```
```python
11
```
```python
] thrift
```
```python
.ThriftCLIService
```
```python
: Starting ThriftBinaryCLIService on port
```
```python
10000
```
```python
with
```
```python
5.
```
```python
.
```
```python
.500
```
```python
worker threads
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
413
```
```python
INFO [main] handler
```
```python
.ContextHandler
```
```python
: started o
```
```python
.e
```
```python
.j
```
```python
.w
```
```python
.WebAppContext
```
```python
{/,file:/tmp/jetty-
```
```python
0.0
```
```python
.0
```
```python
.0
```
```python
-
```
```python
10002
```
```python
-hiveserver2-_-any-/webapp/},jar:file:/root/apps/hive-
```
```python
2.1
```
```python
.1
```
```python
/lib/hive-service-
```
```python
2.1
```
```python
.1
```
```python
.jar
```
```python
!/hive-webapps/hiveserver2
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
583
```
```python
INFO [main] handler
```
```python
.ContextHandler
```
```python
: started o
```
```python
.e
```
```python
.j
```
```python
.s
```
```python
.ServletContextHandler
```
```python
{/static,jar:file:/root/apps/hive-
```
```python
2.1
```
```python
.1
```
```python
/lib/hive-service-
```
```python
2.1
```
```python
.1
```
```python
.jar
```
```python
!/hive-webapps/static}
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
594
```
```python
INFO [main] handler
```
```python
.ContextHandler
```
```python
: started o
```
```python
.e
```
```python
.j
```
```python
.s
```
```python
.ServletContextHandler
```
```python
{/logs,file:/root/apps/hive-
```
```python
2.1
```
```python
.1
```
```python
/logs/}
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
645
```
```python
INFO [main] server
```
```python
.AbstractConnector
```
```python
: Started SelectChannelConnector
```
```python
@0
```
```python
.0
```
```python
.0
```
```python
.0
```
```python
:
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
660
```
```python
INFO [main] http
```
```python
.HttpServer
```
```python
: Started HttpServer[hiveserver2] on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
22
```
```python
:
```
```python
15
```
```python
,
```
```python
660
```
```python
INFO [main] server
```
```python
.HiveServer
```
```python
2: Web UI has started on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
04
```
```python
,
```
```python
804
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] thrift
```
```python
.ThriftCLIService
```
```python
: Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V9
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
732
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Created HDFS directory: /tmp/hive/root/f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
735
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Created local directory: /tmp/root/f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
745
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Created HDFS directory: /tmp/hive/root/f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada/_tmp_space
```
```python
.db
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
748
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.HiveSessionImpl
```
```python
: Operation log session directory is created: /tmp/root/operation_logs/f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
749
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] service
```
```python
.CompositeService
```
```python
: Session opened, SessionHandle [f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada], current sessions:
```
```python
1
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
864
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] conf
```
```python
.HiveConf
```
```python
: Using the default value passed
```
```python
in
```
```python
for log id: f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
864
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Updating thread name to f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
865
```
```python
INFO [f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] conf
```
```python
.HiveConf
```
```python
: Using the default value passed
```
```python
in
```
```python
for log id: f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
865
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Resetting thread name to  HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
883
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] conf
```
```python
.HiveConf
```
```python
: Using the default value passed
```
```python
in
```
```python
for log id: f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
883
```
```python
INFO [f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] conf
```
```python
.HiveConf
```
```python
: Using the default value passed
```
```python
in
```
```python
for log id: f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
883
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Updating thread name to f575ff1d-
```
```python
8
```
```python
cfa-
```
```python
4
```
```python
d94-beb8-bd7365a5bada HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T10:
```
```python
26
```
```python
:
```
```python
05
```
```python
,
```
```python
883
```
```python
INFO [HiveServer2-Handler-Pool: Thread-
```
```python
39
```
```python
] session
```
```python
.SessionState
```
```python
: Resetting thread name to  HiveServer2-Handler-Pool: Thread-
```
```python
39
```
启动失败的日志：
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
117
```
```python
INFO [main] metastore
```
```python
.MetaStoreDirectSql
```
```python
: Using direct SQL, underlying DB is MYSQL
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
119
```
```python
INFO [main] metastore
```
```python
.ObjectStore
```
```python
: Initialized ObjectStore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
215
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: Added admin role
```
```python
in
```
```python
metastore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
217
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: Added public role
```
```python
in
```
```python
metastore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
231
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
: No user is added
```
```python
in
```
```python
admin role, since config is empty
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
368
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: get_all_functions
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
46
```
```python
,
```
```python
371
```
```python
INFO [main] HiveMetaStore
```
```python
.audit
```
```python
: ugi=root      ip=unknown-ip-addr      cmd=get_all_functions
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
422
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: Cleaning up thread local RawStore...
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
423
```
```python
INFO [main] metastore
```
```python
.HiveMetaStore
```
```python
:
```
```python
0
```
```python
: Done cleaning up thread local RawStore
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
825
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:CLIService is inited.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
826
```
```python
INFO [main] server
```
```python
.HiveServer
```
```python
2: Starting Web UI on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
906
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:OperationManager is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
906
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:SessionManager is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
907
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:CLIService is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
907
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:ThriftBinaryCLIService is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
908
```
```python
INFO [main] service
```
```python
.AbstractService
```
```python
: Service:HiveServer2 is started.
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
47
```
```python
,
```
```python
910
```
```python
INFO [main] server
```
```python
.Server
```
```python
: jetty-
```
```python
7.6
```
```python
.0
```
```python
.v
```
```python
20120127
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
48
```
```python
,
```
```python
102
```
```python
INFO [main] server
```
```python
.AbstractConnector
```
```python
: Started SelectChannelConnector
```
```python
@0
```
```python
.0
```
```python
.0
```
```python
.0
```
```python
:
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
48
```
```python
,
```
```python
105
```
```python
INFO [main] server
```
```python
.HiveServer
```
```python
2: Web UI has started on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
40
```
```python
:
```
```python
48
```
```python
,
```
```python
105
```
```python
INFO [main] http
```
```python
.HttpServer
```
```python
: Started HttpServer[hiveserver2] on port
```
```python
10002
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
41
```
```python
:
```
```python
03
```
```python
,
```
```python
343
```
```python
WARN [HiveServer2-Handler-Pool: Thread-
```
```python
43
```
```python
] service
```
```python
.CompositeService
```
```python
: Failed to open session
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
$1
```
```python
.run
```
```python
(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
63
```
```python
)
        at java
```
```python
.security
```
```python
.AccessController
```
```python
.doPrivileged
```
```python
(Native Method)
        at javax
```
```python
.security
```
```python
.auth
```
```python
.Subject
```
```python
.doAs
```
```python
(Subject
```
```python
.java
```
```python
:
```
```python
422
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.UserGroupInformation
```
```python
.doAs
```
```python
(UserGroupInformation
```
```python
.java
```
```python
:
```
```python
1656
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.SessionManager
```
```python
.createSession
```
```python
(SessionManager
```
```python
.java
```
```python
:
```
```python
327
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.SessionManager
```
```python
.openSession
```
```python
(SessionManager
```
```python
.java
```
```python
:
```
```python
279
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.CLIService
```
```python
.openSessionWithImpersonation
```
```python
(CLIService
```
```python
.java
```
```python
:
```
```python
189
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.thrift
```
```python
.ThriftCLIService
```
```python
.getSessionHandle
```
```python
(ThriftCLIService
```
```python
.java
```
```python
:
```
```python
423
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.thrift
```
```python
.ThriftCLIService
```
```python
.OpenSession
```
```python
(ThriftCLIService
```
```python
.java
```
```python
:
```
```python
312
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.rpc
```
```python
.thrift
```
```python
.TCLIService
```
```python
$Processor$OpenSession
```
```python
.getResult
```
```python
(TCLIService
```
```python
.java
```
```python
:
```
```python
1377
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.rpc
```
```python
.thrift
```
```python
.TCLIService
```
```python
$Processor$OpenSession
```
```python
.getResult
```
```python
(TCLIService
```
```python
.java
```
```python
:
```
```python
1362
```
```python
)
        at org
```
```python
.apache
```
```python
.thrift
```
```python
.ProcessFunction
```
```python
.process
```
```python
(ProcessFunction
```
```python
.java
```
```python
:
```
```python
39
```
```python
)
        at org
```
```python
.apache
```
```python
.thrift
```
```python
.TBaseProcessor
```
```python
.process
```
```python
(TBaseProcessor
```
```python
.java
```
```python
:
```
```python
39
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.auth
```
```python
.TSetIpAddressProcessor
```
```python
.process
```
```python
(TSetIpAddressProcessor
```
```python
.java
```
```python
:
```
```python
56
```
```python
)
        at org
```
```python
.apache
```
```python
.thrift
```
```python
.server
```
```python
.TThreadPoolServer
```
```python
$WorkerProcess
```
```python
.run
```
```python
(TThreadPoolServer
```
```python
.java
```
```python
:
```
```python
286
```
```python
)
        at java
```
```python
.util
```
```python
.concurrent
```
```python
.ThreadPoolExecutor
```
```python
.runWorker
```
```python
(ThreadPoolExecutor
```
```python
.java
```
```python
:
```
```python
1149
```
```python
)
        at java
```
```python
.util
```
```python
.concurrent
```
```python
.ThreadPoolExecutor
```
```python
$Worker
```
```python
.run
```
```python
(ThreadPoolExecutor
```
```python
.java
```
```python
:
```
```python
624
```
```python
)
        at java
```
```python
.lang
```
```python
.Thread
```
```python
.run
```
```python
(Thread
```
```python
.java
```
```python
:
```
```python
748
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.start
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
591
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.Client
```
```python
.call
```
```python
(Client
```
```python
.java
```
```python
:
```
```python
1469
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.Client
```
```python
.call
```
```python
(Client
```
```python
.java
```
```python
:
```
```python
1400
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.ProtobufRpcEngine
```
```python
$Invoker
```
```python
.invoke
```
```python
(ProtobufRpcEngine
```
```python
.java
```
```python
:
```
```python
232
```
```python
)
        at
```
```python
com
```
```python
.sun
```
```python
.proxy
```
```python
.$Proxy30
```
```python
.getFileInfo
```
```python
(Unknown Source)
        at sun
```
```python
.reflect
```
```python
.NativeMethodAccessorImpl
```
```python
.invoke
```
```python
0(Native Method)
        at sun
```
```python
.reflect
```
```python
.NativeMethodAccessorImpl
```
```python
.invoke
```
```python
(NativeMethodAccessorImpl
```
```python
.java
```
```python
:
```
```python
62
```
```python
)
        at sun
```
```python
.reflect
```
```python
.DelegatingMethodAccessorImpl
```
```python
.invoke
```
```python
(DelegatingMethodAccessorImpl
```
```python
.java
```
```python
:
```
```python
43
```
```python
)
        at java
```
```python
.lang
```
```python
.reflect
```
```python
.Method
```
```python
.invoke
```
```python
(Method
```
```python
.java
```
```python
:
```
```python
498
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.io
```
```python
.retry
```
```python
.RetryInvocationHandler
```
```python
.invokeMethod
```
```python
(RetryInvocationHandler
```
```python
.java
```
```python
:
```
```python
187
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.io
```
```python
.retry
```
```python
.RetryInvocationHandler
```
```python
.invoke
```
```python
(RetryInvocationHandler
```
```python
.java
```
```python
:
```
```python
102
```
```python
)
        at
```
```python
com
```
```python
.sun
```
```python
.proxy
```
```python
.$Proxy31
```
```python
.getFileInfo
```
```python
(Unknown Source)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hdfs
```
```python
.DFSClient
```
```python
.getFileInfo
```
```python
(DFSClient
```
```python
.java
```
```python
:
```
```python
1977
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hdfs
```
```python
.DistributedFileSystem
```
```python
$18
```
```python
.doCall
```
```python
(DistributedFileSystem
```
```python
.java
```
```python
:
```
```python
1118
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hdfs
```
```python
.DistributedFileSystem
```
```python
.getFileStatus
```
```python
(DistributedFileSystem
```
```python
.java
```
```python
:
```
```python
1114
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.fs
```
```python
.FileSystem
```
```python
.exists
```
```python
(FileSystem
```
```python
.java
```
```python
:
```
```python
1400
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.createRootHDFSDir
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
689
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.createSessionDirs
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
635
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.start
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
563
```
```python
)
        ...
```
```python
28
```
```python
more
```
```python
2018
```
```python
-
```
```python
08
```
```python
-
```
```python
29
```
```python
T09:
```
```python
41
```
```python
:
```
```python
03
```
```python
,
```
```python
350
```
```python
WARN [HiveServer2-Handler-Pool: Thread-
```
```python
43
```
```python
] thrift
```
```python
.ThriftCLIService
```
```python
: Error opening session:
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.SessionManager
```
```python
.createSession
```
```python
(SessionManager
```
```python
.java
```
```python
:
```
```python
336
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.SessionManager
```
```python
.openSession
```
```python
(SessionManager
```
```python
.java
```
```python
:
```
```python
279
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.CLIService
```
```python
.openSessionWithImpersonation
```
```python
(CLIService
```
```python
.java
```
```python
:
```
```python
189
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.thrift
```
```python
.ThriftCLIService
```
```python
.getSessionHandle
```
```python
(ThriftCLIService
```
```python
.java
```
```python
:
```
```python
423
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.rpc
```
```python
.thrift
```
```python
.TCLIService
```
```python
$Processor$OpenSession
```
```python
.getResult
```
```python
(TCLIService
```
```python
.java
```
```python
:
```
```python
1362
```
```python
)
        at org
```
```python
.apache
```
```python
.thrift
```
```python
.ProcessFunction
```
```python
.process
```
```python
(ProcessFunction
```
```python
.java
```
```python
:
```
```python
39
```
```python
)
        at org
```
```python
.apache
```
```python
.thrift
```
```python
.TBaseProcessor
```
```python
.process
```
```python
(TBaseProcessor
```
```python
.java
```
```python
:
```
```python
39
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.auth
```
```python
.TSetIpAddressProcessor
```
```python
.process
```
```python
(TSetIpAddressProcessor
```
```python
.java
```
```python
:
```
```python
56
```
```python
)
        at java
```
```python
.util
```
```python
.concurrent
```
```python
.ThreadPoolExecutor
```
```python
$Worker
```
```python
.run
```
```python
(ThreadPoolExecutor
```
```python
.java
```
```python
:
```
```python
624
```
```python
)
        at java
```
```python
.lang
```
```python
.Thread
```
```python
.run
```
```python
(Thread
```
```python
.java
```
```python
:
```
```python
748
```
```python
)
Caused by: java
```
```python
.lang
```
```python
.RuntimeException
```
```python
: java
```
```python
.lang
```
```python
.RuntimeException
```
```python
: org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.RemoteException
```
```python
(org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.authorize
```
```python
.AuthorizationException
```
```python
): User: root is not allowed to impersonate root
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
.invoke
```
```python
(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
89
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
.access
```
```python
$000(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
36
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
$1
```
```python
.run
```
```python
(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
63
```
```python
)
        at java
```
```python
.security
```
```python
.AccessController
```
```python
.doPrivileged
```
```python
(Native Method)
        at javax
```
```python
.security
```
```python
.auth
```
```python
.Subject
```
```python
.doAs
```
```python
(Subject
```
```python
.java
```
```python
:
```
```python
422
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.UserGroupInformation
```
```python
.doAs
```
```python
(UserGroupInformation
```
```python
.java
```
```python
:
```
```python
1656
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
.invoke
```
```python
(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
59
```
```python
)
        at
```
```python
com
```
```python
.sun
```
```python
.proxy
```
```python
.$Proxy37
```
```python
.open
```
```python
(Unknown Source)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.SessionManager
```
```python
.createSession
```
```python
(SessionManager
```
```python
.java
```
```python
:
```
```python
327
```
```python
)
        ...
```
```python
13
```
```python
more
Caused by: java
```
```python
.lang
```
```python
.RuntimeException
```
```python
: org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.RemoteException
```
```python
(org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.authorize
```
```python
.AuthorizationException
```
```python
): User: root is not allowed to impersonate root
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.start
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
591
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hive
```
```python
.ql
```
```python
.session
```
```python
.SessionState
```
```python
.start
```
```python
(SessionState
```
```python
.java
```
```python
:
```
```python
526
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionImpl
```
```python
.open
```
```python
(HiveSessionImpl
```
```python
.java
```
```python
:
```
```python
168
```
```python
)
        at sun
```
```python
.reflect
```
```python
.NativeMethodAccessorImpl
```
```python
.invoke
```
```python
0(Native Method)
        at sun
```
```python
.reflect
```
```python
.NativeMethodAccessorImpl
```
```python
.invoke
```
```python
(NativeMethodAccessorImpl
```
```python
.java
```
```python
:
```
```python
62
```
```python
)
        at sun
```
```python
.reflect
```
```python
.DelegatingMethodAccessorImpl
```
```python
.invoke
```
```python
(DelegatingMethodAccessorImpl
```
```python
.java
```
```python
:
```
```python
43
```
```python
)
        at java
```
```python
.lang
```
```python
.reflect
```
```python
.Method
```
```python
.invoke
```
```python
(Method
```
```python
.java
```
```python
:
```
```python
498
```
```python
)
        at org
```
```python
.apache
```
```python
.hive
```
```python
.service
```
```python
.cli
```
```python
.session
```
```python
.HiveSessionProxy
```
```python
.invoke
```
```python
(HiveSessionProxy
```
```python
.java
```
```python
:
```
```python
78
```
```python
)
        ...
```
```python
21
```
```python
more
Caused by: org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.RemoteException
```
```python
(org
```
```python
.apache
```
```python
.hadoop
```
```python
.security
```
```python
.authorize
```
```python
.AuthorizationException
```
```python
): User: root is not allowed to impersonate root
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.Client
```
```python
.call
```
```python
(Client
```
```python
.java
```
```python
:
```
```python
1469
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.Client
```
```python
.call
```
```python
(Client
```
```python
.java
```
```python
:
```
```python
1400
```
```python
)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.ipc
```
```python
.ProtobufRpcEngine
```
```python
$Invoker
```
```python
.invoke
```
```python
(ProtobufRpcEngine
```
```python
.java
```
```python
:
```
```python
232
```
```python
)
        at
```
```python
com
```
```python
.sun
```
```python
.proxy
```
```python
.$Proxy30
```
```python
.getFileInfo
```
```python
(Unknown Source)
        at org
```
```python
.apache
```
```python
.hadoop
```
```python
.hdfs
```
```python
.protocolPB
```
```python
.ClientNamenodeProtocolTranslatorPB
```
```python
.getFileInfo
```
```python
(ClientNamenodeProtocolTranslatorPB
```
```python
.java
```
```python
:
```
```python
752
```
```python
)
        at sun
```
```python
.reflect
```
```python
.NativeMethodAccessorImpl
```
```python
.invoke
```
```python
0(Native Method)
```
最后一对比，发现正常链接的日志中有对HDFS某目录的操作，失败的则没有，如下图所示：
![这里写图片描述](https://img-blog.csdn.net/20180829174404162?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180829174404162?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
所以推测是用户权限的问题（只怪自己不懂内部运行机制，只能这样猜了。。）
于是自己又更改了HDFS中对应的/tmp文件更改权限：
```python
hadoop fs
```
```python
-chmod
```
```python
-r
```
```python
777
```
```python
/tmp
```
后来发现依旧不行。。。。
此刻博主被折磨的不行不行了。。。不过还得接着解决，不然公司的小姐姐就没法接下来的工作，深刻对比了两个集群的状态后（虚拟机和生产集群），突然发现生产中启动hiveserver2的节点的namenode状态为standy(搭建的是HA机制的集群有两个namenode，一个为active状态，一个为standy，standy状态的节点没有对HDFS的操作权限。PS：即使read的权限也没有，毕竟两个namenode只有一个掌控对应的HDFS的权限)，而虚拟机中启动hiveserver2的节点的状态为Active。于是感觉希望又来了，果断kill掉生产中对应的active状态的namenode，这样standy状态的namenode也就转化为active状态也就有了操作HDFS的权限，操作过后，总算大功告成，连接生效。
## 总结：
其实整个过程只要把第一步的超级代理用户配置好，然后在最后一步的启动hiveserver2的NameNode（我们这里称为ha1）的状态改为active状态应该就OK了，因为这样你就能用ha1在hadoop环境下的root用户去操作HDFS，即使这里再出现用户权限不足的问题，那我们可以接着修改对应的文件的访问权限。而当另一个namenode为active状态，ha1为standy状态时，我们就无法用ha1下的root用户去访问HDFS，所以也就造成启动日志中，一直无法加载生成对应的HDFS文件。
其他一些不错的参考：
[https://blog.csdn.net/sunnyyoona/article/details/51648871](https://blog.csdn.net/sunnyyoona/article/details/51648871)
[http://debugo.com/beeline-invalid-url/](http://debugo.com/beeline-invalid-url/)
[https://blog.csdn.net/yunyexiangfeng/article/details/60867563](https://blog.csdn.net/yunyexiangfeng/article/details/60867563)

