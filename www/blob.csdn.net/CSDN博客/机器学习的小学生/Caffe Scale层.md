
# Caffe Scale层 - 机器学习的小学生 - CSDN博客


2018年05月08日 19:31:27[机器学习的小学生](https://me.csdn.net/xuluhui123)阅读数：2237


如果我们想原封不动的传送数据，也就是说建一个不做任何操作仅穿数据的层，可以利用Scale层，Python中写法如下：
```python
n
```
```python
.
```
```python
scale1
```
```python
=
```
```python
L
```
```python
.
```
```python
Scale
```
```python
(
```
```python
n
```
```python
.
```
```python
pool2
```
```python
,
```
```python
name
```
```python
=
```
```python
'scale1'
```
```python
,
```
```python
param
```
```python
=
```
```python
dict
```
```python
(
```
```python
lr_mult
```
```python
=
```
```python
0
```
```python
)
```
```python
,
```
```python
filler
```
```python
=
```
```python
dict
```
```python
(
```
```python
type
```
```python
=
```
```python
"constant"
```
```python
,
```
```python
value
```
```python
=
```
```python
1
```
```python
)
```
```python
)
```
生成的prototxt协议文件如下：
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"scale1"
```
```python
type
```
```python
:
```
```python
"Scale"
```
```python
bottom
```
```python
:
```
```python
"pool2"
```
```python
top
```
```python
:
```
```python
"scale1"
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
0
```
```python
}
```
```python
scale_param
```
```python
{
```
```python
filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
value
```
```python
:
```
```python
1
```
```python
}
```
```python
}
```
```python
}
```
功能： 使用scale_layer乘以一个标量0.01。
test_scale_layer.py
```python
#coding=UTF-8
```
```python
import
```
```python
numpy
```
```python
as
```
```python
np
```
```python
import
```
```python
caffe
```
```python
# weight_file can be any prtrained models
```
```python
weight_file
```
```python
=
```
```python
'../attention_network/snapshots_aflw_vgg16_klLoss_finetune_attention1/cross1/vgg_iter_10000.caffemodel'
```
```python
deploy_file
```
```python
=
```
```python
'scale_deploy.prototxt'
```
```python
net
```
```python
=
```
```python
caffe
```
```python
.
```
```python
Net
```
```python
(
```
```python
deploy_file
```
```python
,
```
```python
weight_file
```
```python
,
```
```python
caffe
```
```python
.
```
```python
TEST
```
```python
)
```
```python
arr0
```
```python
=
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
[
```
```python
[
```
```python
11
```
```python
,
```
```python
12
```
```python
,
```
```python
13
```
```python
]
```
```python
,
```
```python
[
```
```python
21
```
```python
,
```
```python
22
```
```python
,
```
```python
23
```
```python
]
```
```python
]
```
```python
)
```
```python
# w11 w12 w13 for sample1, w21 w22 w23 for sample2
```
```python
print
```
```python
(
```
```python
arr0
```
```python
.
```
```python
shape
```
```python
)
```
```python
# (2,3),2 stand for sample, 3 stand for channel
```
```python
print
```
```python
(
```
```python
arr0
```
```python
)
```
```python
arr
```
```python
=
```
```python
np
```
```python
.
```
```python
reshape
```
```python
(
```
```python
arr0
```
```python
,
```
```python
(
```
```python
arr0
```
```python
.
```
```python
shape
```
```python
[
```
```python
0
```
```python
]
```
```python
,
```
```python
arr0
```
```python
.
```
```python
shape
```
```python
[
```
```python
1
```
```python
]
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
)
```
```python
)
```
```python
net
```
```python
.
```
```python
blobs
```
```python
[
```
```python
'Features'
```
```python
]
```
```python
.
```
```python
data
```
```python
[
```
```python
.
```
```python
.
```
```python
.
```
```python
]
```
```python
=
```
```python
arr 
net
```
```python
.
```
```python
forward
```
```python
(
```
```python
)
```
```python
feat
```
```python
=
```
```python
net
```
```python
.
```
```python
blobs
```
```python
[
```
```python
'scale'
```
```python
]
```
```python
.
```
```python
data
```
```python
print
```
```python
(
```
```python
'scale: '
```
```python
,
```
```python
feat
```
```python
.
```
```python
shape
```
```python
)
```
```python
print
```
```python
(
```
```python
feat
```
```python
)
```
scale_deploy.prototxt
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"data"
```
```python
type
```
```python
:
```
```python
"Input"
```
```python
top
```
```python
:
```
```python
"Features"
```
```python
input_param
```
```python
{
```
```python
shape
```
```python
{
```
```python
dim
```
```python
:
```
```python
2
```
```python
dim
```
```python
:
```
```python
3
```
```python
dim
```
```python
:
```
```python
1
```
```python
dim
```
```python
:
```
```python
1
```
```python
}
```
```python
}
```
```python
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"scale_layer"
```
```python
type
```
```python
:
```
```python
"Scale"
```
```python
bottom
```
```python
:
```
```python
"Features"
```
```python
top
```
```python
:
```
```python
"scale"
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
0
```
```python
}
```
```python
scale_param
```
```python
{
```
```python
filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
value
```
```python
:
```
```python
0.01
```
```python
}
```
```python
}
```
```python
}
```

