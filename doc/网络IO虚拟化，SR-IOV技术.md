#  			[网络I/O虚拟化，SR-IOV技术](https://www.cnblogs.com/echo1937/p/7519079.html) 		



# 1、简介

网络I/O虚拟化是服务器虚拟化技术的重要组成部分，在服务器虚拟化技术领域，计算虚拟化（如CPU和内存虚拟化）已经日趋成熟，但是，网络I/O虚拟化技术的发展相对比较滞后。当前，主流的网络I/O虚拟化技术有三种：软件模拟、网卡直通和SR-IOV。这三种虚拟化技术在不同程度上实现了网络I/O设备的虚拟化功能。其中，软件模拟是通过虚拟化Hypervisor层模拟虚拟网卡，实现与物理设备完全一样的接口，虚拟机操作系统无须修改就能直接驱动虚拟网卡，其最大的缺点是性能相对较差；网卡直通支持虚拟机绕过Hypervisor层，直接访问物理I/O设备，具有最高的性能，但是，在同一时刻，物理I/O设备只能被一个虚拟机独享；SR-IOV是Intel在2007年提出的解决虚拟化网络I/O的硬件技术方案，该技术不仅能够继承网卡直通的高性能优势，而且同时支持物理I/O设备的跨虚拟机共享，具有较好的应用前景。

2007年10月，PCI-SIG发布了PCI-SIG Single Root I/O Virtualization（SR-IOV）规范，其中详细阐述了硬件供应商在多个虚拟机中如何共享单个I/O设备硬件。

[![图1 硬件SR-IOV虚拟化技术原理图](http://7xnzbp.com2.z0.glb.qiniucdn.com/wp-content/uploads/2015/10/%E5%9B%BE1-%E7%A1%AC%E4%BB%B6SR-IOV%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%9B%BE.png)](http://7xnzbp.com2.z0.glb.qiniucdn.com/wp-content/uploads/2015/10/%E5%9B%BE1-%E7%A1%AC%E4%BB%B6SR-IOV%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%9B%BE.png)

图1 硬件SR-IOV虚拟化技术原理图

SR-IOV引入了两个新的功能类型：

- PFs（Physical Functions，物理功能）：物理网卡所支持的一项PCI功能，一个PF可以扩展出若干个VF。
- VFs（Virtual Functions，虚拟功能）：支持SR-IOV的物理网卡虚拟出来的实例，以一个独立网卡的形式呈现，每个VF有独立的PCI配置区域，并可以与其它VF共享同一个物理资源（共用同一个物理网口）。

一旦在PF中启用了SR-IOV，就可以通过PF的总线、设备和功能编号（路由ID）访问各个VF的PCIe配置空间。每个VF都具有一个PCIe内存空间，用于映射其寄存器集。VF设备驱动程序对寄存器集进行操作以启用其功能，并且显示为实际存在的PCIe设备。创建VF后，可以直接将其指定给I/O来宾域或各个应用程序。此功能使得虚拟功能可以共享物理设备，并在没有CPU和虚拟机管理程序软件开销的情况下执行I/O。

由此可见，SR-IOV网卡通过将SR-IOV功能集成到物理网卡上，将单一的物理网卡虚拟成多个VF接口，每个VF接口都有单独的虚拟PCIe通道，这些虚拟的PCIe通道共用物理网卡的PCIe通道。每个虚拟机可占用一个或多个VF接口，这样虚拟机就可以直接访问自己的VF接口，而不需要Hypervisor的协调干预，从而大幅提升网络吞吐性能。
需要注意的是，SR-IOV作为一种新技术，目前仍不完善的地方：

- 单个物理网卡支持的虚拟机个数有限制；
- SR-IOV特性需要物理网卡硬件支持，并非所有的物理网卡都支持SR-IOV特性。

 

资源链接：http://www.sdnlab.com/14403.html