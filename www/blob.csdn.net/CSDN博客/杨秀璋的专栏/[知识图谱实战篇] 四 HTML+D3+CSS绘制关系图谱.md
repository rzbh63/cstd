
# [知识图谱实战篇] 四.HTML+D3+CSS绘制关系图谱 - 杨秀璋的专栏 - CSDN博客

2019年02月12日 17:40:52[Eastmount](https://me.csdn.net/Eastmount)阅读数：536所属专栏：[知识图谱、web数据挖掘及NLP](https://blog.csdn.net/column/details/eastmount-kgdmnlp.html)[HTML网站前端设计](https://blog.csdn.net/column/details/13444.html)



前面作者讲解了很多知识图谱原理知识，包括知识图谱相关技术、Neo4j绘制关系图谱等，但仍缺少一个系统全面的实例。为了加深自己对知识图谱构建的认识，为后续创建贵州旅游知识图谱打下基础，作者深入学习了张宏伦老师的网易云课程（[星球系列电影](https://study.163.com/course/courseLearn.htm?courseId=1003528010)），并结合自己的理解和技术分享了该系列专栏，从数据采集、数据展示、数据分析到知识图谱构建，文章后续还会讲解中文数据的实体识别、关系抽取、知识计算等。
前文介绍了Python3抓取电影实体知识，Seaborn可视化展示电影信息，D3可视化布局。本文着重构建知识图谱，通过D3显示已获取的节点和关系图谱。
代码下载地址：[https://download.csdn.net/download/eastmount/10954282](https://download.csdn.net/download/eastmount/10954282)
这是一系列基础性文章，希望对您有所帮助 ，尤其是对知识图谱感兴趣和编程刚入门的同学。同时也因为最近准备博士考试，做题做吐了，写点新东西调节下心情，与君共勉，一起加油。
**前文：**
[[知识图谱实战篇] 一.数据抓取之Python3抓取JSON格式的电影实体](https://blog.csdn.net/eastmount/article/details/86714051)
[[知识图谱实战篇] 二.Json+Seaborn可视化展示电影实体](https://blog.csdn.net/Eastmount/article/details/86739154)
[[知识图谱实战篇] 三.Python提取JSON数据、HTML+D3构建基本可视化布局](https://blog.csdn.net/Eastmount/article/details/86755610)

### 文章目录
[一.前文回顾](#_43)
[二.D3设置节点和关系](#D3_72)
[三.CSS设置节点样式](#CSS_433)

**推荐作者的知识图谱前文：**
[知识图谱相关会议之观后感分享与学习总结](https://blog.csdn.net/Eastmount/article/details/46672701)
[中文知识图谱研讨会的学习总结 (上) 图谱引入、百度知心、搜狗知立方](https://blog.csdn.net/Eastmount/article/details/49785639)
[搜索引擎和知识图谱那些事 (上).基础篇](https://blog.csdn.net/Eastmount/article/details/46874155)
[基于VSM的命名实体识别、歧义消解和指代消解](https://blog.csdn.net/Eastmount/article/details/48566671)
[CSDN下载-第一届全国中文知识图谱研讨会演讲PPT 清华大学](https://download.csdn.net/download/eastmount/9255871)
[CSDN下载-知识图谱PDF资料 清华大学知识图谱研讨会汇报PPT](https://download.csdn.net/download/eastmount/9159689)
[[知识图谱构建] 一.Neo4j图数据库安装初识及药材供应图谱实例](https://blog.csdn.net/Eastmount/article/details/83268410)
[[知识图谱构建] 二.《Neo4j基础入门》基础学习之创建图数据库节点及关系](https://blog.csdn.net/Eastmount/article/details/85093828)
[[关系图谱] 一.Gephi通过共线矩阵构建知网作者关系图谱](https://blog.csdn.net/Eastmount/article/details/81746650)
[[关系图谱] 二.Gephi导入共线矩阵构建作者关系图谱](https://blog.csdn.net/Eastmount/article/details/85046305)
再次强烈推荐大家阅读张宏伦老师的网易云课程及Github源码，受益匪浅。
[https://github.com/Honlan/starwar-visualization/tree/master/star_war](https://github.com/Honlan/starwar-visualization/tree/master/star_war)
[https://study.163.com/course/courseLearn.htm?courseId=1003528010](https://study.163.com/course/courseLearn.htm?courseId=1003528010)
---

# 一.前文回顾
前文已经讲解D3获取JSON数据，包括节点和边，如下所示。注意，需要将JSON和HTML文件放置服务器中，作者本地服务器使用的是Apache（WAMP）。
![](https://img-blog.csdnimg.cn/20190212173631847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190212173631847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)![](https://img-blog.csdnimg.cn/20190212173651427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190212173651427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)本文主要讲解如何生成关系图谱，其最终生成的效果图如下所示：
![](https://img-blog.csdnimg.cn/20190212170153248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190212170153248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)D3是基于数据的文档操作javascript库，D3能够把数据和HTML、SVG、CSS结合起来，创造出可交互的数据图表。D3 （Data-Driven Documents）是基于数据的文档操作javascript库，D3能够把数据和HTML、SVG、CSS结合起来，创造出可交互的数据图表。
![](https://img-blog.csdnimg.cn/20190203005739151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190203005739151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)
---

# 二.D3设置节点和关系
核心代码如下：
**1.定义函数获取JSON数据**
定义d3.json请求python处理好的节点及边 请求成功返回数据，否则报错，利用console.log(graph)输出获取的JSON数据结果。
```python
d3.json("starwar_alldata.json", function(error, data) {
	    	if(error) throw error;
	    	graph = data;
	    	console.log(graph);
}
```
**2.添加节点和关系**
通过D3映射数据至HTML中，svg.append(“g”)定义g用于绘制所有边和节点，selectAll()选中所有的line，并绑定数据data(graph.links)，enter().append(“line”)添加元素，再设置各属性。如attr(“r”, function(d){})设置节点直径，.attr(“fill”, function(d) { return colors[d.group];})填充颜色，.call(d3.drag(){})设置拖动开始、拖动进行和拖动结束的函数。
```python
<
```
```python
script
```
```python
type
```
```python
=
```
```python
"
```
```python
text/javascript
```
```python
"
```
```python
>
```
```python
//定义d3.json请求python处理好的节点及边 请求成功返回数据，否则报错
```
```python
d3
```
```python
.
```
```python
json
```
```python
(
```
```python
"starwar_alldata.json"
```
```python
,
```
```python
function
```
```python
(
```
```python
error
```
```python
,
```
```python
data
```
```python
)
```
```python
{
```
```python
if
```
```python
(
```
```python
error
```
```python
)
```
```python
throw
```
```python
error
```
```python
;
```
```python
graph
```
```python
=
```
```python
data
```
```python
;
```
```python
console
```
```python
.
```
```python
log
```
```python
(
```
```python
graph
```
```python
)
```
```python
;
```
```python
//绘制所有边
```
```python
var
```
```python
link
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"links"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"line"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
links
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"line"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"stroke-width"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
//return Math.sqrt(d.value);
```
```python
return
```
```python
1
```
```python
;
```
```python
//所有线宽度均为1
```
```python
}
```
```python
)
```
```python
;
```
```python
//添加所有的点
```
```python
var
```
```python
node
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"nodes"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"circle"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"circle"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"r"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
size
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"fill"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
colors
```
```python
[
```
```python
d
```
```python
.
```
```python
group
```
```python
]
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"stroke"
```
```python
,
```
```python
"none"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"name"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
call
```
```python
(
```
```python
d3
```
```python
.
```
```python
drag
```
```python
(
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"start"
```
```python
,
```
```python
dragstarted
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"drag"
```
```python
,
```
```python
dragged
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"end"
```
```python
,
```
```python
dragended
```
```python
)
```
```python
)
```
```python
;
```
```python
//显示所有的文本
```
```python
var
```
```python
text
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"texts"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"text"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"text"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"font-size"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
size
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"fill"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
colors
```
```python
[
```
```python
d
```
```python
.
```
```python
group
```
```python
]
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
'name'
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
text
```
```python
(
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
'text-anchor'
```
```python
,
```
```python
'middle'
```
```python
)
```
```python
.
```
```python
call
```
```python
(
```
```python
d3
```
```python
.
```
```python
drag
```
```python
(
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"start"
```
```python
,
```
```python
dragstarted
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"drag"
```
```python
,
```
```python
dragged
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"end"
```
```python
,
```
```python
dragended
```
```python
)
```
```python
)
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
</
```
```python
script
```
```python
>
```
**3.在d3.json()中定义simulation()和ticked()函数确定link线的起始点x、y坐标，node中心点，文本通过translate平移变化。**
```python
<
```
```python
script
```
```python
type
```
```python
=
```
```python
"
```
```python
text/javascript
```
```python
"
```
```python
>
```
```python
//simulation中ticked数据初始化并生成图形
```
```python
simulation
```
```python
.
```
```python
nodes
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"tick"
```
```python
,
```
```python
ticked
```
```python
)
```
```python
;
```
```python
simulation
```
```python
.
```
```python
force
```
```python
(
```
```python
"link"
```
```python
)
```
```python
.
```
```python
links
```
```python
(
```
```python
graph
```
```python
.
```
```python
links
```
```python
)
```
```python
;
```
```python
//ticked()函数确定link线的起始点x、y坐标 node确定中心点 文本通过translate平移变化
```
```python
function
```
```python
ticked
```
```python
(
```
```python
)
```
```python
{
```
```python
link
```
```python
.
```
```python
attr
```
```python
(
```
```python
"x1"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
source
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"y1"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
source
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"x2"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
target
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"y2"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
target
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
node
```
```python
.
```
```python
attr
```
```python
(
```
```python
"cx"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"cy"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
text
```
```python
.
```
```python
attr
```
```python
(
```
```python
'transform'
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
'translate('
```
```python
+
```
```python
d
```
```python
.
```
```python
x
```
```python
+
```
```python
','
```
```python
+
```
```python
(
```
```python
d
```
```python
.
```
```python
y
```
```python
+
```
```python
d
```
```python
.
```
```python
size
```
```python
/
```
```python
2
```
```python
)
```
```python
+
```
```python
')'
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
</
```
```python
script
```
```python
>
```
**4.最后定义拖动函数dragstarted(d)、function dragged(d)、function dragended(d)。**
**完整代码如下所示：**
```python
<!DOCTYPE html>
```
```python
<
```
```python
html
```
```python
>
```
```python
<
```
```python
head
```
```python
>
```
```python
<
```
```python
meta
```
```python
charset
```
```python
=
```
```python
"
```
```python
UTF-8
```
```python
"
```
```python
/>
```
```python
<
```
```python
meta
```
```python
http-equiv
```
```python
=
```
```python
"
```
```python
X-UA-Compatible
```
```python
"
```
```python
content
```
```python
=
```
```python
"
```
```python
IE=edge
```
```python
"
```
```python
>
```
```python
<
```
```python
meta
```
```python
name
```
```python
=
```
```python
"
```
```python
viewport
```
```python
"
```
```python
content
```
```python
=
```
```python
"
```
```python
width=device-width, initial-scale=1
```
```python
"
```
```python
>
```
```python
<
```
```python
title
```
```python
>
```
```python
知识图谱
```
```python
</
```
```python
title
```
```python
>
```
```python
<
```
```python
meta
```
```python
name
```
```python
=
```
```python
"
```
```python
description
```
```python
"
```
```python
content
```
```python
=
```
```python
"
```
```python
"
```
```python
/>
```
```python
<
```
```python
meta
```
```python
name
```
```python
=
```
```python
"
```
```python
keywords
```
```python
"
```
```python
content
```
```python
=
```
```python
"
```
```python
"
```
```python
/>
```
```python
<
```
```python
meta
```
```python
name
```
```python
=
```
```python
"
```
```python
author
```
```python
"
```
```python
content
```
```python
=
```
```python
"
```
```python
"
```
```python
/>
```
```python
<
```
```python
link
```
```python
rel
```
```python
=
```
```python
"
```
```python
shortcut icon
```
```python
"
```
```python
href
```
```python
=
```
```python
"
```
```python
"
```
```python
>
```
```python
<
```
```python
script
```
```python
src
```
```python
=
```
```python
"
```
```python
http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js
```
```python
"
```
```python
>
```
```python
</
```
```python
script
```
```python
>
```
```python
<
```
```python
link
```
```python
href
```
```python
=
```
```python
"
```
```python
http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css
```
```python
"
```
```python
rel
```
```python
=
```
```python
"
```
```python
stylesheet
```
```python
"
```
```python
>
```
```python
<
```
```python
script
```
```python
src
```
```python
=
```
```python
"
```
```python
http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js
```
```python
"
```
```python
>
```
```python
</
```
```python
script
```
```python
>
```
```python
</
```
```python
head
```
```python
>
```
```python
<
```
```python
style
```
```python
type
```
```python
=
```
```python
"
```
```python
text/css
```
```python
"
```
```python
>
```
```python
body
```
```python
{
```
```python
background-color
```
```python
:
```
```python
#272b30
```
```python
;
```
```python
padding
```
```python
:
```
```python
30px 40px
```
```python
;
```
```python
text-align
```
```python
:
```
```python
center
```
```python
;
```
```python
font-family
```
```python
:
```
```python
OpenSans-Light, PingFang SC, Hiragino Sans GB, Microsoft Yahei, Microsoft Jhenghei, sans-serif
```
```python
;
```
```python
}
```
```python
#indicator
```
```python
{
```
```python
position
```
```python
:
```
```python
absolute
```
```python
;
```
```python
left
```
```python
:
```
```python
60px
```
```python
;
```
```python
bottom
```
```python
:
```
```python
120px
```
```python
;
```
```python
text-align
```
```python
:
```
```python
left
```
```python
;
```
```python
color
```
```python
:
```
```python
#f2f2f2
```
```python
;
```
```python
font-size
```
```python
:
```
```python
12px
```
```python
;
```
```python
}
```
```python
#indicator>div
```
```python
{
```
```python
margin-bottom
```
```python
:
```
```python
4px
```
```python
;
```
```python
}
```
```python
#indicator span
```
```python
{
```
```python
display
```
```python
:
```
```python
inline-block
```
```python
;
```
```python
width
```
```python
:
```
```python
30px
```
```python
;
```
```python
height
```
```python
:
```
```python
14px
```
```python
;
```
```python
position
```
```python
:
```
```python
relative
```
```python
;
```
```python
top
```
```python
:
```
```python
2px
```
```python
;
```
```python
margin-right
```
```python
:
```
```python
8px
```
```python
;
```
```python
}
```
```python
</
```
```python
style
```
```python
>
```
```python
<
```
```python
body
```
```python
>
```
```python
<!-- 绘制标题样式 -->
```
```python
<
```
```python
h1
```
```python
style
```
```python
="
```
```python
color
```
```python
:
```
```python
#fff
```
```python
;
```
```python
font-size
```
```python
:
```
```python
32px
```
```python
;
```
```python
margin-bottom
```
```python
:
```
```python
0px
```
```python
;
```
```python
text-align
```
```python
:
```
```python
center
```
```python
;
```
```python
margin-left
```
```python
:
```
```python
40px
```
```python
;
```
```python
"
```
```python
>
```
```python
Star Wars
```
```python
</
```
```python
h1
```
```python
>
```
```python
<!-- 第一个布局 绘制知识图谱主图 -->
```
```python
<
```
```python
div
```
```python
style
```
```python
="
```
```python
text-align
```
```python
:
```
```python
center
```
```python
;
```
```python
position
```
```python
:
```
```python
relative
```
```python
;
```
```python
"
```
```python
>
```
```python
<
```
```python
svg
```
```python
width
```
```python
=
```
```python
"
```
```python
800
```
```python
"
```
```python
height
```
```python
=
```
```python
"
```
```python
560
```
```python
"
```
```python
style
```
```python
="
```
```python
margin-right
```
```python
:
```
```python
80px
```
```python
;
```
```python
margin-bottom
```
```python
:
```
```python
-40px
```
```python
;
```
```python
"
```
```python
id
```
```python
=
```
```python
"
```
```python
svg1
```
```python
"
```
```python
>
```
```python
</
```
```python
svg
```
```python
>
```
```python
<!-- 绘制图例 -->
```
```python
<
```
```python
div
```
```python
id
```
```python
=
```
```python
"
```
```python
indicator
```
```python
"
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
<!-- 绘制模式选择 -->
```
```python
<
```
```python
div
```
```python
id
```
```python
=
```
```python
"
```
```python
mode
```
```python
"
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
<!-- 绘制搜索框 -->
```
```python
<
```
```python
div
```
```python
id
```
```python
=
```
```python
"
```
```python
search
```
```python
"
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
<!-- 绘制右边显示结果 -->
```
```python
<
```
```python
div
```
```python
id
```
```python
=
```
```python
"
```
```python
info
```
```python
"
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
<!-- 第二个布局 下部分时间点 文本居中 相对定位-->
```
```python
<
```
```python
div
```
```python
style
```
```python
="
```
```python
text-align
```
```python
:
```
```python
center
```
```python
;
```
```python
position
```
```python
:
```
```python
relative
```
```python
;
```
```python
"
```
```python
>
```
```python
<
```
```python
svg
```
```python
width
```
```python
=
```
```python
"
```
```python
960
```
```python
"
```
```python
height
```
```python
=
```
```python
"
```
```python
240
```
```python
"
```
```python
style
```
```python
="
```
```python
margin-right
```
```python
:
```
```python
60px
```
```python
;
```
```python
margin-bottom
```
```python
:
```
```python
-40px
```
```python
;
```
```python
"
```
```python
id
```
```python
=
```
```python
"
```
```python
svg1
```
```python
"
```
```python
>
```
```python
<
```
```python
g
```
```python
>
```
```python
</
```
```python
g
```
```python
>
```
```python
</
```
```python
svg
```
```python
>
```
```python
</
```
```python
div
```
```python
>
```
```python
</
```
```python
body
```
```python
>
```
```python
<!-- 增加D3元素库 -->
```
```python
<
```
```python
script
```
```python
src
```
```python
=
```
```python
"
```
```python
https://d3js.org/d3.v4.min.js
```
```python
"
```
```python
>
```
```python
</
```
```python
script
```
```python
>
```
```python
<!-- 补充JS代码 -->
```
```python
<
```
```python
script
```
```python
type
```
```python
=
```
```python
"
```
```python
text/javascript
```
```python
"
```
```python
>
```
```python
$
```
```python
(
```
```python
document
```
```python
)
```
```python
.
```
```python
ready
```
```python
(
```
```python
function
```
```python
(
```
```python
)
```
```python
{
```
```python
//定义svg变量将布局svg1选出来
```
```python
var
```
```python
svg
```
```python
=
```
```python
d3
```
```python
.
```
```python
select
```
```python
(
```
```python
"#svg1"
```
```python
)
```
```python
,
```
```python
width
```
```python
=
```
```python
svg
```
```python
.
```
```python
attr
```
```python
(
```
```python
"width"
```
```python
)
```
```python
,
```
```python
height
```
```python
=
```
```python
svg
```
```python
.
```
```python
attr
```
```python
(
```
```python
"height"
```
```python
)
```
```python
;
```
```python
//定义name变量制作图标
```
```python
var
```
```python
names
```
```python
=
```
```python
[
```
```python
'Films'
```
```python
,
```
```python
'Characters'
```
```python
,
```
```python
'Planets'
```
```python
,
```
```python
'Starships'
```
```python
,
```
```python
'Vehicles'
```
```python
,
```
```python
'Species'
```
```python
]
```
```python
;
```
```python
var
```
```python
colors
```
```python
=
```
```python
[
```
```python
'#6ca46c'
```
```python
,
```
```python
'#4e88af'
```
```python
,
```
```python
'#ca635f'
```
```python
,
```
```python
'#d2907c'
```
```python
,
```
```python
'#d6744d'
```
```python
,
```
```python
'#ded295'
```
```python
]
```
```python
;
```
```python
//背景颜色设置 补充CSS样式设置字体布局
```
```python
for
```
```python
(
```
```python
var
```
```python
i
```
```python
=
```
```python
0
```
```python
;
```
```python
i
```
```python
<
```
```python
names
```
```python
.
```
```python
length
```
```python
;
```
```python
i
```
```python
++
```
```python
)
```
```python
{
```
```python
$
```
```python
(
```
```python
'#indicator'
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"<div><span style='background-color:"
```
```python
+
```
```python
colors
```
```python
[
```
```python
i
```
```python
]
```
```python
+
```
```python
"'></span>"
```
```python
+
```
```python
names
```
```python
[
```
```python
i
```
```python
]
```
```python
+
```
```python
"</div>"
```
```python
)
```
```python
;
```
```python
}
```
```python
//利用d3.forceSimulation()定义关系图 包括设置边link、排斥电荷charge、关系图中心点
```
```python
var
```
```python
simulation
```
```python
=
```
```python
d3
```
```python
.
```
```python
forceSimulation
```
```python
(
```
```python
)
```
```python
.
```
```python
force
```
```python
(
```
```python
"link"
```
```python
,
```
```python
d3
```
```python
.
```
```python
forceLink
```
```python
(
```
```python
)
```
```python
.
```
```python
id
```
```python
(
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
)
```
```python
.
```
```python
force
```
```python
(
```
```python
"charge"
```
```python
,
```
```python
d3
```
```python
.
```
```python
forceManyBody
```
```python
(
```
```python
)
```
```python
)
```
```python
.
```
```python
force
```
```python
(
```
```python
"center"
```
```python
,
```
```python
d3
```
```python
.
```
```python
forceCenter
```
```python
(
```
```python
width
```
```python
/
```
```python
2
```
```python
,
```
```python
height
```
```python
/
```
```python
2
```
```python
)
```
```python
)
```
```python
;
```
```python
//存储关系图的数据
```
```python
var
```
```python
graph
```
```python
;
```
```python
//定义d3.json请求python处理好的节点及边 请求成功返回数据，否则报错
```
```python
d3
```
```python
.
```
```python
json
```
```python
(
```
```python
"starwar_alldata.json"
```
```python
,
```
```python
function
```
```python
(
```
```python
error
```
```python
,
```
```python
data
```
```python
)
```
```python
{
```
```python
if
```
```python
(
```
```python
error
```
```python
)
```
```python
throw
```
```python
error
```
```python
;
```
```python
graph
```
```python
=
```
```python
data
```
```python
;
```
```python
console
```
```python
.
```
```python
log
```
```python
(
```
```python
graph
```
```python
)
```
```python
;
```
```python
//D3映射数据至HTML中
```
```python
//g用于绘制所有边,selectALL选中所有的line,并绑定数据data(graph.links),enter().append("line")添加元素
```
```python
//数据驱动文档,设置边的粗细
```
```python
var
```
```python
link
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"links"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"line"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
links
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"line"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"stroke-width"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
//return Math.sqrt(d.value);
```
```python
return
```
```python
1
```
```python
;
```
```python
//所有线宽度均为1
```
```python
}
```
```python
)
```
```python
;
```
```python
//添加所有的点
```
```python
//selectAll("circle")选中所有的圆并绑定数据,圆的直径为d.size
```
```python
//再定义圆的填充色,同样数据驱动样式,圆没有描边,圆的名字为d.id
```
```python
//call()函数：拖动函数,当拖动开始绑定dragstarted函数，拖动进行和拖动结束也绑定函数
```
```python
var
```
```python
node
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"nodes"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"circle"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"circle"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"r"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
size
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"fill"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
colors
```
```python
[
```
```python
d
```
```python
.
```
```python
group
```
```python
]
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"stroke"
```
```python
,
```
```python
"none"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"name"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
call
```
```python
(
```
```python
d3
```
```python
.
```
```python
drag
```
```python
(
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"start"
```
```python
,
```
```python
dragstarted
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"drag"
```
```python
,
```
```python
dragged
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"end"
```
```python
,
```
```python
dragended
```
```python
)
```
```python
)
```
```python
;
```
```python
//显示所有的文本
```
```python
//设置大小、填充颜色、名字、text()设置文本
```
```python
//attr("text-anchor", "middle")设置文本居中
```
```python
var
```
```python
text
```
```python
=
```
```python
svg
```
```python
.
```
```python
append
```
```python
(
```
```python
"g"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"class"
```
```python
,
```
```python
"texts"
```
```python
)
```
```python
.
```
```python
selectAll
```
```python
(
```
```python
"text"
```
```python
)
```
```python
.
```
```python
data
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
enter
```
```python
(
```
```python
)
```
```python
.
```
```python
append
```
```python
(
```
```python
"text"
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"font-size"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
size
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"fill"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
colors
```
```python
[
```
```python
d
```
```python
.
```
```python
group
```
```python
]
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
'name'
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
text
```
```python
(
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
'text-anchor'
```
```python
,
```
```python
'middle'
```
```python
)
```
```python
.
```
```python
call
```
```python
(
```
```python
d3
```
```python
.
```
```python
drag
```
```python
(
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"start"
```
```python
,
```
```python
dragstarted
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"drag"
```
```python
,
```
```python
dragged
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"end"
```
```python
,
```
```python
dragended
```
```python
)
```
```python
)
```
```python
;
```
```python
//圆增加title
```
```python
node
```
```python
.
```
```python
append
```
```python
(
```
```python
"title"
```
```python
)
```
```python
.
```
```python
text
```
```python
(
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
id
```
```python
;
```
```python
}
```
```python
)
```
```python
//simulation中ticked数据初始化并生成图形
```
```python
simulation
```
```python
.
```
```python
nodes
```
```python
(
```
```python
graph
```
```python
.
```
```python
nodes
```
```python
)
```
```python
.
```
```python
on
```
```python
(
```
```python
"tick"
```
```python
,
```
```python
ticked
```
```python
)
```
```python
;
```
```python
simulation
```
```python
.
```
```python
force
```
```python
(
```
```python
"link"
```
```python
)
```
```python
.
```
```python
links
```
```python
(
```
```python
graph
```
```python
.
```
```python
links
```
```python
)
```
```python
;
```
```python
//ticked()函数确定link线的起始点x、y坐标 node确定中心点 文本通过translate平移变化
```
```python
function
```
```python
ticked
```
```python
(
```
```python
)
```
```python
{
```
```python
link
```
```python
.
```
```python
attr
```
```python
(
```
```python
"x1"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
source
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"y1"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
source
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"x2"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
target
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"y2"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
target
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
node
```
```python
.
```
```python
attr
```
```python
(
```
```python
"cx"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
x
```
```python
;
```
```python
}
```
```python
)
```
```python
.
```
```python
attr
```
```python
(
```
```python
"cy"
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
d
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
text
```
```python
.
```
```python
attr
```
```python
(
```
```python
'transform'
```
```python
,
```
```python
function
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
return
```
```python
'translate('
```
```python
+
```
```python
d
```
```python
.
```
```python
x
```
```python
+
```
```python
','
```
```python
+
```
```python
(
```
```python
d
```
```python
.
```
```python
y
```
```python
+
```
```python
d
```
```python
.
```
```python
size
```
```python
/
```
```python
2
```
```python
)
```
```python
+
```
```python
')'
```
```python
;
```
```python
}
```
```python
)
```
```python
;
```
```python
}
```
```python
}
```
```python
)
```
```python
;
```
```python
// Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension
```
```python
// 本地json数据需要放置服务器中请求 XAMPP
```
```python
//拖动函数代码
```
```python
//var dragging = false;
```
```python
//开始拖动并更新相应的点
```
```python
function
```
```python
dragstarted
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
if
```
```python
(
```
```python
!
```
```python
d3
```
```python
.
```
```python
event
```
```python
.
```
```python
active
```
```python
)
```
```python
simulation
```
```python
.
```
```python
alphaTarget
```
```python
(
```
```python
0.3
```
```python
)
```
```python
.
```
```python
restart
```
```python
(
```
```python
)
```
```python
;
```
```python
d
```
```python
.
```
```python
fx
```
```python
=
```
```python
d
```
```python
.
```
```python
x
```
```python
;
```
```python
d
```
```python
.
```
```python
fy
```
```python
=
```
```python
d
```
```python
.
```
```python
y
```
```python
;
```
```python
//dragging = true;
```
```python
}
```
```python
//拖动进行中
```
```python
function
```
```python
dragged
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
d
```
```python
.
```
```python
fx
```
```python
=
```
```python
d3
```
```python
.
```
```python
event
```
```python
.
```
```python
x
```
```python
;
```
```python
d
```
```python
.
```
```python
fy
```
```python
=
```
```python
d3
```
```python
.
```
```python
event
```
```python
.
```
```python
y
```
```python
;
```
```python
}
```
```python
//拖动结束
```
```python
function
```
```python
dragended
```
```python
(
```
```python
d
```
```python
)
```
```python
{
```
```python
if
```
```python
(
```
```python
!
```
```python
d3
```
```python
.
```
```python
event
```
```python
.
```
```python
active
```
```python
)
```
```python
simulation
```
```python
.
```
```python
alphaTarget
```
```python
(
```
```python
0
```
```python
)
```
```python
;
```
```python
d
```
```python
.
```
```python
fx
```
```python
=
```
```python
null
```
```python
;
```
```python
d
```
```python
.
```
```python
fy
```
```python
=
```
```python
null
```
```python
;
```
```python
//dragging = false;
```
```python
}
```
```python
}
```
```python
)
```
```python
;
```
```python
</
```
```python
script
```
```python
>
```
```python
</
```
```python
html
```
```python
>
```
此时的运行结果如下图所示，无法看见边的颜色和节点，接下来需要简单设置节点和边的样式。
![](https://img-blog.csdnimg.cn/20190212173026367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190212173026367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)
# 三.CSS设置节点样式
CSS代码如下：
1.设置线条的颜色和透明度。
2.设置节点的描边和圆描边的宽度。
3.文字设置为不显示。
```python
<
```
```python
style
```
```python
type
```
```python
=
```
```python
"
```
```python
text/css
```
```python
"
```
```python
>
```
```python
.links line
```
```python
{
```
```python
stroke
```
```python
:
```
```python
rgb
```
```python
(
```
```python
240, 240, 240
```
```python
)
```
```python
;
```
```python
stroke-opactity
```
```python
:
```
```python
0.2
```
```python
;
```
```python
}
```
```python
.nodes circle
```
```python
{
```
```python
stroke
```
```python
:
```
```python
#fff
```
```python
;
```
```python
stroke-width
```
```python
:
```
```python
1.5px
```
```python
;
```
```python
}
```
```python
.texts text
```
```python
{
```
```python
display
```
```python
:
```
```python
none
```
```python
;
```
```python
}
```
```python
</
```
```python
style
```
```python
>
```
最终输出结果如下：
![](https://img-blog.csdnimg.cn/20190212170153248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)[
](https://img-blog.csdnimg.cn/20190212170153248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Vhc3Rtb3VudA==,size_16,color_FFFFFF,t_70)下载地址如下：[https://download.csdn.net/download/eastmount/10954282](https://download.csdn.net/download/eastmount/10954282)
（By:Eastmount 2019-02-12 下午6点[http://blog.csdn.net/eastmount/）](http://blog.csdn.net/eastmount/%EF%BC%89)

