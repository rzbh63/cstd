# Base64编码

2018年09月29日 11:23:50 [l-jobs](https://me.csdn.net/qq_26010491) 阅读数：49



版权声明：本文为博主原创文章，未经博主允许不得转载。	https://blog.csdn.net/qq_26010491/article/details/82894119

**一. Base64编码由来**

　　为什么会有Base64编码呢？因为有些网络传送渠道并不支持所有的字节，例如传统的邮件只支持可见字符的传送，像ASCII码的控制字符就 不能通过邮件传送。这样用途就受到了很大的限制，比如图片二进制流的每个字节不可能全部是可见字符，所以就传送不了。最好的方法就是在不改变传统协议的情 况下，做一种扩展方案来支持二进制文件的传送。把不可打印的字符也能用可打印字符来表示，问题就解决了。Base64编码应运而生，所谓Base64，就是说选出64个字符----小写字母a-z、大写字母A-Z、数字0-9、符号"+"、"/"（再加上作为垫字的"="，实际上是65个字符）----作为一个基本字符集。然后，其他所有符号都转换成这个字符集中的字符。

![img](https://img-blog.csdn.net/20180929104356996?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2MDEwNDkx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

二.Base64编码算法

首先，base64编码的原理是先将源文件以标准字节（byte）为单位转化成二进制，一个字节占8个位（bit），如“ABC”的二进制是01000001、01000010、01000011，这样源文件就形成了每8个bit一组的一串二进制，然后将这些二进制串以base64特有的规则（每个字节占6个位）再转化成base64格式的字符（如下图），编码完成。解码就是这个过程反过来。

![img](https://img-blog.csdn.net/20180929104543218?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2MDEwNDkx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)大家可以发现，加密后的数据量是原来的4/3。

你会发现一个问题，就是每次转换的字节数不一定就是24的整数倍，会出现有多余不足六位的情况，在base64中处理的方法是加零凑够六位，但是这样一来在解码的时候就会出现多余的位  这该怎么办呢？ 

办法就是在 base64凑零的同时，还要满足凑出来的位数是8的倍数，不然就加一个或者两个特殊的六位  =  符号。为什么是一个或者两个=符号呢？ 因为多个8位转为6位 只会出现 剩余 2位，4位的情况，剩余2位 只需要一个 表示六位的 = 便可变为8的整数；而剩余4位 需要两个表示6位的 = 便可以变成16 是8的整数。然后在解密的时候不解析 =即可。

之所以位的总数需要凑成8的倍数，是因为base64主要用于加密后的数据传送，而在传送机制中都认为传送的最小单位是按照字节算的，所以不能出现不是位总数不是8的倍数的情况，在接收到数据后，按顺序将6位的base64直接按照顺序解密成字节就完成解密了。

![img](https://img-blog.csdn.net/20180929104614142?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2MDEwNDkx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

三.Base64编码加密

Base64编码主要用在传输、存储、表示二进制等领域，还可以用来加密，但是这种加密比较简单，只是一眼看上去不知道什么内容罢了，当然也可以对Base64的字符序列进行定制来进行加密。

这种编码的方式有个特点，就是解码的时候要么从最前面的字节往后推，要么从最后的字节往前推，最前面和最后面的字节可以直接影响到全部的解码结果。跟多米诺骨牌一样，一个错误，后面都会跟着错误。

既然这样，我们在源文件的最前面和最后面分别加上一个简单的字符，那解码出来的文件内容就跟源文件相差了十万八千里，因为第一个不对，那以此类推，后面的解码都会错误。

基于这种原理，我们采取的方法就是编码前，在源文件的前后分别加上干扰字符，为了增加破译的难度，这些字符可以稍微复杂点，但是要提前告知服务端的同学这种加密的格式，这样服务端才能在解码时排除干扰字符得到正确的内容。

四.Base64中文编解码

汉字本身可以有多种编码，比如gb2312、utf-8、gbk等等，每一种编码的Base64对应值都不一样。

下面的例子以utf-8为例。

首先，"严"的utf-8编码为E4B8A5，写成二进制就是三字节的"11100100 10111000 10100101"。将这个24位的二进制字符串，按照第3节中的规则，转换成四组一共32位的二进制值"00111001 00001011 00100010 00100101"，相应的十进制数为57、11、34、37，它们对应的Base64值就为5、L、i、l。

所以，汉字"严"（utf-8编码）的Base64值就是5Lil。

五.利用工具进行Base64编解码

利用openssl命令进行BASE64编码解码（base64 encode/decode）

\1. BASE64编码命令

对字符串‘abc’进行base64编码：

\# echo abc | openssl base64

YWJjCg==  （编码结果）

如果对一个文件进行base64编码（文件名t.txt）：

\# openssl base64 -in t.txt

\2. BASE64解码命令

求base64后的字符串‘YWJjCg==’的原文：

\# echo YWJjCg== | openssl base64 -d

abc   （解码结果）

如果对一个文件进行base64解码（文件名t.base64）：

\# openssl base64 -d -in t.base64

php

在PHP语言中，有一对专门的函数用于Base64转换：base64_encode()用于编码、base64_decode()用于解码。

这对函数的特点是，它们不管输入文本的编码是什么，都会按照规则进行Base64编码。因此，如果你想得到utf-8编码下的Base64对应值，你就必须自己保证，输入的文本是utf-8编码的。

Javascript

首先，假定网页的编码是utf-8，我们希望对于同样的字符串，用PHP和Javascript可以得到同样的Base64编码。

这里就会产生一个问题。因为Javascript内部的字符串，都以utf-16的形式进行保存，因此编码的时候，我们首先必须将utf-8的值转成utf-16再编码，解码的时候，则是解码后还需要将utf-16的值转回成utf-8。

​     