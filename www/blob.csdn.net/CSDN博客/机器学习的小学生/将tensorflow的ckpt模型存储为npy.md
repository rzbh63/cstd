
# 将tensorflow的ckpt模型存储为npy - 机器学习的小学生 - CSDN博客


2018年01月16日 15:48:03[机器学习的小学生](https://me.csdn.net/xuluhui123)阅读数：3393



```python
#coding=gbk
```
```python
import
```
```python
numpy
```
```python
as
```
```python
np
```
```python
import
```
```python
tensorflow
```
```python
as
```
```python
tf
```
```python
from
```
```python
tensorflow.python
```
```python
import
```
```python
pywrap_tensorflow
checkpoint_path=
```
```python
'model.ckpt-5000'
```
```python
#your ckpt path
```
```python
reader=pywrap_tensorflow.NewCheckpointReader(checkpoint_path)
var_to_shape_map=reader.get_variable_to_shape_map()
alexnet={}
alexnet_layer = [
```
```python
'conv1'
```
```python
,
```
```python
'conv2'
```
```python
,
```
```python
'conv3'
```
```python
,
```
```python
'conv4'
```
```python
,
```
```python
'conv5'
```
```python
,
```
```python
'fc6'
```
```python
,
```
```python
'fc7'
```
```python
,
```
```python
'fc8'
```
```python
]
add_info = [
```
```python
'weights'
```
```python
,
```
```python
'biases'
```
```python
]
alexnet={
```
```python
'conv1'
```
```python
:[[],[]],
```
```python
'conv2'
```
```python
:[[],[]],
```
```python
'conv3'
```
```python
:[[],[]],
```
```python
'conv4'
```
```python
:[[],[]],
```
```python
'conv5'
```
```python
:[[],[]],
```
```python
'fc6'
```
```python
:[[],[]],
```
```python
'fc7'
```
```python
:[[],[]],
```
```python
'fc8'
```
```python
:[[],[]]}
```
```python
for
```
```python
key
```
```python
in
```
```python
var_to_shape_map:
```
```python
#print ("tensor_name",key)
```
```python
str_name = key
```
```python
# 因为模型使用Adam算法优化的，在生成的ckpt中，有Adam后缀的tensor
```
```python
if
```
```python
str_name.find(
```
```python
'Adam'
```
```python
) > -
```
```python
1
```
```python
:
```
```python
continue
```
```python
print(
```
```python
'tensor_name:'
```
```python
, str_name)
```
```python
if
```
```python
str_name.find(
```
```python
'/'
```
```python
) > -
```
```python
1
```
```python
:
        names = str_name.split(
```
```python
'/'
```
```python
)
```
```python
# first layer name and weight, bias
```
```python
layer_name = names[
```
```python
0
```
```python
]
        layer_add_info = names[
```
```python
1
```
```python
]
```
```python
else
```
```python
:
        layer_name = str_name
        layer_add_info =
```
```python
None
```
```python
if
```
```python
layer_add_info ==
```
```python
'weights'
```
```python
:
        alexnet[layer_name][
```
```python
0
```
```python
]=reader.get_tensor(key)
```
```python
elif
```
```python
layer_add_info ==
```
```python
'biases'
```
```python
:
        alexnet[layer_name][
```
```python
1
```
```python
] = reader.get_tensor(key)
```
```python
else
```
```python
:
        alexnet[layer_name] = reader.get_tensor(key)
```
```python
# save npy
```
```python
np.save(
```
```python
'alexnet_pointing04.npy'
```
```python
,alexnet)
print(
```
```python
'save npy over...'
```
```python
)
```
```python
#print(alexnet['conv1'][0].shape)
```
```python
#print(alexnet['conv1'][1].shape)
```
参考文献：
[http://blog.csdn.net/weiguanqun/article/details/78673620](http://blog.csdn.net/weiguanqun/article/details/78673620)

