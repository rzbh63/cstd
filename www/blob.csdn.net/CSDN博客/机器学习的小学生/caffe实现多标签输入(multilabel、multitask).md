
# caffe实现多标签输入(multilabel、multitask) - 机器学习的小学生 - CSDN博客


2017年03月22日 10:32:14[机器学习的小学生](https://me.csdn.net/xuluhui123)阅读数：1070



## 其他资料
以下内容摘自参考文献[2],将caffe中的data和label分别写在两个layer中：
```python
layer {
  name:
```
```python
"data"
```
```python
type
```
```python
:
```
```python
"Data"
```
```python
top:
```
```python
"data"
```
```python
include {
    phase: TRAIN
  }
  transform_param {
    mean_value:
```
```python
104.00699
```
```python
mean_value:
```
```python
116.66877
```
```python
mean_value:
```
```python
122.67892
```
```python
}
  data_param {
```
```python
source
```
```python
:
```
```python
"skin/data/traindata_lmdb"
```
```python
batch_size:
```
```python
1
```
```python
backend: LMDB
  }
}
layer {
  name:
```
```python
"label"
```
```python
type
```
```python
:
```
```python
"Data"
```
```python
top:
```
```python
"label"
```
```python
include {
    phase: TRAIN
  }
  data_param {
```
```python
source
```
```python
:
```
```python
"skin/data/trainlabel_lmdb"
```
```python
batch_size:
```
```python
1
```
```python
backend: LMDB
  }
   transform_param {
```
```python
# feature scaling coefficient: this maps the [0, 255] MNIST data to [0, 1]
```
```python
scale:
```
```python
0.00390625
```
```python
}
}
layer {
  name:
```
```python
"data"
```
```python
type
```
```python
:
```
```python
"Data"
```
```python
top:
```
```python
"data"
```
```python
include {
    phase: TEST
  }
  transform_param {
    mean_value:
```
```python
104.00699
```
```python
mean_value:
```
```python
116.66877
```
```python
mean_value:
```
```python
122.67892
```
```python
}
  data_param {
```
```python
source
```
```python
:
```
```python
"skin/data/valdata_lmdb"
```
```python
batch_size:
```
```python
1
```
```python
backend: LMDB
  }
}
layer {
  name:
```
```python
"label"
```
```python
type
```
```python
:
```
```python
"Data"
```
```python
top:
```
```python
"label"
```
```python
include {
    phase: TEST
  }
  data_param {
```
```python
source
```
```python
:
```
```python
"skin/data/vallabel_lmdb"
```
```python
batch_size:
```
```python
1
```
```python
backend: LMDB
  }
   transform_param {
```
```python
# feature scaling coefficient: this maps the [0, 255] MNIST data to [0, 1]
```
```python
scale:
```
```python
0.00390625
```
```python
}
}
```
我们首先通过可视化工具可视化一下：
![这里写图片描述](https://img-blog.csdn.net/20170322151748721?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcmFieV9neWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
然后，通过训练一下lenet网络，检查一下上面的形式是否可行。
先略。
## 多标签
以下内容摘自文献[4]，请多支持原文。感谢他们的分享。
**train_val.prototxt**
```python
name
```
```python
:
```
```python
"LeNet"
```
```python
##
```
```python
#for
```
```python
data
```
```python
and
```
```python
labels
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"data"
```
```python
type:
```
```python
"HDF5Data"
```
```python
top:
```
```python
"data"
```
```python
top:
```
```python
"labels"
```
```python
include {
    phase: TRAIN
```
```python
}
```
```python
hdf5_data_param
```
```python
{
```
```python
source
```
```python
:
```
```python
"list_train.txt"
```
```python
batch_size:
```
```python
100
```
```python
}
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"data"
```
```python
type:
```
```python
"HDF5Data"
```
```python
top:
```
```python
"data"
```
```python
top:
```
```python
"labels"
```
```python
include {
    phase: TEST
```
```python
}
```
```python
hdf5_data_param
```
```python
{
```
```python
source
```
```python
:
```
```python
"list_test.txt"
```
```python
batch_size:
```
```python
100
```
```python
}
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"slicers"
```
```python
type:
```
```python
"Slice"
```
```python
bottom:
```
```python
"labels"
```
```python
top:
```
```python
"label_1"
```
```python
top:
```
```python
"label_2"
```
```python
slice_param {
    axis:
```
```python
1
```
```python
slice_point:
```
```python
1
```
```python
}
}
###
```
```python
for
```
```python
all
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"conv_all"
```
```python
type:
```
```python
"Convolution"
```
```python
bottom:
```
```python
"data"
```
```python
top:
```
```python
"conv_all"
```
```python
param {
    lr_mult:
```
```python
1
```
```python
}
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
2
```
```python
}
```
```python
convolution_param
```
```python
{
```
```python
num_output
```
```python
:
```
```python
50
```
```python
kernel_size:
```
```python
5
```
```python
stride:
```
```python
1
```
```python
weight_filler {
      type:
```
```python
"xavier"
```
```python
}
```
```python
bias_filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
}
  }
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"relu_all"
```
```python
type:
```
```python
"ReLU"
```
```python
bottom:
```
```python
"conv_all"
```
```python
top:
```
```python
"conv_all"
```
```python
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"pool_all"
```
```python
type:
```
```python
"Pooling"
```
```python
bottom:
```
```python
"conv_all"
```
```python
top:
```
```python
"pool_all"
```
```python
pooling_param {
    pool: MAX
    kernel_size:
```
```python
2
```
```python
stride:
```
```python
2
```
```python
}
}
###
```
```python
for
```
```python
kind_1
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"ip1"
```
```python
type:
```
```python
"InnerProduct"
```
```python
bottom:
```
```python
"pool_all"
```
```python
top:
```
```python
"ip1"
```
```python
param {
    lr_mult:
```
```python
1
```
```python
}
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
2
```
```python
}
```
```python
inner_product_param
```
```python
{
```
```python
num_output
```
```python
:
```
```python
2
```
```python
weight_filler {
      type:
```
```python
"xavier"
```
```python
}
```
```python
bias_filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
}
  }
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"accuracy1"
```
```python
type:
```
```python
"Accuracy"
```
```python
bottom:
```
```python
"ip1"
```
```python
bottom:
```
```python
"label_1"
```
```python
top:
```
```python
"accuracy1"
```
```python
include {
    phase: TEST
```
```python
}
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"loss_1"
```
```python
type:
```
```python
"SoftmaxWithLoss"
```
```python
bottom:
```
```python
"ip1"
```
```python
bottom:
```
```python
"label_1"
```
```python
top:
```
```python
"loss_1"
```
```python
}
##
```
```python
#for
```
```python
kind_2
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"ip2"
```
```python
type:
```
```python
"InnerProduct"
```
```python
bottom:
```
```python
"pool_all"
```
```python
top:
```
```python
"ip2"
```
```python
param {
    lr_mult:
```
```python
1
```
```python
}
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
2
```
```python
}
```
```python
inner_product_param
```
```python
{
```
```python
num_output
```
```python
:
```
```python
3
```
```python
weight_filler {
      type:
```
```python
"xavier"
```
```python
}
```
```python
bias_filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
}
  }
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"accuracy2"
```
```python
type:
```
```python
"Accuracy"
```
```python
bottom:
```
```python
"ip2"
```
```python
bottom:
```
```python
"label_2"
```
```python
top:
```
```python
"accuracy2"
```
```python
include {
    phase: TEST
```
```python
}
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"loss_2"
```
```python
type:
```
```python
"SoftmaxWithLoss"
```
```python
bottom:
```
```python
"ip2"
```
```python
bottom:
```
```python
"label_2"
```
```python
top:
```
```python
"loss_2"
```
```python
}
```
使用Netscope可视化：
![这里写图片描述](https://img-blog.csdn.net/20170322160110077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcmFieV9neWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
参考文献:
1[http://blog.csdn.net/u013010889/article/details/53098346](http://blog.csdn.net/u013010889/article/details/53098346)[caffe实现多标签输入(multilabel、multitask)]
2.[http://blog.csdn.net/zhikangfu/article/details/45170047](http://blog.csdn.net/zhikangfu/article/details/45170047)[将caffe中的data和label分别写在两个layer中]
3.[https://www.zhihu.com/question/53296707](https://www.zhihu.com/question/53296707)[已经通过 使用HDF5Data做输入 ，加入slice layer，构建五个小分类器  解决了这个问题，效果也还可以。]
4.[http://blog.csdn.net/u011762313/article/details/48851015](http://blog.csdn.net/u011762313/article/details/48851015)[Caffe中HDF5Data例子。]

