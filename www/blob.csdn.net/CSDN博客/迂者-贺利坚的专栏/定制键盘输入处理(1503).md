
# 定制键盘输入处理(1503) - 迂者-贺利坚的专栏 - CSDN博客

2017年05月17日 05:25:25[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：579


本文为《汇编语言程序设计》1503小节例程。点击[链接…](http://blog.csdn.net/sxhelijian/article/details/56671827)进课程主页。
任务：在屏幕中间依次显示 ‘a’~’z’ ，并可以让人看清，在显示的过程中，按下Esc键后，改变显示的颜色。
程序：
v0.2
```python
assume cs:code
code segment
```
```python
start:
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,ax
```
```python
mov
```
```python
ah,
```
```python
'a'
```
```python
s:
```
```python
mov
```
```python
es:[
```
```python
160
```
```python
*
```
```python
12
```
```python
+
```
```python
40
```
```python
*
```
```python
2
```
```python
],ah
```
```python
inc
```
```python
ah
            cmp ah,
```
```python
'z'
```
```python
jna s
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
          int
```
```python
21
```
```python
h
code ends
end start
```
v0.4
```python
assume cs:code
stack segment
        db
```
```python
128
```
```python
dup (
```
```python
0
```
```python
)
stack ends
code segment
```
```python
start:
```
```python
mov
```
```python
ax,stack
```
```python
mov
```
```python
ss,ax
```
```python
mov
```
```python
sp,
```
```python
128
```
```python
; 显示字符
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,ax
```
```python
mov
```
```python
ah,
```
```python
'a'
```
```python
s:
```
```python
mov
```
```python
es:[
```
```python
160
```
```python
*
```
```python
12
```
```python
+
```
```python
40
```
```python
*
```
```python
2
```
```python
],ah
```
```python
call
```
```python
delay
```
```python
inc
```
```python
ah
        cmp ah,
```
```python
'z'
```
```python
jna s
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
        int
```
```python
21
```
```python
h
```
```python
; 定义延时函数
```
```python
delay:
```
```python
push
```
```python
ax
```
```python
push
```
```python
dx
```
```python
mov
```
```python
dx,
```
```python
10
```
```python
h
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
s1:
```
```python
sub
```
```python
ax,
```
```python
1
```
```python
sbb dx,
```
```python
0
```
```python
cmp ax,
```
```python
0
```
```python
jne s1
        cmp dx,
```
```python
0
```
```python
jne s1
```
```python
pop
```
```python
dx
```
```python
pop
```
```python
ax
```
```python
ret
```
```python
code ends
end start
```
v1.0
```python
assume cs:code
stack segment
         db
```
```python
128
```
```python
dup (
```
```python
0
```
```python
)
stack ends
data segment
         dw
```
```python
0
```
```python
,
```
```python
0
```
```python
data ends
code segment
```
```python
start:
```
```python
mov
```
```python
ax,stack
```
```python
mov
```
```python
ss,ax
```
```python
mov
```
```python
sp,
```
```python
128
```
```python
mov
```
```python
ax,data
```
```python
mov
```
```python
ds,ax
```
```python
; 改中断例程入口地址
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
mov
```
```python
es,ax
```
```python
push
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
]
```
```python
pop
```
```python
ds:[
```
```python
0
```
```python
]
```
```python
push
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
+
```
```python
2
```
```python
]
```
```python
pop
```
```python
ds:[
```
```python
2
```
```python
]
```
```python
mov
```
```python
word ptr es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
],offset int9
```
```python
mov
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
+
```
```python
2
```
```python
],cs
```
```python
; 显示'a'~'z'
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,ax
```
```python
mov
```
```python
ah,
```
```python
'a'
```
```python
s:
```
```python
mov
```
```python
es:[
```
```python
160
```
```python
*
```
```python
12
```
```python
+
```
```python
40
```
```python
*
```
```python
2
```
```python
],ah
```
```python
call
```
```python
delay
```
```python
inc
```
```python
ah
        cmp ah,
```
```python
'z'
```
```python
jna s
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
mov
```
```python
es,ax
```
```python
; 恢复原来的地址
```
```python
push
```
```python
ds:[
```
```python
0
```
```python
]
```
```python
pop
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
]
```
```python
push
```
```python
ds
```
```python
;[2]
```
```python
pop
```
```python
es
```
```python
;[9*4+2]
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
        int
```
```python
21
```
```python
h
```
```python
; 定义延迟程序
```
```python
delay:
```
```python
push
```
```python
ax
```
```python
push
```
```python
dx
```
```python
mov
```
```python
dx,
```
```python
10
```
```python
h
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
s1:
```
```python
sub
```
```python
ax,
```
```python
1
```
```python
sbb dx,
```
```python
0
```
```python
cmp ax,
```
```python
0
```
```python
jne s1
        cmp dx,
```
```python
0
```
```python
jne s1
```
```python
pop
```
```python
dx
```
```python
pop
```
```python
ax
```
```python
ret
```
```python
; 定义中断例程
```
```python
int9:
```
```python
push
```
```python
ax
```
```python
push
```
```python
bx
```
```python
push
```
```python
es
```
```python
in
```
```python
al,
```
```python
60
```
```python
h
        pushf
        pushf
```
```python
pop
```
```python
bx
```
```python
and
```
```python
bh,
```
```python
11111100
```
```python
b
```
```python
push
```
```python
bx
        popf
```
```python
call
```
```python
dword ptr ds:[
```
```python
0
```
```python
]
        cmp al,
```
```python
1
```
```python
; ESC扫描码1
```
```python
jne int9ret
```
```python
;改变颜色
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,ax
```
```python
inc
```
```python
byte ptr es:[
```
```python
160
```
```python
*
```
```python
12
```
```python
+
```
```python
40
```
```python
*
```
```python
2
```
```python
+
```
```python
1
```
```python
]
```
```python
int9ret:
```
```python
pop
```
```python
es
```
```python
pop
```
```python
bx
```
```python
pop
```
```python
ax
        iret
code ends
end start
```
> 注：此程序运行后，键盘功能将失效。程序中潜伏着一个不引人注目的小bug。——先请自行找一找


