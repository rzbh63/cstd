
# Systemd基础：2：实例介绍 - 知行合一 止于至善 - CSDN博客

2019年04月08日 21:27:32[liumiaocn](https://me.csdn.net/liumiaocn)阅读数：58标签：[systemd																](https://so.csdn.net/so/search/s.do?q=systemd&t=blog)[示例																](https://so.csdn.net/so/search/s.do?q=示例&t=blog)[unit																](https://so.csdn.net/so/search/s.do?q=unit&t=blog)[说明																](https://so.csdn.net/so/search/s.do?q=说明&t=blog)[介绍																](https://so.csdn.net/so/search/s.do?q=介绍&t=blog)[
							](https://so.csdn.net/so/search/s.do?q=说明&t=blog)[
																					](https://so.csdn.net/so/search/s.do?q=unit&t=blog)个人分类：[Unix/Linux																](https://blog.csdn.net/liumiaocn/article/category/6328278)
[
																								](https://so.csdn.net/so/search/s.do?q=unit&t=blog)
[
				](https://so.csdn.net/so/search/s.do?q=示例&t=blog)
[
			](https://so.csdn.net/so/search/s.do?q=示例&t=blog)
[
		](https://so.csdn.net/so/search/s.do?q=systemd&t=blog)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
这篇文章通过对一个实例来介绍一下Systemd服务的写法和相关的知识点。
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 示例说明
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)使用systemctl cat docker或者如下都可以看到在centos上目前使用yum install docker后centos所做的systemd的docker配置文件内容。由于这个示例使用到了Systemd服务常用到的多种写法，在这篇文章中将以此为例进行使用说明。
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
root@host shell
```
```python
]
```
```python
# cat /usr/lib/systemd/system/docker.service
```
```python
[
```
```python
Unit
```
```python
]
```
```python
Description
```
```python
=
```
```python
Docker Application Container Engine
Documentation
```
```python
=
```
```python
http://docs.docker.com
After
```
```python
=
```
```python
network.target 
Wants
```
```python
=
```
```python
docker-storage-setup.service
Requires
```
```python
=
```
```python
docker-cleanup.timer
```
```python
[
```
```python
Service
```
```python
]
```
```python
Type
```
```python
=
```
```python
notify
NotifyAccess
```
```python
=
```
```python
main
EnvironmentFile
```
```python
=
```
```python
-/run/containers/registries.conf
EnvironmentFile
```
```python
=
```
```python
-/etc/sysconfig/docker
EnvironmentFile
```
```python
=
```
```python
-/etc/sysconfig/docker-storage
EnvironmentFile
```
```python
=
```
```python
-/etc/sysconfig/docker-network
Environment
```
```python
=
```
```python
GOTRACEBACK
```
```python
=
```
```python
crash
Environment
```
```python
=
```
```python
DOCKER_HTTP_HOST_COMPAT
```
```python
=
```
```python
1
Environment
```
```python
=
```
```python
PATH
```
```python
=
```
```python
/usr/libexec/docker:/usr/bin:/usr/sbin
ExecStart
```
```python
=
```
```python
/usr/bin/dockerd-current \
          --add-runtime docker-runc
```
```python
=
```
```python
/usr/libexec/docker/docker-runc-current \
          --default-runtime
```
```python
=
```
```python
docker-runc \
          --exec-opt native.cgroupdriver
```
```python
=
```
```python
systemd \
          --userland-proxy-path
```
```python
=
```
```python
/usr/libexec/docker/docker-proxy-current \
          --init-path
```
```python
=
```
```python
/usr/libexec/docker/docker-init-current \
          --seccomp-profile
```
```python
=
```
```python
/etc/docker/seccomp.json \
```
```python
$OPTIONS
```
```python
\
```
```python
$DOCKER_STORAGE_OPTIONS
```
```python
\
```
```python
$DOCKER_NETWORK_OPTIONS
```
```python
\
```
```python
$ADD_REGISTRY
```
```python
\
```
```python
$BLOCK_REGISTRY
```
```python
\
```
```python
$INSECURE_REGISTRY
```
```python
\
```
```python
$REGISTRIES
```
```python
ExecReload
```
```python
=
```
```python
/bin/kill -s HUP
```
```python
$MAINPID
```
```python
LimitNOFILE
```
```python
=
```
```python
1048576
LimitNPROC
```
```python
=
```
```python
1048576
LimitCORE
```
```python
=
```
```python
infinity
TimeoutStartSec
```
```python
=
```
```python
0
Restart
```
```python
=
```
```python
on-abnormal
KillMode
```
```python
=
```
```python
process
```
```python
[
```
```python
Install
```
```python
]
```
```python
WantedBy
```
```python
=
```
```python
multi-user.target
```
```python
[
```
```python
root@host shell
```
```python
]
```
```python
#
```
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
# 3个目录
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)与Systemd相关的主要有如下三个目录：
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|目录|说明|
|---|---|
|/usr/lib/systemd/system|服务配置文件所放置的目录|
|/etc/systemd/system|服务配置文件的软链接文件，作为本地的配置文件，enable/disable命令实际即是操作此文件|
|/run/systemd/system|运行时的相关文件|
# 配置文件格式说明
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)以docker.service文件，配置文件格式如下所示
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
```python
[
```
```python
内容
```
```python
1
```
```python
]
```
```python
KEY1
```
```python
=
```
```python
VALUE1
```
```python
...
```
```python
[
```
```python
内容
```
```python
2
```
```python
]
```
```python
KEY2
```
```python
=
```
```python
VALUE2
```
```python
...
```
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
## []设定部分
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)[]设定范围到下一个[]的开始，主要使用的有如下几类：
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|Unit|用于定义Unit的meta数据以及配置与其他Unit的管理|
|Service|服务的主要设定部分，注意并不是所有的systemd配置文件都有此部分|
|Install|定义启动方式以及是否开机启动等|
# [Unit]设定选项说明
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|Description|对服务的描述内容|
|Documentation|文档地址信息说明|
|After|指定启动顺序：当前服务应当在指定服务之后启动|
|Requires|指定依赖关系：如果指定服务未运行，当前服务无法启动|
|Wants|指定关联关系：但与Requires的区别在于，如果指定服务未运行，当前服务仍可启动|
除了上述例子中的选项还有一些常见的设定如下所示：
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|BindsTo|指定绑定服务：指定服务退出会导致当前服务同时停止|
|Before|指定启动顺序：当前服务应当在指定服务之前启动|
|Conflicts|指定冲突服务：指定服务和当前服务不能同时运行|
|Condition…|指定运行条件：当前服务必须满足条件才能运行|
|Assert…|指定断言内容：当断言不能得到满足，启动会导致报错|
# [Service]设定选项说明
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|Type|用于定义启动时的行为和方式，取值范围：simple/forking/oneshot/dbus/notify/idle|
|NotifyAccess|设置状态更新的方式，取值范围：none/main/exec/all，main表示只接受主进程的状态更新消息。|
|EnvironmentFile|指定读取的环境变量文件|
|Environment|指定环境变量|
|ExecStart|启动当前服务的命令|
|ExecReload|设定服务重新加载配置时的执行命令，环境变量MAINPID为主进程PID，向其发送HUP的复位信号可以使得其强制加载配置文件，是一个便利的方法但并不时推荐的方式。|
|LimitNOFILE|设定NOFILE|
|LimitNPROC|设定NPROC|
|LimitCORE|设定LimitCORE|
|TimeoutStartSec|设定启动服务所允许的最大时长|
|Restart|设定重新启动的策略，取值范围：always/on-success/on-failure/on-abnormal/on-abort/on-watchdog|
|KillMode|设定杀掉进程的方法，取值范围：control-group/process/mixed/none，process表示仅杀掉主进程，control-group表示杀掉关联的其他进程。|
除了上述例子中的选项还有一些常见的设定如下所示：
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|ExecStartPre|设定执行ExecStart之前的命令|
|ExecStartPost|设定执行ExecStart之后的命令|
|ExecStop|设定服务停止时所执行的命令|
|ExecStopPost|设定服务停止后所执行的命令，此设定会无条件执行，不管启动成功与否|
|RestartSec|设定服务重启的间隔时间，默认时100毫秒，单位不指定时缺省为秒|
|TimeoutStopSec|设定服务停止所允许的最大时长|
|TimeoutSec|设定服务启动或停止所允许的最大时长|
# [Install]设定选项说明
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|WantedBy|用于设定systemd的target（类似于init的RunLevel），根据enable/disable对ln进行操作|
除了上述例子中的选项还有一些常见的设定如下所示：
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)|设定内容|说明|
|---|---|
|RequiredBy|用于设定systemd的target（类似于init的RunLevel），根据enable/disable对ln进行操作|
|Alias|启动时可用的别名|
|Also|与当前服务关联的其他服务，enable时同时进行|
# 其他相关文章
[
](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)目录：Systemd实践指南
[https://liumiaocn.blog.csdn.net/article/details/89079485](https://liumiaocn.blog.csdn.net/article/details/89079485)
参考内容
[https://www.freedesktop.org/software/systemd/man/systemd.unit.html](https://www.freedesktop.org/software/systemd/man/systemd.unit.html)
[
						](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
[
	](https://img-blog.csdnimg.cn/20190408194411814.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
