
# 5.7 以太坊源码详解7 - 尹成的技术博客 - CSDN博客

2018年11月09日 15:29:17[尹成](https://me.csdn.net/yincheng01)阅读数：65


Kademila算法
1 概念：一种分布式存储以及路由的算法
1 分布式存储：不设中心化服务器，所有的文件分散存储到各个节点上面
2 问题
1 存储内容如何分配到各个节点，如何处理新增/删除内容
2 如果一个节点要获取特定的文件，应该如何找到指定的节点/地址
3 节点要素
1 NodeID 二进制 160位
2 IP地址和端口号
维护内容
1 被分配到的内容
2 内容是以“(key,value)”的形式存储的，“<文件名，文件内容>”
3 k-bucket路由表：通过NodeID分层，记录有限其他节点的ID，IP地址，端口号
4 文件存储及查找
1 假如要查找的书名(hash)是0x100000
2 那么我们希望它能被存储在学号(nodeId)位0x100000中
3 为了防止节点罢工，就存储到0x100000,0x100001,0x100002,…
5 节点的异或距离
1 距离：
2 树：把整个网络节点梳理为按nodeid排列的二叉树，树最末端的叶子就是他的每一个节点。
3 由于nodeId有160位，那它的分层应该有160层，整个网络中能够容纳2^160个节点，每个节点最多可以维护160*k行其他节点。
6 节点定位(查找原理)
1 同学A(00000110)要查找《分布式算法》
2 计算出《分布式算法的哈希》= 00010000
3 同学Z的哈希就是00010000
4 计算异或距离00010110，结果为从倒数第五位开始不同，k-bucket 5
5 在自己的k-bucket 5中查找Z同学
6 查找到之后，直接要
7 如果没找到，就在自己的k-bucket 5中查找任意一个同学B，请求B同学查找Z
8 重复6、7步骤
9 通过这种方式查找，最多查log2n次
7 算法参数
1 keyspace
1 keyspace决定ID有多少位
2 每个节点的通讯录有几层
2 k
1 每一层的k-bucket里面装了k个node的信息
2 每次查找node，返回k个Node的信息
3 对于某个特定的data，离key最近的几个k会被要求存储这个data
3 a
1 每次向其他节点发起请求查找某个node，会向a个节点发出请求
8 节点指令
1 PING:测试一个节点是否在线
2 STORE:要求一份节点存储数据
3 FIND_NODE:根据NODE_ID查找一个节点
4 FIND_VALUE:根据Key值查找一个树据
9 k-bucket的维护和更新机制
1 每个节点都会按照最后一次接触时间倒序排列
2 没次执行4个指令之一就会触发更新
3 当一个节点与自己接触的时候要检查其是否在自己的k-bucket中
1 如果在，将其挪到自己k-bucket列表的最底
2 如果不在
1 PING一下列表中最上面(最旧)的节点，如果该节点能ping通，将其挪到最底部，抛弃新节点
2 如果ping不同，扔掉该节点，将新节点加入列表中，从而保证节点介入或者删除不会影响整个网络。
学院Go语言视频主页
[https://edu.csdn.net/lecturer/1928](https://edu.csdn.net/lecturer/1928)
[清华团队带你实战区块链开发](https://ke.qq.com/course/337650?tuin=63946d38)
扫码获取海量视频及源码   QQ群：721929980
![](https://img-blog.csdnimg.cn/20181108132958856.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=,size_16,color_FFFFFF,t_70)

