
# 2.08 hyperledger fabric完整案例 - 尹成的技术博客 - CSDN博客

2018年12月10日 09:43:59[尹成](https://me.csdn.net/yincheng01)阅读数：671


**1.fabric开发流程**
需求整理
合约编写
合约部署
合约交互
外部服务编写
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171703964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
2.需求分析
开发一个资产转让功能模块
平台功能用户开户和销户
资产登记，解决资产上链和用户绑定资产
资产转让，资产所有权的变更
查询功能，用户查询、资产查询、资产变更历史查询
3.合约编写
assetsExchange.go
4.合约部署
关闭docker
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171711219.png)
生成通道的创世交易
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517171390.png)
查看生成的交易文件
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171717660.png)
启动网络
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171719940.png)
登录到client会话操作
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171725883.png)
创建通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171728407.png)
查看通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171730410.png)
加入通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171733900.png)
创建mychannel
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171737409.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171739139.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171741349.png)
安装智能合约
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171745167.png)
链码实例化
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171747323.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171749200.png)
注册用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171753555.png)
查询用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171755704.png)
资产登记
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171758262.png)
资产查询
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517180383.png)
注册第二个用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171807200.png)
查询第二个用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171809784.png)
资产转让
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171811817.png)
查看用户2的资产信息，已经有资产1的Id了
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171814394.png)
查询资产1的历史
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171816773.png)
查询所有资产的变更历史
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171822595.png)
注销用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171824582.png)
查询用户是否存在
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171827672.png)
5.链码开发者模式
特殊配置使用dev模式启动peer节点
方法一：peer node start --peer-chaincodedev=true
方法二（给peer节点注入环境变量）：CORE_CHAINCODE_MODE=dev
删除之前的网络
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171835865.png)
修改文件
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171837362.png)
启动网络
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171839214.png)
运行代码
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171845486.png)
进入cli
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171847614.png)
创建通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171849806.png)
加入通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517185318.png)
安装链码
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171854962.png)
实例化链码
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171856946.png)
注册用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171901313.png)
查询用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171917805.png)
修改方法
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171919957.png)
再次运行，就可以生效
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171927468.png)
关闭docker
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171930142.png)
6.外部服务分析
如何提供服务，决定于应用场景，也就是决定于终端用户智能硬件：提供socket或tcp服务，主流是还是socket服务，例如太阳能发电终端
游戏、电商、社交：web或手机app，提供http服务（接下来例子采用http）
企业内部：rpc或grpc服务
如何选择SDKnode.js
java
python
golang
SDK的模块区块链管理：例如通道的创建和加入、链码的安装、实例化和升级等（区块链和管理员或者云服务提供商去用）
数据查询：区块（区块浏览器）和交易的查询
区块链交互：发起交易（invoke或query）
事件监听：业务事件（SendEvent）、系统事件（block/trancastion）
7.SDK下载和配置
搜fabric-sdk
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205171936529.png)
可以查看4个SDK的release
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172018544.png)
这里选用第三个版本
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172020262.png)
下载SDK
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172026400.png)
切换版本
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172029242.png)
查看日志
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172031234.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205172033643.png)
[](https://img-blog.csdnimg.cn/20181205172031234.png)8.外部服务编写和部署
[](https://img-blog.csdnimg.cn/20181205172031234.png)编写main.go
编译文件
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173115750.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173118341.png)
运行外部服务
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517312265.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173124216.png)
[](https://img-blog.csdnimg.cn/2018120517312265.png)9.外部服务调用
[](https://img-blog.csdnimg.cn/2018120517312265.png)进入目录
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173127194.png)
启动网络
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517313152.png)
登录到client会话操作
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173134424.png)
创建通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173136252.png)
加入通道
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173137971.png)
安装智能合约
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517314151.png)
链码实例化
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173144431.png)
用户注册
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173147465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
可以去linux中查询用户
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173152739.png)
用户查询，目前user2的资产还没有登记
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018120517315664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
为user2资产登记
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173159856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
再次查询user2，此时已经有资产了
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173203612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
也可以单独查询资产
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173207312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
创建user3用户，测试资产转让
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173211903.png)
user2的asset2资产，转让给user3
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173214637.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
查看user2和user3，资产已经被转让给了user3
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173217449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173220905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5ODY3NzY=,size_16,color_FFFFFF,t_70)
查询资产变更历史
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173225440.png)
删除user3
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173227788.png)
查看用户和资产，都没有了
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181205173231628.png)
学院Go语言视频主页
[https://edu.csdn.net/lecturer/1928](https://edu.csdn.net/lecturer/1928)
[清华团队带你实战区块链开发]
([https://ke.qq.com/course/344443?tuin=3d17195d](https://ke.qq.com/course/344443?tuin=3d17195d))
扫码获取海量视频及源码   QQ群：
721929980
![在这里插入图片描述](https://img-blog.csdnimg.cn/2018111611182187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=,size_16,color_FFFFFF,t_70)

