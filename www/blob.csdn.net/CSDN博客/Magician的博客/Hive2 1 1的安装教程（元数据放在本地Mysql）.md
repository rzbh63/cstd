
# Hive2.1.1的安装教程（元数据放在本地Mysql） - Magician的博客 - CSDN博客


2017年10月18日 22:52:31[春雨里de太阳](https://me.csdn.net/qq_16633405)阅读数：1852所属专栏：[自学大数据之路](https://blog.csdn.net/column/details/18514.html)



[目录](#目录)[1.上传tar包](#1上传tar包)
[2.解压](#2解压)
[3. 设置环境变量](#3-设置环境变量)
[4.设置Hive的配置文件](#4设置hive的配置文件)
[5.启动Hive](#5启动hive)
[6.安装MySQL](#6安装mysql)
[7.下载MySQL的驱动包](#7下载mysql的驱动包)
[8.修改Hive的配置文件](#8修改hive的配置文件)
[9.启动Hive](#9启动hive)
[10.查看MySQL数据库](#10查看mysql数据库)


# 目录
## 1.上传tar包
jar包地址：[http://hive.apache.org/downloads.html](http://hive.apache.org/downloads.html)
## 2.解压
```python
tar
```
```python
-zxvf
```
```python
apache
```
```python
-hive
```
```python
-
```
```python
2.1
```
```python
.1
```
```python
-bin
```
```python
.
```
```python
tar
```
```python
.
```
```python
gz
```
```python
-C
```
```python
/usr/
```
```python
local
```
```python
/
```
进入到/usr/local目录下，将解压后的文件重命名为hive-2.1.1
```python
mv apache
```
```python
-hive
```
```python
-
```
```python
2.1
```
```python
.1
```
```python
-bin
```
```python
/
```
```python
hive
```
```python
-
```
```python
2.1
```
```python
.1
```
## 3. 设置环境变量
```python
export
```
```python
HIVE_HOME=/usr/local/hive-
```
```python
2.1
```
```python
.
```
```python
1
```
```python
export
```
```python
PATH=
```
```python
$PATH
```
```python
:
```
```python
$HIVE_HOME
```
```python
/bin
```
使配置立即生效
```python
source
```
```python
/etc/profile
```
hive没有提供hive –version这种方式查看版本，执行hive –help查看
![这里写图片描述](https://img-blog.csdn.net/20180820170655965?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
## 4.设置Hive的配置文件
在目录$HIVE_HOME/conf/下，执行命令
`cp hive-log4j2.properties.template hive-log4j2.properties`拷贝一份重命名 ，并修改property.hive.log.dir = /usr/local/hive-2.1.1/logs/
暂时只配置这些
## 5.启动Hive
Hadoop集群要先启动
```python
Starting from Hive
```
```python
2.1
```
```python
, we need
```
```python
to
```
```python
run the schematool command below
```
```python
as
```
```python
an initialization step. For example, we can
```
```python
use
```
```python
“derby”
```
```python
as
```
```python
db
```
```python
type
```
```python
.
```
```python
$ $HIVE_HOME/bin/schematool -dbType <db
```
```python
type
```
```python
> -
```
```python
initSchema
```
这是Hive的官方文档上描述的，Hive2.1的启动需要先执行schematool命令
由于Hive默认内嵌的是derby数据库，先使用默认的数据库运行
执行`schematool -dbType derby -initSchema`进行初始化
![这里写图片描述](https://img-blog.csdn.net/20180820170923265?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820170923265?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
执行命令`hive`进入到Hive Shell操作
![这里写图片描述](https://img-blog.csdn.net/20180820170947364?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820170947364?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
此时Hive安装成功。
默认情况下，Hive的元数据保存在了内嵌的derby数据库里，但一般情况下生产环境使用MySQL来存放Hive元数据。
## 6.安装MySQL
参考：[https://blog.csdn.net/qq_16633405/article/details/81872456](https://blog.csdn.net/qq_16633405/article/details/81872456)
## 7.下载MySQL的驱动包
下载MySQL的驱动包放置到$HIVE_HOME/lib目录下，本机使用的版本是mysql-connector-Java-5.1.36-bin.jar。
## 8.修改Hive的配置文件
在目录$HIVE_HOME/conf/下，执行命令`cp hive-default.xml.template hive-site.xml`拷贝重命名
将hive-site.xml里面的property属性配置全部删除，Hive会加载默认配置。
添加如下内容（只需要将最后两个属性更改为你mysql的用户名和对应的登录密码就OK了，其他全部照搬）：
```python
<
```
```python
configuration
```
```python
>
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
javax.jdo.option.ConnectionURL
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true
```
```python
</
```
```python
value
```
```python
>
```
```python
<
```
```python
description
```
```python
>
```
```python
JDBC connect string for a JDBC metastore
```
```python
</
```
```python
description
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
javax.jdo.option.ConnectionDriverName
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
com.mysql.jdbc.Driver
```
```python
</
```
```python
value
```
```python
>
```
```python
<
```
```python
description
```
```python
>
```
```python
Driver class name for a JDBC metastore
```
```python
</
```
```python
description
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
javax.jdo.option.ConnectionUserName
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
root
```
```python
</
```
```python
value
```
```python
>
```
```python
<
```
```python
description
```
```python
>
```
```python
username to use against metastore database
```
```python
</
```
```python
description
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
```python
<
```
```python
property
```
```python
>
```
```python
<
```
```python
name
```
```python
>
```
```python
javax.jdo.option.ConnectionPassword
```
```python
</
```
```python
name
```
```python
>
```
```python
<
```
```python
value
```
```python
>
```
```python
root
```
```python
</
```
```python
value
```
```python
>
```
```python
<
```
```python
description
```
```python
>
```
```python
password to use against metastore database
```
```python
</
```
```python
description
```
```python
>
```
```python
</
```
```python
property
```
```python
>
```
```python
</
```
```python
configuration
```
```python
>
```
## 9.启动Hive
Hadoop集群要先启动
**9.1 执行命令hive**
出现不能实例化metadata的错误
![这里写图片描述](https://img-blog.csdn.net/20180820171648664?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820171648664?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
以及MySQL连接被拒绝的错误
![这里写图片描述](https://img-blog.csdn.net/20180820171657653?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820171657653?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
**9.2 首先解决MySQL连接被拒绝问题**
[

](https://img-blog.csdn.net/20180820171657653?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
```python
mysql -uroot -proot
```
```python
grant
```
```python
all
```
```python
privileges
```
```python
on
```
```python
*.*
```
```python
to
```
```python
root@
```
```python
'spark'
```
```python
identified
```
```python
by
```
```python
'root'
```
```python
;
```
```python
flush privileges;
exit;
```
[
](https://img-blog.csdn.net/20180820171657653?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)![这里写图片描述](https://img-blog.csdn.net/20180820171750426?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820171750426?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
`*.*`代表全部数据库的全部表授权，也可以指定数据库授权，如test_db.*；
all privileges代表全部权限，也可以insert,update,delete,create,drop等；
允许root用户在spark（Linux系统的主机名，IP映射）进行远程登陆，并设置root用户的密码为root。
flush privileges告诉服务器重新加载授权表。
**9.3 解决不能实例化metadata的错误**
Hive2.1的启动需要先执行schematool命令进行初始化
```python
schematool
```
```python
-dbType
```
```python
mysql
```
```python
-initSchema
```
![这里写图片描述](https://img-blog.csdn.net/20180820172156861?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/20180820172156861?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
**9.4 再次执行hive，进入到Hive Shell**
[
](https://img-blog.csdn.net/20180820172156861?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)![这里写图片描述](https://img-blog.csdn.net/201808201720046?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)[ ](https://img-blog.csdn.net/201808201720046?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
此时Hive和MySQL连接安装部署成功。
[

](https://img-blog.csdn.net/201808201720046?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
## 10.查看MySQL数据库
[
](https://img-blog.csdn.net/201808201720046?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)hive-site.xml配置的是`jdbc:mysql://spark:3306/hive?createDatabaseIfNotExist=true`，即如果不存在hive数据库会创建
默认MySQL里的数据库
![这里写图片描述](https://img-blog.csdn.net/20180820172325611?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
此时在MySQL里查看数据库，多出了hive数据库
![这里写图片描述](https://img-blog.csdn.net/20180820172338620?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

