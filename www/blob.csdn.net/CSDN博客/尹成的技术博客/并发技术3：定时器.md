
# 并发技术3：定时器 - 尹成的技术博客 - CSDN博客

2018年11月16日 09:15:50[尹成](https://me.csdn.net/yincheng01)阅读数：65个人分类：[GO语言](https://blog.csdn.net/yincheng01/article/category/7679307)



**定时器概述**
Go为我们提供了两种不同方式的计时器：
定时执行任务的计时器
周期性执行任务的计时器
**固定时间定时器**
下面的例子演示了如何使用定时器延时2秒执行一项任务
`func main() {
	//创建2秒的定时器
	timer := time.NewTimer(2*time.Second)
	//当前时间: 2018-09-25 19:17:16.8050379 +0800 CST m=+0.004010601
	fmt.Println("当前时间:", time.Now())
	//2秒后，从单向时间管道中读出内容（当前时间）
	//timer.C是一个单向的时间管道
	t := <-timer.C
	//t =  2018-09-25 19:17:18.8051013 +0800 CST m=+2.004074101
	fmt.Println("t = ", t)
}`上面的例子还可以写作
`func main() {
	fmt.Println("开始计时")
	
	//创建2秒的定时器，得到其单向输出时间管道，阻塞2秒后读出时间数据
	<- time.After(2 * time.Second)
	fmt.Println("时间到")
}`**提前终止计时器**
下面的例子中，计时器被中途stop掉了，被延时的协程将永远得不到执行
`func main() {
	//创建3秒的定时器，3秒
	timer := time.NewTimer(3 * time.Second)
	//3秒后从定时器时间管道中读取时间
	//这里子协程永远得不到执行，因为后面的代码会停掉这个计时器
	go func() {
		<-timer.C
		fmt.Println("子协程可以打印了，因为定时器的时间到了")
	}()
	//停止定时器,停止状态下，计时器失效，被timer.C所阻塞的协程永远读不出数据
	timer.Stop()
	//主协程为子协程留出足够的执行时间
	time.Sleep(6*time.Second)
	fmt.Println("GAME OVER")
}`**中途重置定时器**
下面的例子中，timer在配置为延时10秒执行后，又被重置为1秒，所以其实际延时1秒
需要注意的是，如果在reset的一刹那，定时器已经到时或者已被stop掉，则reset是无效的
`func main() {
	//创建3秒的定时器
	timer := time.NewTimer(10 * time.Second)
	//重置为1秒
	//如果已经到时，或者已经Stop掉，则重置失败
	ok := timer.Reset(1 * time.Second)
	fmt.Println("ok = ", ok, time.Now())
	//1秒后即可读出时间
	t := <-timer.C
	fmt.Println("时间到", t)
}`**周期性执行的定时器**
下面的例子将每隔一秒输出一次当前时间，5次后程序结束
`func main() {
	//创建1秒的秒表
	ticker := time.NewTicker(1 * time.Second)
	//ticker := mytime.NewTimer(1 * mytime.Second)
	i := 0
	for {
		//从秒表的管道中读出时间
		t := <-ticker.C
		i++
		fmt.Println("i = ", i, t)
		//停止秒表
		if i == 5 {
			ticker.Stop()
			break
		}
	}
	fmt.Println("Game Over")
}`学院Go语言视频主页
[https://edu.csdn.net/lecturer/1928](https://edu.csdn.net/lecturer/1928)
[清华团队带你实战区块链开发](https://ke.qq.com/course/344443?tuin=3d17195d)
扫码获取海量视频及源码   QQ群：721929980
![在这里插入图片描述](https://img-blog.csdnimg.cn/20181114143613461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=,size_16,color_FFFFFF,t_70)

