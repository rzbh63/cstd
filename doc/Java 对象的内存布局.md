# Java 对象的内存布局

 

在HotSpot虚拟机中，对象在内存中存储的布局可以分为三块区域：**对象头(Header)**、 **实例数据(Instance Data)**、**对齐填充(Padding)**。

# 对象头

HotSpot虚拟机的对象头包括两部分信息，第一部分用于存储对象自身的运行时数据；第二部分用于存储类型指针。

## 存储对象自身的运行时数据

这部分数据有HashCode、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等。这部分数据长度在32位和64位的虚拟机（为开启压缩指针）中分别为32bit和64bit，官方称它为`Mark Word`。

对象需要存储的数据很多，其实远超于32位、64位BitMap结构所能记录的限度，而对象头信息又需要与对象自身定义的数据无关的额外存储空间，考虑到虚拟机的空间效率，`Mark Word`被设计成了一个非固定的数据结构以便在极小的空间内存储尽可能多的信息。它会根据对象的状态复用自己的存储空间。

## 存储类型指针

类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。

应该注意到，并不是所有的虚拟机实现都必须在对象数据上保留类型指针，换言之，查找对象的元数据信息并不一定要经过对象本身。

# 实例数据

实例数据，即对象真正存储的有效信息，也是程序代码中所定义的各种类型的字段内容。无论是从父类继承下来的，还是子类中定义的，都需要记录起来。

这部分的存储顺序会受到虚拟机分配策略参数和字段在Java源码中定义顺序的影响。

# 对齐填充

对齐填充并不是必然存在的，也没有特别的含义，它仅仅起着占位符的作用。

比如HotSpot VM的自动内存管理系统要求对象必须是8字节的整数倍，而对象头部分正好是8字节的整数倍，那么，当实例数据部分没有对齐时，就需要通过对齐填充来补全。