
# 让计算机“唱歌”(1704) - 迂者-贺利坚的专栏 - CSDN博客

2017年05月17日 05:41:37[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：1417


本文为《汇编语言程序设计》1704小节例程。点击[链接…](http://blog.csdn.net/sxhelijian/article/details/56671827)进课程主页。
任务：编程序，让计算机“唱”歌曲《新年好》
程序：
```python
assume cs:codeseg, ds:dataseg, ss:stackseg
dataseg segment
mus_freq dw
```
```python
262
```
```python
,
```
```python
262
```
```python
,
```
```python
262
```
```python
,
```
```python
196
```
```python
dw
```
```python
330
```
```python
,
```
```python
330
```
```python
,
```
```python
330
```
```python
,
```
```python
262
```
```python
dw
```
```python
262
```
```python
,
```
```python
330
```
```python
,
```
```python
392
```
```python
,
```
```python
392
```
```python
dw
```
```python
349
```
```python
,
```
```python
330
```
```python
,
```
```python
294
```
```python
dw
```
```python
294
```
```python
,
```
```python
330
```
```python
,
```
```python
349
```
```python
,
```
```python
349
```
```python
dw
```
```python
330
```
```python
,
```
```python
294
```
```python
,
```
```python
330
```
```python
,
```
```python
262
```
```python
dw
```
```python
262
```
```python
,
```
```python
330
```
```python
,
```
```python
294
```
```python
,
```
```python
196
```
```python
dw
```
```python
247
```
```python
,
```
```python
294
```
```python
,
```
```python
262
```
```python
,-
```
```python
1
```
```python
mus_time dw
```
```python
3
```
```python
dup(
```
```python
12
```
```python
,
```
```python
12
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
),
```
```python
12
```
```python
,
```
```python
12
```
```python
,
```
```python
50
```
```python
dw
```
```python
3
```
```python
dup(
```
```python
12
```
```python
,
```
```python
12
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
),
```
```python
12
```
```python
,
```
```python
12
```
```python
,
```
```python
50
```
```python
dataseg ends
stackseg segment
   db
```
```python
100
```
```python
h dup (
```
```python
0
```
```python
)
stackseg ends
codeseg segment
```
```python
start:
```
```python
mov
```
```python
ax, stackseg
```
```python
mov
```
```python
ss, ax
```
```python
mov
```
```python
sp,
```
```python
100
```
```python
h
```
```python
mov
```
```python
ax, dataseg
```
```python
mov
```
```python
ds, ax
    lea si, mus_freq
    lea di, mus_time
```
```python
play:
```
```python
mov
```
```python
dx, [si]
    cmp dx, -
```
```python
1
```
```python
je end_play
```
```python
call
```
```python
sound
```
```python
add
```
```python
si,
```
```python
2
```
```python
add
```
```python
di,
```
```python
2
```
```python
jmp
```
```python
play
```
```python
end_play:
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
    int
```
```python
21
```
```python
h
```
```python
;演奏一个音符
```
```python
;入口参数：si - 要演奏的音符的频率的地址
```
```python
;          di - 要演奏的音符的音长的地址
```
```python
sound:
```
```python
push
```
```python
ax
```
```python
push
```
```python
dx
```
```python
push
```
```python
cx
```
```python
;8253 芯片(定时/计数器)的设置
```
```python
mov
```
```python
al,
```
```python
0
```
```python
b6h
```
```python
;8253初始化
```
```python
out
```
```python
43
```
```python
h,al
```
```python
;43H是8253芯片控制口的端口地址
```
```python
mov
```
```python
dx,
```
```python
12
```
```python
h
```
```python
mov
```
```python
ax,
```
```python
34
```
```python
dch
    div word ptr [si]
```
```python
;计算分频值,赋给ax。[si]中存放声音的频率值。
```
```python
out
```
```python
42
```
```python
h, al
```
```python
;先送低8位到计数器，42h是8253芯片通道2的端口地址
```
```python
mov
```
```python
al, ah
```
```python
out
```
```python
42
```
```python
h, al
```
```python
;后送高8位计数器
```
```python
;设置8255芯片, 控制扬声器的开/关
```
```python
in
```
```python
al,
```
```python
61
```
```python
h
```
```python
;读取8255 B端口原值
```
```python
mov
```
```python
ah,al
```
```python
;保存原值
```
```python
or
```
```python
al,
```
```python
3
```
```python
;使低两位置1，以便打开开关
```
```python
out
```
```python
61
```
```python
h,al
```
```python
;开扬声器, 发声
```
```python
mov
```
```python
dx, [di]
```
```python
;保持[di]时长
```
```python
wait1:
```
```python
mov
```
```python
cx,
```
```python
28000
```
```python
delay:
```
```python
nop
```
```python
loop delay
```
```python
dec
```
```python
dx
    jnz wait1
```
```python
mov
```
```python
al, ah
```
```python
;恢复扬声器端口原值
```
```python
out
```
```python
61
```
```python
h, al
```
```python
pop
```
```python
cx
```
```python
pop
```
```python
dx
```
```python
pop
```
```python
ax
```
```python
ret
```
```python
codeseg ends
end start
```
附1：《新年好歌谱》
![这里写图片描述](https://img-blog.csdn.net/20170517053551510?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)[ ](https://img-blog.csdn.net/20170517053551510?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
附2：音符和发音频率(Hz)的对应关系
![这里写图片描述](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)[ ](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
附3：Mary had a little lamb数字化歌谱
[
](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
```python
dataseg segment
mus_freq dw 330, 294, 262, 294, 330, 330, 330
         dw 294, 294, 294, 330, 392, 392, 392
         dw 330, 294, 262, 294, 330, 330, 330, 330
         dw 294, 294, 330, 294, 262, -1
mus_time dw 6
```
```python
dup(
```
```python
25
```
```python
)
```
```python
, 50
         dw 2
```
```python
dup(
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
50
```
```python
)
```
```python
dw 12
```
```python
dup(
```
```python
25
```
```python
)
```
```python
, 100
dataseg ends
```
[
](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)附4：《九儿》数字化歌谱（部分）
[

](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
```python
dataseg segment
   mus_freq dw
```
```python
440
```
```python
,
```
```python
587
```
```python
,
```
```python
587
```
```python
,
```
```python
523
```
```python
,
```
```python
494
```
```python
,
```
```python
440
```
```python
,
```
```python
392
```
```python
dw
```
```python
440
```
```python
,
```
```python
294
```
```python
dw
```
```python
440
```
```python
,
```
```python
587
```
```python
,
```
```python
587
```
```python
,
```
```python
523
```
```python
,
```
```python
494
```
```python
,
```
```python
392
```
```python
,
```
```python
440
```
```python
,
```
```python
492
```
```python
,
```
```python
440
```
```python
,  -
```
```python
1
```
```python
mus_time dw25,
```
```python
50
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
dw
```
```python
50
```
```python
,
```
```python
150
```
```python
dw
```
```python
25
```
```python
,
```
```python
50
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
25
```
```python
,
```
```python
12
```
```python
,
```
```python
12
```
```python
,
```
```python
50
```
```python
,
```
```python
175
```
```python
dataseg
```
```python
ends
```
[            ](https://img-blog.csdn.net/20170517053847090?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

[
  ](https://img-blog.csdn.net/20170517053551510?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3hoZWxpamlhbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)