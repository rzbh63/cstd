
# C++游戏系列6：自己动起来 - 迂者-贺利坚的专栏 - CSDN博客

2016年04月13日 22:54:08[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：6141


**更多见：****[C++游戏系列目录](http://blog.csdn.net/sxhelijian/article/details/51148381)**
**知识点**：（1）对象数组，自动生成了很多个“玩家”（角色类的对象），自动玩；（2）使用文件：武器要从文件中读，玩的过程，写入到了文件。
**不足（待改进之处**）：（1）产生随机数时，没有避免重复，以致于会有自己攻击自己的情况——好在加了血又减去了，没有变化，还有同样的武器会有多件——都是棍，但带两条棍，也行；（2）只是让自动产生的角色玩起来了，自己没有参与，其实，指定对象数组中第0个对象就是自己（随机选取动作者时，随机数最小为1），加个菜单，选择动作，即可。
【项目-让玩家自己动起来】
（与前几个版本相比，主要变化在main.cpp中）
1.game.h：类声明
```python
#ifndef GAME_H_INCLUDED
```
```python
#
```
```python
define
```
```python
GAME_H_INCLUDED
```
```python
#include <string>
```
```python
using
```
```python
namespace std;
```
```python
const
```
```python
int
```
```python
N=
```
```python
5
```
```python
;
```
```python
//每个角色最多拥有的武器
```
```python
const
```
```python
int
```
```python
M=
```
```python
30
```
```python
;
```
```python
//游戏人物的最大数
```
```python
const
```
```python
int
```
```python
NOWEAPON=-
```
```python
1
```
```python
;
```
```python
//表示手中无武器
```
```python
const
```
```python
int
```
```python
SIZE=
```
```python
100
```
```python
;
```
```python
//将从文件是读取武器信息，最多100种武器
```
```python
class Point
```
```python
//Point类声明
```
```python
{
```
```python
public
```
```python
: //外部接口
```
```python
Point
```
```python
(
```
```python
int
```
```python
x=
```
```python
0
```
```python
,
```
```python
int
```
```python
y=
```
```python
0
```
```python
);
```
```python
int
```
```python
getX();
```
```python
int
```
```python
getY();
```
```python
double
```
```python
distance(
```
```python
const
```
```python
Point &p);
```
```python
//返回与另外一点p之间的距离
```
```python
void
```
```python
moveTo(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y);
```
```python
//移到另外一点
```
```python
void
```
```python
move(
```
```python
int
```
```python
dx,
```
```python
int
```
```python
dy);
```
```python
//从当前位置移动
```
```python
private
```
```python
:
```
```python
int
```
```python
x, y;
```
```python
//座标
```
```python
};
class Weapon
{
```
```python
public
```
```python
:
```
```python
Weapon
```
```python
(){};
    Weapon(
```
```python
string
```
```python
wnam,
```
```python
int
```
```python
f,
```
```python
double
```
```python
k);
    Weapon(
```
```python
const
```
```python
Weapon&);
```
```python
string
```
```python
getWname();
```
```python
int
```
```python
getForce();
```
```python
//返回杀伤力
```
```python
double
```
```python
getKillRange();
```
```python
//返回杀伤距离
```
```python
void
```
```python
setWeapon(
```
```python
string
```
```python
,
```
```python
int
```
```python
,
```
```python
double
```
```python
);
```
```python
private
```
```python
:
```
```python
string
```
```python
wname;
```
```python
//名称
```
```python
int
```
```python
force;
```
```python
//杀伤力
```
```python
double
```
```python
killRange;
```
```python
//杀伤距离
```
```python
};
class Role
{
```
```python
public
```
```python
:
```
```python
Role
```
```python
():
```
```python
weaponNum
```
```python
(0),
```
```python
holdWeapon
```
```python
(NOWEAPON){};
    Role(
```
```python
string
```
```python
nam,
```
```python
int
```
```python
b, Point l, Weapon w[],
```
```python
int
```
```python
n);
```
```python
//构造函数
```
```python
~Role();
```
```python
//析构函数
```
```python
void
```
```python
eat(
```
```python
int
```
```python
d);
```
```python
//吃东西，涨d血(死了后吃上东西可以复活)
```
```python
void
```
```python
attack(Role &r);
```
```python
//攻击别人，自己涨血，同时对方被攻击失血。血量取决于当前用的武器
```
```python
void
```
```python
beAttack(
```
```python
int
```
```python
f);
```
```python
//被别人攻击，参数f是承受的攻击力
```
```python
double
```
```python
distance(Role &r);
```
```python
//返回与另一角色的距离
```
```python
bool
```
```python
isAlived();
```
```python
//是否活着
```
```python
void
```
```python
moveTo(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y);
```
```python
//移到另外一点
```
```python
void
```
```python
move(
```
```python
int
```
```python
dx,
```
```python
int
```
```python
dy);
```
```python
//从当前位置移动
```
```python
void
```
```python
changeWeapon(
```
```python
int
```
```python
wno);
```
```python
//换手中的武器
```
```python
void
```
```python
show();
```
```python
//显示
```
```python
void
```
```python
setBaseInfo(
```
```python
string
```
```python
,
```
```python
int
```
```python
);
```
```python
//角色名称和初始血量
```
```python
void
```
```python
setLocation(
```
```python
int
```
```python
,
```
```python
int
```
```python
);
```
```python
//设置位置
```
```python
void
```
```python
addWeapon(Weapon);
```
```python
//添一件武器
```
```python
string
```
```python
getName();
```
```python
int
```
```python
getWeaponNum();
```
```python
string
```
```python
getCurWeapon();
```
```python
private
```
```python
:
```
```python
string
```
```python
name;
```
```python
//角色名称
```
```python
int
```
```python
blood;
```
```python
//当前血量
```
```python
bool
```
```python
life;
```
```python
//是否活着
```
```python
Point location;
```
```python
//位置
```
```python
Weapon weapons[N];
```
```python
//武器
```
```python
int
```
```python
weaponNum;
```
```python
//武器数目
```
```python
int
```
```python
holdWeapon;
```
```python
//现在手持哪一件武器(空手为NOWEAPON，初始时空手)
```
```python
};
```
```python
#
```
```python
endif
```
```python
// GAME_H_INCLUDED
```
2.point.cpp，定义点类，表示位置
```python
#include "game.h"
```
```python
#include <cmath>
```
```python
Point::Point(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y): x(x), y(y) { }
```
```python
int
```
```python
Point::getX()
{
```
```python
return
```
```python
x;
}
```
```python
int
```
```python
Point::getY()
{
```
```python
return
```
```python
y;
}
```
```python
//移到另外一点
```
```python
void
```
```python
Point::moveTo(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y)
{
```
```python
this
```
```python
->x=x;
```
```python
this
```
```python
->y=y;
}
```
```python
//从当前位置移动
```
```python
void
```
```python
Point::move(
```
```python
int
```
```python
dx,
```
```python
int
```
```python
dy)
{
```
```python
this
```
```python
->x+=dx;
```
```python
this
```
```python
->y+=dy;
}
```
```python
double
```
```python
Point::distance(
```
```python
const
```
```python
Point& p)
{
```
```python
double
```
```python
dx =
```
```python
this
```
```python
->x - p.x;
```
```python
double
```
```python
dy =
```
```python
this
```
```python
->y - p.y;
```
```python
return
```
```python
(sqrt(dx * dx + dy * dy));
}
```
3.weapon.cpp，定义武器类
```python
#include "game.h"
```
```python
Weapon::Weapon(
```
```python
string
```
```python
wnam,
```
```python
int
```
```python
f,
```
```python
double
```
```python
k):wname(wnam),force(f),killRange(k) {}
Weapon::Weapon(
```
```python
const
```
```python
Weapon &w):wname(w.wname),force(w.force),killRange(w.killRange) {}
```
```python
string
```
```python
Weapon::getWname()
{
```
```python
return
```
```python
wname;
}
```
```python
//返回杀伤力
```
```python
int
```
```python
Weapon::getForce()
{
```
```python
return
```
```python
force;
}
```
```python
//返回杀伤距离
```
```python
double
```
```python
Weapon::getKillRange()
{
```
```python
return
```
```python
killRange;
}
```
```python
void
```
```python
Weapon::setWeapon(
```
```python
string
```
```python
name,
```
```python
int
```
```python
f,
```
```python
double
```
```python
r)
{
    wname=name;
    force=f;
    killRange=r;
}
```
4.role.cpp，定义角色类，表示参与游戏的角色
```python
#include <iostream>
```
```python
#include "game.h"
```
```python
using
```
```python
namespace
```
```python
std
```
```python
;
Role::Role(
```
```python
string
```
```python
nam,
```
```python
int
```
```python
b, Point l, Weapon w[],
```
```python
int
```
```python
n)
    :name(nam),blood(b),location(l),weaponNum(n),holdWeapon(NOWEAPON)
{
```
```python
if
```
```python
(blood>
```
```python
0
```
```python
)
        life=
```
```python
true
```
```python
;
```
```python
else
```
```python
life=
```
```python
false
```
```python
;
```
```python
for
```
```python
(
```
```python
int
```
```python
i=
```
```python
0
```
```python
; i<n; i++)
        weapons[i]=w[i];
}
Role::~Role()
{
```
```python
cout
```
```python
<<name<<
```
```python
"退出江湖..."
```
```python
<<endl;
}
```
```python
//吃东西，涨d血(死了后吃上东西可以复活)
```
```python
void
```
```python
Role::eat(
```
```python
int
```
```python
d)
```
```python
//吃东西，涨d血(死了也能吃，别人喂的，以使能复活)
```
```python
{
    blood+=d;
```
```python
if
```
```python
(blood>
```
```python
0
```
```python
)
        life=
```
```python
true
```
```python
;
}
```
```python
//攻击别人，自己涨血，同时对方被攻击失血，血量取决于当前用的武器
```
```python
//在武器的攻击范围内才可以攻击
```
```python
void
```
```python
Role::attack(Role &r)
{
```
```python
if
```
```python
(isAlived()&&holdWeapon>NOWEAPON&&weapons[holdWeapon].getKillRange()>
```
```python
this
```
```python
->distance(r))
```
```python
//活着且在杀伤范围内
```
```python
{
        blood+=weapons[holdWeapon].getForce();
        r.beAttack(weapons[holdWeapon].getForce());
    }
}
```
```python
//被别人攻击，参数f是承受的攻击力
```
```python
void
```
```python
Role::beAttack(
```
```python
int
```
```python
f)
{
    blood-=f;
```
```python
if
```
```python
(blood<=
```
```python
0
```
```python
)
        life=
```
```python
false
```
```python
;
}
```
```python
//返回与另一角色的距离
```
```python
double
```
```python
Role::distance(Role &r)
{
```
```python
return
```
```python
location.distance(r.location);
}
```
```python
//换手中的武器
```
```python
void
```
```python
Role::changeWeapon(
```
```python
int
```
```python
wno)
{
```
```python
if
```
```python
(wno<weaponNum)
        holdWeapon=wno;
}
```
```python
//是否活着
```
```python
bool
```
```python
Role::isAlived()
{
```
```python
return
```
```python
life;
}
```
```python
//移到另外一点
```
```python
void
```
```python
Role::moveTo(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y)
{
```
```python
if
```
```python
(isAlived())
```
```python
//死了就不能动了
```
```python
location.moveTo(x,y);
}
```
```python
//从当前位置移动
```
```python
void
```
```python
Role::move(
```
```python
int
```
```python
dx,
```
```python
int
```
```python
dy)
{
```
```python
if
```
```python
(isAlived())
        location.move(dx,dy);
}
```
```python
//显示
```
```python
void
```
```python
Role::show()
{
```
```python
cout
```
```python
<<name<<
```
```python
" has "
```
```python
<<blood<<
```
```python
" blood, hold "
```
```python
;
```
```python
if
```
```python
(holdWeapon==NOWEAPON)
```
```python
cout
```
```python
<<
```
```python
"no weapon"
```
```python
;
```
```python
else
```
```python
cout
```
```python
<<weapons[holdWeapon].getWname();
```
```python
cout
```
```python
<<
```
```python
"("
```
```python
;
```
```python
for
```
```python
(
```
```python
int
```
```python
i=
```
```python
0
```
```python
; i<weaponNum; i++)
```
```python
cout
```
```python
<<weapons[i].getWname()<<
```
```python
","
```
```python
;
```
```python
cout
```
```python
<<
```
```python
"\b)"
```
```python
;
```
```python
cout
```
```python
<<
```
```python
". He is in ("
```
```python
<<location.getX()<<
```
```python
", "
```
```python
<<location.getY()<<
```
```python
") and "
```
```python
;
```
```python
if
```
```python
(isAlived())
```
```python
cout
```
```python
<<
```
```python
"alived."
```
```python
;
```
```python
else
```
```python
cout
```
```python
<<
```
```python
"dead."
```
```python
;
```
```python
cout
```
```python
<<endl;
}
```
```python
//角色名称和初始血量
```
```python
void
```
```python
Role::setBaseInfo(
```
```python
string
```
```python
nam,
```
```python
int
```
```python
b)
{
    name=nam;
    blood=b;
```
```python
if
```
```python
(blood>
```
```python
0
```
```python
)
        life=
```
```python
true
```
```python
;
}
```
```python
//设置位置
```
```python
void
```
```python
Role::setLocation(
```
```python
int
```
```python
x,
```
```python
int
```
```python
y)
{
    location.moveTo(x,y);
}
```
```python
//添一件武器
```
```python
void
```
```python
Role::addWeapon(Weapon w)
{
```
```python
if
```
```python
(weaponNum<N)
    {
        weapons[weaponNum]=w;
        weaponNum++;
    }
}
```
```python
//返回名称
```
```python
string
```
```python
Role::getName()
{
```
```python
return
```
```python
name;
}
```
```python
int
```
```python
Role::getWeaponNum()
    {
```
```python
return
```
```python
weaponNum;
    }
```
```python
string
```
```python
Role::getCurWeapon()
{
```
```python
return
```
```python
weapons[holdWeapon].getWname();
}
```
5.main.cpp，测试函数，表示位置
```python
#include <iostream>
```
```python
#include <fstream>
```
```python
#include <cstdlib>
```
```python
#include <ctime>
```
```python
#include "game.h"
```
```python
using
```
```python
namespace
```
```python
std
```
```python
;
```
```python
void
```
```python
initializeRoles(Role roles[]);
```
```python
//初始化角色，由计算机随机产生
```
```python
int
```
```python
readWeaponInfo(Weapon WeaponBase[]);
```
```python
//从文件中读取武器信息
```
```python
int
```
```python
randBetween(
```
```python
int
```
```python
low,
```
```python
int
```
```python
high);
```
```python
//产生一定范围内的随机数
```
```python
void
```
```python
play(Role roles[],
```
```python
int
```
```python
n);
```
```python
//主函数
```
```python
int
```
```python
main( )
{
    srand(time(
```
```python
0
```
```python
));
    Role roles[M];
    initializeRoles(roles);
    play(roles,
```
```python
1000
```
```python
);
```
```python
return
```
```python
0
```
```python
;
}
```
```python
//初始化角色
```
```python
void
```
```python
initializeRoles(Role roles[])
{
    Weapon weaponBase[SIZE];
```
```python
//存储系统中可以用到的武器库数组
```
```python
int
```
```python
weaponNum = readWeaponInfo(weaponBase);
```
```python
//从文件中读取武器信息到武器库数组，并返回武器种类数
```
```python
char
```
```python
cno[
```
```python
5
```
```python
];
```
```python
//人物序号
```
```python
int
```
```python
wn;
```
```python
//要加的武器数
```
```python
int
```
```python
wno;
```
```python
//要加入的武器的编号(weaponBase中的下标)
```
```python
for
```
```python
(
```
```python
int
```
```python
i=
```
```python
0
```
```python
; i<M; i++)
```
```python
//产生M个角色对象，即游戏中的人物
```
```python
{
        itoa(i,cno,
```
```python
10
```
```python
);
        roles[i].setBaseInfo(
```
```python
string
```
```python
(
```
```python
"Soldier"
```
```python
)+cno,randBetween(
```
```python
10
```
```python
,
```
```python
100
```
```python
));
        roles[i].setLocation(randBetween(
```
```python
0
```
```python
,
```
```python
1000
```
```python
),randBetween(
```
```python
0
```
```python
,
```
```python
1000
```
```python
));
        wn=randBetween(
```
```python
1
```
```python
,N);
```
```python
for
```
```python
(
```
```python
int
```
```python
j=
```
```python
0
```
```python
; j<wn; j++)
```
```python
//添加wn件武器
```
```python
{
            wno=randBetween(
```
```python
0
```
```python
,weaponNum);
            roles[i].addWeapon(weaponBase[wno]);
        }
        roles[i].changeWeapon(randBetween(
```
```python
0
```
```python
,wn));
```
```python
//当前持什么武器
```
```python
}
}
```
```python
//初始化武器库
```
```python
int
```
```python
readWeaponInfo(Weapon WeaponBase[])
{
    ifstream infile(
```
```python
"weapon.txt"
```
```python
,ios::in);
```
```python
int
```
```python
n=
```
```python
0
```
```python
;
```
```python
string
```
```python
wn;
```
```python
int
```
```python
wf;
```
```python
double
```
```python
wr;
```
```python
//分别代表武器名、杀伤力、杀伤范围
```
```python
if
```
```python
(!infile)
    {
```
```python
cerr
```
```python
<<
```
```python
"open error!"
```
```python
<<endl;
```
```python
exit
```
```python
(
```
```python
1
```
```python
);
    }
```
```python
while
```
```python
(infile>>wn>>wf>>wr)
    {
        WeaponBase[n++].setWeapon(wn,wf,wr);
    }
    infile.close();
```
```python
return
```
```python
n;
}
```
```python
//产生一定大于等于low，小于high范围内的随机数
```
```python
int
```
```python
randBetween(
```
```python
int
```
```python
low,
```
```python
int
```
```python
high)
{
```
```python
return
```
```python
low+rand()%(high-low);
}
```
```python
//玩n轮游戏，每一轮有一个角色行动
```
```python
//行动可以是攻击、移动、换武器、吃
```
```python
//所有的结果，保存到log.txt文件中
```
```python
void
```
```python
play(Role roles[],
```
```python
int
```
```python
n)
{
```
```python
int
```
```python
i;
```
```python
int
```
```python
rno,rno2;
```
```python
//选中的游戏者
```
```python
int
```
```python
action;
```
```python
//行动0-攻击，1-移动，2-换武器，3-吃东西
```
```python
int
```
```python
newx, newy, newWeapon, eatd;
    ofstream outfile(
```
```python
"log.txt"
```
```python
,ios::out);
```
```python
//创建输出流对象
```
```python
if
```
```python
(!outfile)
```
```python
//如果打开失败，outfile返回0值
```
```python
{
```
```python
cerr
```
```python
<<
```
```python
"open error!"
```
```python
<<endl;
```
```python
exit
```
```python
(
```
```python
1
```
```python
);
    }
```
```python
cout
```
```python
<<
```
```python
"开始前...."
```
```python
<<endl;
```
```python
for
```
```python
(i=
```
```python
0
```
```python
; i<M; i++)
        roles[i].show();
```
```python
cout
```
```python
<<
```
```python
"开始游戏，请到日志文件中看过程...."
```
```python
<<endl<<endl;
```
```python
for
```
```python
(i=
```
```python
0
```
```python
; i<n; i++)
    {
        rno=randBetween(
```
```python
0
```
```python
,M);
        outfile<<
```
```python
"第"
```
```python
<<i<<
```
```python
"轮: "
```
```python
<<roles[rno].getName();
        action=randBetween(
```
```python
0
```
```python
,
```
```python
4
```
```python
);
```
```python
switch
```
```python
(action)
        {
```
```python
case
```
```python
0
```
```python
:
```
```python
//攻击
```
```python
rno2=randBetween(
```
```python
0
```
```python
,M);
            outfile<<
```
```python
"攻击"
```
```python
<<roles[rno2].getName();
            roles[rno].attack(roles[rno2]);
```
```python
break
```
```python
;
```
```python
case
```
```python
1
```
```python
:
```
```python
//移动
```
```python
newx=randBetween(
```
```python
0
```
```python
,
```
```python
1000
```
```python
);
            newy=randBetween(
```
```python
0
```
```python
,
```
```python
1000
```
```python
);
            outfile<<
```
```python
"移动到("
```
```python
<<newx<<
```
```python
","
```
```python
<<newy<<
```
```python
")"
```
```python
;
            roles[rno].moveTo(newx,newy);
```
```python
break
```
```python
;
```
```python
case
```
```python
2
```
```python
:
```
```python
//换武器
```
```python
newWeapon=randBetween(
```
```python
0
```
```python
,roles[rno].getWeaponNum());
            roles[rno].changeWeapon(newWeapon);
            outfile<<
```
```python
"将武器换为: "
```
```python
<<roles[rno].getCurWeapon();
```
```python
break
```
```python
;
```
```python
case
```
```python
3
```
```python
:
```
```python
//吃
```
```python
eatd=randBetween(
```
```python
0
```
```python
,
```
```python
100
```
```python
);
            roles[rno].eat(eatd);
            outfile<<
```
```python
"吃了: "
```
```python
<<eatd;
```
```python
break
```
```python
;
        }
        outfile<<
```
```python
". "
```
```python
<<endl;
    }
    outfile<<endl;
            outfile.close();
```
```python
cout
```
```python
<<
```
```python
"游戏结束后...."
```
```python
<<endl;
```
```python
for
```
```python
(i=
```
```python
0
```
```python
; i<M; i++)
        roles[i].show();
}
```

