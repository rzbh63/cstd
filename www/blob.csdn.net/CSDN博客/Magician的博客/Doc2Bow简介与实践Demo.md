
# Doc2Bow简介与实践Demo - Magician的博客 - CSDN博客


2018年06月05日 11:21:55[春雨里de太阳](https://me.csdn.net/qq_16633405)阅读数：2526


Doc2Bow是Gensim中封装的一个方法，主要用于实现Bow模型，下面主要介绍下Bow模型。
## 1、BoW模型原理
Bag-of-words model (BoW model) 最早出现在自然语言处理（Natural Language Processing）和信息检索（Information Retrieval）领域.。该模型忽略掉文本的语法和语序等要素，将其仅仅看作是若干个词汇的集合，文档中每个单词的出现都是独立的。**BoW使用一组无序的单词(words)来表达一段文字或一个文档.**。近年来，**BoW模型被广泛应用于计算机视觉中。**
基于文本的BoW模型的一个简单例子如下：
首先给出两个简单的文本文档如下：
```python
John likes
```
```python
to
```
```python
watch movies. Mary likes too.
    John also likes
```
```python
to
```
```python
watch football games.
```
基于上述两个文档中出现的单词，构建如下一个词典 (dictionary)：
```python
{"
```
```python
John
```
```python
":
```
```python
1
```
```python
, "
```
```python
likes
```
```python
":
```
```python
2
```
```python
,"
```
```python
to
```
```python
":
```
```python
3
```
```python
, "
```
```python
watch
```
```python
":
```
```python
4
```
```python
, "
```
```python
movies
```
```python
":
```
```python
5
```
```python
,"
```
```python
also
```
```python
":
```
```python
6
```
```python
, "
```
```python
football
```
```python
":
```
```python
7
```
```python
, "
```
```python
games
```
```python
":
```
```python
8
```
```python
,"
```
```python
Mary
```
```python
":
```
```python
9
```
```python
, "
```
```python
too
```
```python
":
```
```python
10
```
```python
}
```
上面的词典中包含10个单词, 每个单词有唯一的索引, 那么每个文本我们可以使用一个10维的向量来表示。如下：
```python
[
```
```python
1
```
```python
,
```
```python
2
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
0
```
```python
,
```
```python
0
```
```python
,
```
```python
0
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
]
     [
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
0
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
0
```
```python
,
```
```python
0
```
```python
]
```
该向量与原来文本中单词出现的顺序没有关系，而是词典中每个单词在文本中出现的频率。
也是通过余弦定理计算两个句子的相似度。
## 2、实践Demo
```python
import
```
```python
gensim
```
```python
import
```
```python
jieba
```
```python
# 训练样本
```
```python
from
```
```python
gensim
```
```python
import
```
```python
corpora
```
```python
from
```
```python
gensim.similarities
```
```python
import
```
```python
Similarity
```
```python
# fin = open("questions.txt",encoding='utf8').read().strip(' ')   #strip()取出首位空格
```
```python
jieba.load_userdict(
```
```python
"userdict.txt"
```
```python
)
stopwords = set(open(
```
```python
'stopwords.txt'
```
```python
,encoding=
```
```python
'utf8'
```
```python
).read().strip(
```
```python
'\n'
```
```python
).split(
```
```python
'\n'
```
```python
))
```
```python
#读入停用词
```
```python
raw_documents = [
```
```python
'0无偿居间介绍买卖毒品的行为应如何定性'
```
```python
,
```
```python
'1吸毒男动态持有大量毒品的行为该如何认定'
```
```python
,
```
```python
'2如何区分是非法种植毒品原植物罪还是非法制造毒品罪'
```
```python
,
```
```python
'3为毒贩贩卖毒品提供帮助构成贩卖毒品罪'
```
```python
,
```
```python
'4将自己吸食的毒品原价转让给朋友吸食的行为该如何认定'
```
```python
,
```
```python
'5为获报酬帮人购买毒品的行为该如何认定'
```
```python
,
```
```python
'6毒贩出狱后再次够买毒品途中被抓的行为认定'
```
```python
,
```
```python
'7虚夸毒品功效劝人吸食毒品的行为该如何认定'
```
```python
,
```
```python
'8妻子下落不明丈夫又与他人登记结婚是否为无效婚姻'
```
```python
,
```
```python
'9一方未签字办理的结婚登记是否有效'
```
```python
,
```
```python
'10夫妻双方1990年按农村习俗举办婚礼没有结婚证 一方可否起诉离婚'
```
```python
,
```
```python
'11结婚前对方父母出资购买的住房写我们二人的名字有效吗'
```
```python
,
```
```python
'12身份证被别人冒用无法登记结婚怎么办？'
```
```python
,
```
```python
'13同居后又与他人登记结婚是否构成重婚罪'
```
```python
,
```
```python
'14未办登记只举办结婚仪式可起诉离婚吗'
```
```python
,
```
```python
'15同居多年未办理结婚登记，是否可以向法院起诉要求离婚'
```
```python
]
corpora_documents = []
```
```python
for
```
```python
item_text
```
```python
in
```
```python
raw_documents:
    item_str = jieba.lcut(item_text)
    print(item_str)
    corpora_documents.append(item_str)
print(corpora_documents)
```
```python
# 生成字典和向量语料
```
```python
dictionary = corpora.Dictionary(corpora_documents)
corpus = [dictionary.doc2bow(text)
```
```python
for
```
```python
text
```
```python
in
```
```python
corpora_documents]
```
```python
#num_features代表生成的向量的维数（根据词袋的大小来定）
```
```python
similarity = Similarity(
```
```python
'-Similarity-index'
```
```python
, corpus, num_features=
```
```python
400
```
```python
)
test_data_1 =
```
```python
'你好，我想问一下我想离婚他不想离，孩子他说不要，是六个月就自动生效离婚'
```
```python
test_cut_raw_1 = jieba.lcut(test_data_1)
print(test_cut_raw_1)
test_corpus_1 = dictionary.doc2bow(test_cut_raw_1)
similarity.num_best =
```
```python
5
```
```python
print(similarity[test_corpus_1])
```
```python
# 返回最相似的样本材料,(index_of_document, similarity) tuples
```
```python
print(
```
```python
'################################'
```
```python
)
test_data_2 =
```
```python
'家人因涉嫌运输毒品被抓，她只是去朋友家探望朋友的，结果就被抓了，还在朋友家收出毒品，可家人的身上和行李中都没有。现在已经拘留10多天了，请问会被判刑吗'
```
```python
test_cut_raw_2 = jieba.lcut(test_data_2)
print(test_cut_raw_2)
test_corpus_2 = dictionary.doc2bow(test_cut_raw_2)
similarity.num_best =
```
```python
5
```
```python
print(similarity[test_corpus_2])
```
```python
# 返回最相似的样本材料,(index_of_document, similarity) tuples
```
运行结果：
![这里写图片描述](https://img-blog.csdn.net/2018060511190737?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE2NjMzNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
针对以上程序，你可以自定义词库和停用词来使最终的结果更好。
参考：[https://blog.csdn.net/vs412237401/article/details/52238248](https://blog.csdn.net/vs412237401/article/details/52238248)

