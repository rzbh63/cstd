
# 如何通过.def文件的方式导出类 - 机器学习的小学生 - CSDN博客


2017年03月20日 15:30:15[机器学习的小学生](https://me.csdn.net/xuluhui123)阅读数：2154


看了许多资料，大部分都是通过__declspec(dllexport) 修饰符进行导出的。
通过.def文件导出函数和类都可以实现，但是导出模板函数和模板类却没有找到，但是没关系。
## 例子:
**dll_test.h**
```python
#ifndef DLL_TEST_H
```
```python
#define DLL_TEST_H
```
```python
#define  DLL_EXPORT __declspec(dllexport)
```
```python
#include<string>
```
```python
using
```
```python
namespace
```
```python
std
```
```python
;
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype>
```
```python
class
```
```python
Operation
{
```
```python
public
```
```python
:
```
```python
virtual
```
```python
Dtype getResult(Dtype a, Dtype b) =
```
```python
0
```
```python
;
```
```python
virtual
```
```python
void
```
```python
destorySelf() {
```
```python
this
```
```python
->~Operation(); }
```
```python
virtual
```
```python
~Operation() {};
};
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype>
```
```python
class
```
```python
OperationSub :
```
```python
public
```
```python
Operation<Dtype>
{
```
```python
public
```
```python
:
    Dtype getResult(Dtype a, Dtype b);
};
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype>
```
```python
class
```
```python
OperationMul :
```
```python
public
```
```python
Operation<Dtype>
{
```
```python
public
```
```python
:
    Dtype getResult(Dtype a, Dtype b);
};
```
```python
//导出工厂函数
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype>  Operation<Dtype> *  createOperator(
```
```python
string
```
```python
oper);
```
```python
template
```
```python
<> DLL_EXPORT Operation<
```
```python
float
```
```python
> *  createOperator(
```
```python
string
```
```python
oper);
```
```python
//模板特化声明
```
```python
template
```
```python
<> DLL_EXPORT Operation<
```
```python
double
```
```python
> *  createOperator(
```
```python
string
```
```python
oper);
```
```python
//模板特化声明
```
```python
#endif
```
**dll_test.cpp**
```python
#include"dll_test.h"
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype> Dtype OperationSub<Dtype>::getResult(Dtype a, Dtype b) {
```
```python
return
```
```python
(a - b); }
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype> Dtype OperationMul<Dtype>::getResult(Dtype a, Dtype b) {
```
```python
return
```
```python
(a * b); }
```
```python
template
```
```python
<
```
```python
typename
```
```python
Dtype>  Operation<Dtype> *  createOperator (
```
```python
string
```
```python
oper) 
{
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"-"
```
```python
)==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationSub<Dtype>();
    }
```
```python
else
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"*"
```
```python
) ==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationMul<Dtype>();
    }
}
```
```python
// 模板特化 float
```
```python
template
```
```python
<> DLL_EXPORT Operation<
```
```python
float
```
```python
> * createOperator(
```
```python
string
```
```python
oper)
{
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"-"
```
```python
) ==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationSub<
```
```python
float
```
```python
>();
    }
```
```python
else
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"*"
```
```python
) ==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationMul<
```
```python
float
```
```python
>();
    }
}
```
```python
// 模板特化 double
```
```python
template
```
```python
<> DLL_EXPORT Operation<
```
```python
double
```
```python
> * createOperator(
```
```python
string
```
```python
oper)
{
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"-"
```
```python
) ==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationSub<
```
```python
double
```
```python
>();
    }
```
```python
else
```
```python
if
```
```python
(
```
```python
strcmp
```
```python
(oper.c_str(),
```
```python
"*"
```
```python
) ==
```
```python
0
```
```python
)
    {
```
```python
return
```
```python
new
```
```python
OperationMul<
```
```python
double
```
```python
>();
    }
}
```
测试函数:
将上面的代码编译生成动态库dll，将文件.h,lib,dll添加到测试函数所在的工程。
**test.cpp**
```python
#include"dll_test.h"
```
```python
#include<string>
```
```python
#include<iostream>
```
```python
//#pragma comment(lib,"dll_test.lib")
```
```python
int
```
```python
main()
{
    Operation<
```
```python
float
```
```python
> *foper = createOperator<
```
```python
float
```
```python
>(
```
```python
"-"
```
```python
);
    Operation<
```
```python
double
```
```python
> *doper = createOperator<
```
```python
double
```
```python
>(
```
```python
"*"
```
```python
);
```
```python
float
```
```python
fresult = foper->getResult(
```
```python
10
```
```python
,
```
```python
5
```
```python
);
```
```python
double
```
```python
dresult = doper->getResult(
```
```python
10
```
```python
,
```
```python
5
```
```python
);
```
```python
cout
```
```python
<< fresult << endl;
```
```python
cout
```
```python
<< dresult << endl;
}
```
参考文献：
1.[http://forums.codeguru.com/showthread.php?364061-How-to-export-c-class-in-DLL-using-DEF-file](http://forums.codeguru.com/showthread.php?364061-How-to-export-c-class-in-DLL-using-DEF-file)
2.[https://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL](https://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL)[HowTo: Export C++ classes from a DLL]
3.[http://www.mingw.org/wiki/exporting_a_class_from_a_dll_for_multiple_instantiations](http://www.mingw.org/wiki/exporting_a_class_from_a_dll_for_multiple_instantiations)

