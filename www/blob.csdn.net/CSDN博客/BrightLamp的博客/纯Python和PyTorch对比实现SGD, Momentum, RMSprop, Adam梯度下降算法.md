
# 纯Python和PyTorch对比实现SGD, Momentum, RMSprop, Adam梯度下降算法 - BrightLamp的博客 - CSDN博客


2018年12月22日 22:27:18[BrightLampCsdn](https://me.csdn.net/oBrightLamp)阅读数：177



## 摘要
本文使用纯 Python 和 PyTorch 对比实现SGD, Momentum, RMSprop, Adam梯度下降算法.
## 相关
*原理和详细解释, 请参考: :*
常用梯度下降算法SGD, Momentum, RMSprop, Adam详解
*文章索引 :*
[https://blog.csdn.net/oBrightLamp/article/details/85067981](https://blog.csdn.net/oBrightLamp/article/details/85067981)
## 正文
### 1. 算法类
文件目录 : vanilla_nn/optim.py
```python
import
```
```python
numpy
```
```python
as
```
```python
np
```
```python
class
```
```python
SGD
```
```python
:
```
```python
def
```
```python
__init__
```
```python
(
```
```python
self
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.01
```
```python
)
```
```python
:
```
```python
self
```
```python
.
```
```python
lr
```
```python
=
```
```python
lr
```
```python
def
```
```python
__call__
```
```python
(
```
```python
self
```
```python
,
```
```python
params
```
```python
,
```
```python
grads
```
```python
)
```
```python
:
```
```python
params
```
```python
-=
```
```python
self
```
```python
.
```
```python
lr
```
```python
*
```
```python
grads
```
```python
class
```
```python
Momentum
```
```python
:
```
```python
def
```
```python
__init__
```
```python
(
```
```python
self
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.01
```
```python
,
```
```python
momentum
```
```python
=
```
```python
0.9
```
```python
)
```
```python
:
```
```python
self
```
```python
.
```
```python
lr
```
```python
=
```
```python
lr
        self
```
```python
.
```
```python
momentum
```
```python
=
```
```python
momentum
        self
```
```python
.
```
```python
v
```
```python
=
```
```python
None
```
```python
def
```
```python
__call__
```
```python
(
```
```python
self
```
```python
,
```
```python
params
```
```python
,
```
```python
grads
```
```python
)
```
```python
:
```
```python
if
```
```python
self
```
```python
.
```
```python
v
```
```python
is
```
```python
None
```
```python
:
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
np
```
```python
.
```
```python
zeros_like
```
```python
(
```
```python
params
```
```python
)
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
self
```
```python
.
```
```python
momentum
```
```python
*
```
```python
self
```
```python
.
```
```python
v
```
```python
+
```
```python
grads
        params
```
```python
-=
```
```python
self
```
```python
.
```
```python
lr
```
```python
*
```
```python
self
```
```python
.
```
```python
v
```
```python
class
```
```python
RMSProp
```
```python
:
```
```python
def
```
```python
__init__
```
```python
(
```
```python
self
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.01
```
```python
,
```
```python
alpha
```
```python
=
```
```python
0.9
```
```python
,
```
```python
eps
```
```python
=
```
```python
1e
```
```python
-
```
```python
08
```
```python
)
```
```python
:
```
```python
self
```
```python
.
```
```python
lr
```
```python
=
```
```python
lr
        self
```
```python
.
```
```python
alpha
```
```python
=
```
```python
alpha
        self
```
```python
.
```
```python
eps
```
```python
=
```
```python
eps
        self
```
```python
.
```
```python
v
```
```python
=
```
```python
None
```
```python
def
```
```python
__call__
```
```python
(
```
```python
self
```
```python
,
```
```python
params
```
```python
,
```
```python
grads
```
```python
)
```
```python
:
```
```python
if
```
```python
self
```
```python
.
```
```python
v
```
```python
is
```
```python
None
```
```python
:
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
np
```
```python
.
```
```python
zeros_like
```
```python
(
```
```python
params
```
```python
)
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
self
```
```python
.
```
```python
alpha
```
```python
*
```
```python
self
```
```python
.
```
```python
v
        self
```
```python
.
```
```python
v
```
```python
+=
```
```python
(
```
```python
1
```
```python
-
```
```python
self
```
```python
.
```
```python
alpha
```
```python
)
```
```python
*
```
```python
np
```
```python
.
```
```python
square
```
```python
(
```
```python
grads
```
```python
)
```
```python
eta
```
```python
=
```
```python
self
```
```python
.
```
```python
lr
```
```python
/
```
```python
(
```
```python
np
```
```python
.
```
```python
sqrt
```
```python
(
```
```python
self
```
```python
.
```
```python
v
```
```python
)
```
```python
+
```
```python
self
```
```python
.
```
```python
eps
```
```python
)
```
```python
params
```
```python
-=
```
```python
eta
```
```python
*
```
```python
grads
```
```python
class
```
```python
Adam
```
```python
:
```
```python
def
```
```python
__init__
```
```python
(
```
```python
self
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.01
```
```python
,
```
```python
betas
```
```python
=
```
```python
(
```
```python
0.9
```
```python
,
```
```python
0.999
```
```python
)
```
```python
,
```
```python
eps
```
```python
=
```
```python
1e
```
```python
-
```
```python
08
```
```python
)
```
```python
:
```
```python
self
```
```python
.
```
```python
lr
```
```python
=
```
```python
lr
        self
```
```python
.
```
```python
beta1
```
```python
=
```
```python
betas
```
```python
[
```
```python
0
```
```python
]
```
```python
self
```
```python
.
```
```python
beta2
```
```python
=
```
```python
betas
```
```python
[
```
```python
1
```
```python
]
```
```python
self
```
```python
.
```
```python
eps
```
```python
=
```
```python
eps
        self
```
```python
.
```
```python
m
```
```python
=
```
```python
None
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
None
```
```python
self
```
```python
.
```
```python
n
```
```python
=
```
```python
0
```
```python
def
```
```python
__call__
```
```python
(
```
```python
self
```
```python
,
```
```python
params
```
```python
,
```
```python
grads
```
```python
)
```
```python
:
```
```python
if
```
```python
self
```
```python
.
```
```python
m
```
```python
is
```
```python
None
```
```python
:
```
```python
self
```
```python
.
```
```python
m
```
```python
=
```
```python
np
```
```python
.
```
```python
zeros_like
```
```python
(
```
```python
params
```
```python
)
```
```python
if
```
```python
self
```
```python
.
```
```python
v
```
```python
is
```
```python
None
```
```python
:
```
```python
self
```
```python
.
```
```python
v
```
```python
=
```
```python
np
```
```python
.
```
```python
zeros_like
```
```python
(
```
```python
params
```
```python
)
```
```python
self
```
```python
.
```
```python
n
```
```python
+=
```
```python
1
```
```python
self
```
```python
.
```
```python
m
```
```python
=
```
```python
self
```
```python
.
```
```python
beta1
```
```python
*
```
```python
self
```
```python
.
```
```python
m
```
```python
+
```
```python
(
```
```python
1
```
```python
-
```
```python
self
```
```python
.
```
```python
beta1
```
```python
)
```
```python
*
```
```python
grads
        self
```
```python
.
```
```python
v
```
```python
=
```
```python
self
```
```python
.
```
```python
beta2
```
```python
*
```
```python
self
```
```python
.
```
```python
v
```
```python
+
```
```python
(
```
```python
1
```
```python
-
```
```python
self
```
```python
.
```
```python
beta2
```
```python
)
```
```python
*
```
```python
np
```
```python
.
```
```python
square
```
```python
(
```
```python
grads
```
```python
)
```
```python
alpha
```
```python
=
```
```python
self
```
```python
.
```
```python
lr
```
```python
*
```
```python
np
```
```python
.
```
```python
sqrt
```
```python
(
```
```python
1
```
```python
-
```
```python
np
```
```python
.
```
```python
power
```
```python
(
```
```python
self
```
```python
.
```
```python
beta2
```
```python
,
```
```python
self
```
```python
.
```
```python
n
```
```python
)
```
```python
)
```
```python
alpha
```
```python
=
```
```python
alpha
```
```python
/
```
```python
(
```
```python
1
```
```python
-
```
```python
np
```
```python
.
```
```python
power
```
```python
(
```
```python
self
```
```python
.
```
```python
beta1
```
```python
,
```
```python
self
```
```python
.
```
```python
n
```
```python
)
```
```python
)
```
```python
params
```
```python
-=
```
```python
alpha
```
```python
*
```
```python
self
```
```python
.
```
```python
m
```
```python
/
```
```python
(
```
```python
np
```
```python
.
```
```python
sqrt
```
```python
(
```
```python
self
```
```python
.
```
```python
v
```
```python
)
```
```python
+
```
```python
self
```
```python
.
```
```python
eps
```
```python
)
```
### 2. 算法检查
```python
import
```
```python
torch
```
```python
import
```
```python
numpy
```
```python
as
```
```python
np
```
```python
from
```
```python
vanilla_nn
```
```python
.
```
```python
optim
```
```python
import
```
```python
SGD
```
```python
,
```
```python
Momentum
```
```python
,
```
```python
RMSProp
```
```python
,
```
```python
Adam
```
```python
def
```
```python
check_optim
```
```python
(
```
```python
optim_numpy
```
```python
,
```
```python
optim_torch
```
```python
,
```
```python
p
```
```python
,
```
```python
p_torch
```
```python
)
```
```python
:
```
```python
"""
    check with y = p * x^2
    optim param p
    """
```
```python
x_size
```
```python
=
```
```python
5
```
```python
x
```
```python
=
```
```python
np
```
```python
.
```
```python
random
```
```python
.
```
```python
random
```
```python
(
```
```python
x_size
```
```python
)
```
```python
x_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
tensor
```
```python
(
```
```python
x
```
```python
,
```
```python
requires_grad
```
```python
=
```
```python
True
```
```python
)
```
```python
dxi_numpy_list
```
```python
=
```
```python
[
```
```python
]
```
```python
for
```
```python
i
```
```python
in
```
```python
range
```
```python
(
```
```python
x_size
```
```python
)
```
```python
:
```
```python
yi_numpy
```
```python
=
```
```python
p
```
```python
*
```
```python
x
```
```python
[
```
```python
i
```
```python
]
```
```python
**
```
```python
2
```
```python
dxi_numpy
```
```python
=
```
```python
2
```
```python
*
```
```python
p
```
```python
*
```
```python
x
```
```python
[
```
```python
i
```
```python
]
```
```python
dxi_numpy_list
```
```python
.
```
```python
append
```
```python
(
```
```python
dxi_numpy
```
```python
)
```
```python
da
```
```python
=
```
```python
x
```
```python
[
```
```python
i
```
```python
]
```
```python
**
```
```python
2
```
```python
optim_numpy
```
```python
(
```
```python
p
```
```python
,
```
```python
da
```
```python
)
```
```python
for
```
```python
i
```
```python
in
```
```python
range
```
```python
(
```
```python
x_size
```
```python
)
```
```python
:
```
```python
yi_torch
```
```python
=
```
```python
p_torch
```
```python
*
```
```python
x_torch
```
```python
[
```
```python
i
```
```python
]
```
```python
**
```
```python
2
```
```python
optim_torch
```
```python
.
```
```python
zero_grad
```
```python
(
```
```python
)
```
```python
yi_torch
```
```python
.
```
```python
backward
```
```python
(
```
```python
)
```
```python
optim_torch
```
```python
.
```
```python
step
```
```python
(
```
```python
)
```
```python
print
```
```python
(
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
dxi_numpy_list
```
```python
)
```
```python
)
```
```python
print
```
```python
(
```
```python
x_torch
```
```python
.
```
```python
grad
```
```python
.
```
```python
data
```
```python
.
```
```python
numpy
```
```python
(
```
```python
)
```
```python
)
```
```python
np
```
```python
.
```
```python
random
```
```python
.
```
```python
seed
```
```python
(
```
```python
123
```
```python
)
```
```python
np
```
```python
.
```
```python
set_printoptions
```
```python
(
```
```python
precision
```
```python
=
```
```python
12
```
```python
,
```
```python
suppress
```
```python
=
```
```python
True
```
```python
,
```
```python
linewidth
```
```python
=
```
```python
80
```
```python
)
```
```python
print
```
```python
(
```
```python
"--- 检查SGD ---"
```
```python
)
```
```python
a_numpy
```
```python
=
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
1.2
```
```python
)
```
```python
a_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
tensor
```
```python
(
```
```python
a_numpy
```
```python
,
```
```python
requires_grad
```
```python
=
```
```python
True
```
```python
)
```
```python
sgd_numpy
```
```python
=
```
```python
SGD
```
```python
(
```
```python
0.1
```
```python
)
```
```python
sgd_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
optim
```
```python
.
```
```python
SGD
```
```python
(
```
```python
[
```
```python
a_torch
```
```python
]
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.1
```
```python
)
```
```python
check_optim
```
```python
(
```
```python
sgd_numpy
```
```python
,
```
```python
sgd_torch
```
```python
,
```
```python
a_numpy
```
```python
,
```
```python
a_torch
```
```python
)
```
```python
print
```
```python
(
```
```python
"--- 检查Momentum ---"
```
```python
)
```
```python
a_numpy
```
```python
=
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
1.2
```
```python
)
```
```python
a_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
tensor
```
```python
(
```
```python
a_numpy
```
```python
,
```
```python
requires_grad
```
```python
=
```
```python
True
```
```python
)
```
```python
momentum_numpy
```
```python
=
```
```python
Momentum
```
```python
(
```
```python
0.1
```
```python
,
```
```python
0.9
```
```python
)
```
```python
momentum_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
optim
```
```python
.
```
```python
SGD
```
```python
(
```
```python
[
```
```python
a_torch
```
```python
]
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.1
```
```python
,
```
```python
momentum
```
```python
=
```
```python
0.9
```
```python
)
```
```python
check_optim
```
```python
(
```
```python
momentum_numpy
```
```python
,
```
```python
momentum_torch
```
```python
,
```
```python
a_numpy
```
```python
,
```
```python
a_torch
```
```python
)
```
```python
print
```
```python
(
```
```python
"--- 检查RMSProp ---"
```
```python
)
```
```python
a_numpy
```
```python
=
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
1.2
```
```python
)
```
```python
a_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
tensor
```
```python
(
```
```python
a_numpy
```
```python
,
```
```python
requires_grad
```
```python
=
```
```python
True
```
```python
)
```
```python
rms_numpy
```
```python
=
```
```python
RMSProp
```
```python
(
```
```python
0.1
```
```python
,
```
```python
0.9
```
```python
,
```
```python
eps
```
```python
=
```
```python
1e
```
```python
-
```
```python
08
```
```python
)
```
```python
rms_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
optim
```
```python
.
```
```python
RMSprop
```
```python
(
```
```python
[
```
```python
a_torch
```
```python
]
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.1
```
```python
,
```
```python
alpha
```
```python
=
```
```python
0.9
```
```python
)
```
```python
check_optim
```
```python
(
```
```python
rms_numpy
```
```python
,
```
```python
rms_torch
```
```python
,
```
```python
a_numpy
```
```python
,
```
```python
a_torch
```
```python
)
```
```python
print
```
```python
(
```
```python
"--- 检查Adam ---"
```
```python
)
```
```python
a_numpy
```
```python
=
```
```python
np
```
```python
.
```
```python
array
```
```python
(
```
```python
1.2
```
```python
)
```
```python
a_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
tensor
```
```python
(
```
```python
a_numpy
```
```python
,
```
```python
requires_grad
```
```python
=
```
```python
True
```
```python
)
```
```python
adam_numpy
```
```python
=
```
```python
Adam
```
```python
(
```
```python
lr
```
```python
=
```
```python
0.1
```
```python
,
```
```python
betas
```
```python
=
```
```python
(
```
```python
0.9
```
```python
,
```
```python
0.99
```
```python
)
```
```python
,
```
```python
eps
```
```python
=
```
```python
0.001
```
```python
)
```
```python
adam_torch
```
```python
=
```
```python
torch
```
```python
.
```
```python
optim
```
```python
.
```
```python
Adam
```
```python
(
```
```python
[
```
```python
a_torch
```
```python
]
```
```python
,
```
```python
lr
```
```python
=
```
```python
0.1
```
```python
,
```
```python
betas
```
```python
=
```
```python
(
```
```python
0.9
```
```python
,
```
```python
0.99
```
```python
)
```
```python
,
```
```python
eps
```
```python
=
```
```python
0.001
```
```python
)
```
```python
check_optim
```
```python
(
```
```python
adam_numpy
```
```python
,
```
```python
adam_torch
```
```python
,
```
```python
a_numpy
```
```python
,
```
```python
a_torch
```
```python
)
```
```python
"""
--- 检查SGD ---
[ 1.671526045435  0.658974920984  0.518721027022  1.254968104394  1.594004424417]
[ 1.671526045435  0.658974920984  0.518721027022  1.254968104394  1.594004424417]
--- 检查Momentum ---
[ 1.015455504299  2.318718975892  1.46525696166   0.886671018481  0.600349866658]
[ 1.015455504299  2.318718975892  1.46525696166   0.886671018481  0.600349866658]
--- 检查RMSProp ---
[ 0.823627238762  1.288627900967  0.503750904131  0.055347017535  0.367439505846]
[ 0.823627238762  1.288627900967  0.503750904131  0.055347017535  0.367439505846]
--- 检查Adam ---
[ 1.771188973757  0.402139865001  0.361961132239  1.035028538823  0.96262110244 ]
[ 1.771188973757  0.402139865001  0.361961132239  1.035028538823  0.96262110244 ]
"""
```

