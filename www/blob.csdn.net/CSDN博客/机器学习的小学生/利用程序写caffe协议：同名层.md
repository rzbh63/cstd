
# 利用程序写caffe协议：同名层 - 机器学习的小学生 - CSDN博客


2017年11月23日 19:40:18[机器学习的小学生](https://me.csdn.net/xuluhui123)阅读数：222


利用程序写协议，最大的困难在于：同名层的书写：
```python
# coding=gbk
```
```python
from
```
```python
caffe import layers
```
```python
as
```
```python
L,
```
```python
params
```
```python
as
```
```python
P
import caffe
ns = caffe.NetSpec()
ns.Features,ns.Headposes,ns.Smiles = L.Data(name=
```
```python
"data"
```
```python
, ntop=
```
```python
3
```
```python
,
```
```python
include
```
```python
={
```
```python
'phase'
```
```python
:caffe.TRAIN})
ns.test_data = L.Data(name=
```
```python
"data"
```
```python
, ntop =
```
```python
0
```
```python
, top=[
```
```python
'Features'
```
```python
,
```
```python
'Headposes'
```
```python
,
```
```python
'Smiles'
```
```python
],
```
```python
include
```
```python
={
```
```python
'phase'
```
```python
:caffe.TEST})
print
```
```python
'{}'
```
```python
.
```
```python
format
```
```python
(ns.to_proto())
```
输出：
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"data"
```
```python
type:
```
```python
"Data"
```
```python
top:
```
```python
"Features"
```
```python
top:
```
```python
"Headposes"
```
```python
top:
```
```python
"Smiles"
```
```python
include {
    phase: TRAIN
```
```python
}
}
```
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"data"
```
```python
type:
```
```python
"Data"
```
```python
top:
```
```python
"Features"
```
```python
top:
```
```python
"Headposes"
```
```python
top:
```
```python
"Smiles"
```
```python
include {
    phase: TEST
```
```python
}
}
```
黏在一起的书写：
```python
n.
```
```python
relu1=
```
```python
L.
```
```python
ReLU(
```
```python
n.
```
```python
conv1,ntop =
```
```python
0
```
```python
,top=
```
```python
'conv1'
```
```python
)
```
```python
n.
```
```python
norm1 =
```
```python
L.
```
```python
LRN(
```
```python
n.
```
```python
conv1,local_size=
```
```python
5
```
```python
,alpha=
```
```python
0.0001
```
```python
,
```
```python
beta
```
```python
=
```
```python
0.75
```
```python
)
```
结果：
![这里写图片描述](https://img-blog.csdn.net/20171123195730867?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcmFieV9neWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
code:
```python
n.conv1 = L.Convolution(n.Features, kernel_size=
```
```python
11
```
```python
,stride=
```
```python
4
```
```python
, num_output=
```
```python
96
```
```python
, 
                            param=[dict(lr_mult=
```
```python
1
```
```python
,decay_mult=
```
```python
1
```
```python
), dict(lr_mult=
```
```python
2
```
```python
,decay_mult=
```
```python
0
```
```python
)],
                            weight_filler=dict(
```
```python
type
```
```python
=
```
```python
'gaussian'
```
```python
,std=
```
```python
0.01
```
```python
),
                            bias_filler=dict(
```
```python
type
```
```python
=
```
```python
'constant'
```
```python
,
```
```python
value
```
```python
=
```
```python
0
```
```python
))
```
output:
```python
layer
```
```python
{
```
```python
name
```
```python
:
```
```python
"conv1"
```
```python
type:
```
```python
"Convolution"
```
```python
bottom:
```
```python
"Features"
```
```python
top:
```
```python
"conv1"
```
```python
param {
    lr_mult:
```
```python
1
```
```python
decay_mult:
```
```python
1
```
```python
}
```
```python
param
```
```python
{
```
```python
lr_mult
```
```python
:
```
```python
2
```
```python
decay_mult:
```
```python
0
```
```python
}
```
```python
convolution_param
```
```python
{
```
```python
num_output
```
```python
:
```
```python
96
```
```python
kernel_size:
```
```python
11
```
```python
stride:
```
```python
4
```
```python
weight_filler {
      type:
```
```python
"gaussian"
```
```python
std:
```
```python
0.01
```
```python
}
```
```python
bias_filler
```
```python
{
```
```python
type
```
```python
:
```
```python
"constant"
```
```python
value:
```
```python
0
```
```python
}
  }
}
```
Reshape定义在Python中：
```python
n.resh = L.Reshape(n.fc3, reshape_param={
```
```python
'shape'
```
```python
:{
```
```python
'dim'
```
```python
: [
```
```python
1
```
```python
,
```
```python
1
```
```python
,
```
```python
64
```
```python
,
```
```python
64
```
```python
]}})
```
Note that the shape vector [1, 1, 64, 64] is passed as a list and not as a string like in the prototxt syntax.
In fact, any entry defined as repeated in caffe.proto, should be considered as a list/vector when interfacing using NetSpec.
参考网址：
[https://stackoverflow.com/questions/38480599/how-to-reshape-layer-in-caffe-with-python](https://stackoverflow.com/questions/38480599/how-to-reshape-layer-in-caffe-with-python)

