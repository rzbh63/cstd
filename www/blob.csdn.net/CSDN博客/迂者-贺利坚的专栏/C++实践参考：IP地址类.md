
# C++实践参考：IP地址类 - 迂者-贺利坚的专栏 - CSDN博客

2016年04月02日 22:44:01[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：1961


【项目-IP地址类】
在互联网中使用的IP地址占4字节，可以用四段法表示，每段值的范围为0-255，中间用“.”隔开，例如202.194.116.97。其实，也可以看看一个有4字节的无符号整型值3401741409。
现设计一个IP地址类，用于保存IP地址，并实施在IP地址上的一些操作。如下所示：
```python
class
```
```python
IP
{
```
```python
private
```
```python
:
```
```python
union
```
```python
//由此匿名联合体可以看出，IP地址共占4个字节
```
```python
{
```
```python
struct
```
```python
//这是一个由4个字节构成的匿名结构体
```
```python
{
```
```python
unsigned
```
```python
char
```
```python
seg0;
```
```python
unsigned
```
```python
char
```
```python
seg1;
```
```python
unsigned
```
```python
char
```
```python
seg2;
```
```python
unsigned
```
```python
char
```
```python
seg3;
        };
```
```python
//4字节的IP地址可以看作4部分，每部分1字节
```
```python
unsigned
```
```python
int
```
```python
address;
```
```python
//4字节的IP地址可以看成一个4字节的整体
```
```python
};
```
```python
public
```
```python
:
    IP(
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
);
```
```python
//构造函数
```
```python
void
```
```python
showIP();
```
```python
//用四段法显示IP地址
```
```python
bool
```
```python
sameSubnet(
```
```python
const
```
```python
IP &ip,
```
```python
const
```
```python
IP &mark);
```
```python
//判断是否处于同一子网
```
```python
char
```
```python
whatKind();
```
```python
//返回属于哪一类网络
```
```python
};
```
```python
//实现成员函数
```
```python
int
```
```python
main()
{
    IP ip1(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
116
```
```python
,
```
```python
97
```
```python
), ip2(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
119
```
```python
,
```
```python
102
```
```python
), mark(
```
```python
255
```
```python
,
```
```python
255
```
```python
,
```
```python
248
```
```python
,
```
```python
0
```
```python
);
```
```python
cout
```
```python
<<
```
```python
"ip1: "
```
```python
;
    ip1.showIP();
```
```python
cout
```
```python
<<
```
```python
"ip2: "
```
```python
;
    ip2.showIP();
```
```python
if
```
```python
(ip1.sameSubnet(ip2,mark))
```
```python
cout
```
```python
<<
```
```python
"两个IP在同一子网"
```
```python
<<endl;
```
```python
else
```
```python
cout
```
```python
<<
```
```python
"两个IP不在同一子网"
```
```python
<<endl;
```
```python
cout
```
```python
<<
```
```python
"ip1属于"
```
```python
<<ip1.whatKind()<<
```
```python
"类网络"
```
```python
<<endl;
```
```python
return
```
```python
0
```
```python
;
}
```
相关的背景知识请通过搜索引擎找到。在给出的代码中，也通过注释给了一些背景知识的介绍。
如果觉得写出来太难，可以将本题作为代码阅读题看待。
参考解答1：
```python
#include <iostream>
```
```python
using
```
```python
namespace
```
```python
std
```
```python
;
```
```python
class
```
```python
IP
{
```
```python
private
```
```python
:
```
```python
union
```
```python
{
```
```python
struct
```
```python
{
```
```python
unsigned
```
```python
char
```
```python
seg0;
```
```python
unsigned
```
```python
char
```
```python
seg1;
```
```python
unsigned
```
```python
char
```
```python
seg2;
```
```python
unsigned
```
```python
char
```
```python
seg3;
        };
```
```python
//IP地址共4字节，或者看成结构体所指4部分
```
```python
unsigned
```
```python
int
```
```python
address;
```
```python
//或者看成一个整体
```
```python
};
```
```python
public
```
```python
:
    IP(
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
);
```
```python
//构造函数
```
```python
void
```
```python
showIP();
```
```python
//用四段法显示IP地址
```
```python
bool
```
```python
sameSubnet(
```
```python
const
```
```python
IP &ip,
```
```python
const
```
```python
IP &mark);
```
```python
//判断是否处于同一子网
```
```python
char
```
```python
whatKind();
```
```python
//返回属于哪一类网络
```
```python
};
IP::IP(
```
```python
int
```
```python
s0,
```
```python
int
```
```python
s1,
```
```python
int
```
```python
s2,
```
```python
int
```
```python
s3)
{
```
```python
//下面赋值的顺序，涉及整型数据存储结构，参考[《整型数据在内存中如何存储？》](http://blog.csdn.net/sxhelijian/article/details/51015706)
```
```python
seg3=s0;
    seg2=s1;
    seg1=s2;
    seg0=s3;
}
```
```python
void
```
```python
IP::showIP()
{
```
```python
//显示结果，是给人看的，分4段合适
```
```python
cout
```
```python
<<
```
```python
int
```
```python
(seg3)<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg2)<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg1)<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg0)<<endl;
```
```python
return
```
```python
;
}
```
```python
bool
```
```python
IP::sameSubnet(
```
```python
const
```
```python
IP &ip,
```
```python
const
```
```python
IP &mark)
{
```
```python
//与子网掩码按位与，是计算机内部的操作，直接以一个整体操作更方便
```
```python
unsigned
```
```python
int
```
```python
i1, i2;
    i1=address&mark.address;
```
```python
//和子网掩码作逻辑与运算
```
```python
i2=ip.address&mark.address;
```
```python
//和子网掩码作逻辑与运算
```
```python
return
```
```python
(i1==i2);
```
```python
//与子网掩码的逻辑与运算结果相同，则属于同一子网
```
```python
}
```
```python
char
```
```python
IP::whatKind()
{
```
```python
//IP地址的类型，请到百度百科中搜索《IP地址》
```
```python
if
```
```python
(seg3<
```
```python
128
```
```python
)
```
```python
return
```
```python
'A'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg3<
```
```python
192
```
```python
)
```
```python
return
```
```python
'B'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg3<
```
```python
224
```
```python
)
```
```python
return
```
```python
'C'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg3<
```
```python
240
```
```python
)
```
```python
return
```
```python
'D'
```
```python
;
```
```python
else
```
```python
return
```
```python
'E'
```
```python
;
}
```
```python
int
```
```python
main()
{
    IP ip1(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
116
```
```python
,
```
```python
97
```
```python
), ip2(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
119
```
```python
,
```
```python
102
```
```python
), mark(
```
```python
255
```
```python
,
```
```python
255
```
```python
,
```
```python
248
```
```python
,
```
```python
0
```
```python
);
```
```python
cout
```
```python
<<
```
```python
"ip1: "
```
```python
;
    ip1.showIP();
```
```python
cout
```
```python
<<
```
```python
"ip2: "
```
```python
;
    ip2.showIP();
```
```python
if
```
```python
(ip1.sameSubnet(ip2,mark))
```
```python
cout
```
```python
<<
```
```python
"两个IP在同一子网"
```
```python
<<endl;
```
```python
else
```
```python
cout
```
```python
<<
```
```python
"两个IP不在同一子网"
```
```python
<<endl;
```
```python
cout
```
```python
<<
```
```python
"ip1属于"
```
```python
<<ip1.whatKind()<<
```
```python
"类网络"
```
```python
<<endl;
```
```python
return
```
```python
0
```
```python
;
}
```
参考解答2：
```python
#include <iostream>
```
```python
using
```
```python
namespace
```
```python
std
```
```python
;
```
```python
class
```
```python
IP
{
```
```python
private
```
```python
:
```
```python
union
```
```python
{
```
```python
unsigned
```
```python
char
```
```python
seg[
```
```python
4
```
```python
];
```
```python
//IP地址共4字节，或者看成无符号字符数组所指4部分
```
```python
unsigned
```
```python
int
```
```python
address;
```
```python
//或者看成一个整体
```
```python
};
```
```python
public
```
```python
:
    IP(
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
,
```
```python
int
```
```python
=
```
```python
0
```
```python
);
```
```python
void
```
```python
showIP();
```
```python
bool
```
```python
sameSubnet(
```
```python
const
```
```python
IP &ip,
```
```python
const
```
```python
IP &mark);
```
```python
char
```
```python
whatKind();
};
IP::IP(
```
```python
int
```
```python
s0,
```
```python
int
```
```python
s1,
```
```python
int
```
```python
s2,
```
```python
int
```
```python
s3)
{
```
```python
//下面赋值的顺序，涉及整型数据存储结构，参考[《整型数据在内存中如何存储？》](http://blog.csdn.net/sxhelijian/article/details/51015706)
```
```python
seg[
```
```python
0
```
```python
]=s3;
    seg[
```
```python
1
```
```python
]=s2;
    seg[
```
```python
2
```
```python
]=s1;
    seg[
```
```python
3
```
```python
]=s0;
}
```
```python
void
```
```python
IP::showIP()
{
```
```python
//显示结果，是给人看的，分4段合适
```
```python
cout
```
```python
<<
```
```python
int
```
```python
(seg[
```
```python
3
```
```python
])<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg[
```
```python
2
```
```python
])<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg[
```
```python
1
```
```python
])<<
```
```python
"."
```
```python
<<
```
```python
int
```
```python
(seg[
```
```python
0
```
```python
])<<endl;
```
```python
return
```
```python
;
}
```
```python
bool
```
```python
IP::sameSubnet(
```
```python
const
```
```python
IP &ip,
```
```python
const
```
```python
IP &mark)
{
```
```python
//与子网掩码按位与，是计算机内部的操作，直接以一个整体操作更方便
```
```python
unsigned
```
```python
int
```
```python
i1, i2;
    i1=address&mark.address;
```
```python
//和子网掩码作逻辑与运算
```
```python
i2=ip.address&mark.address;
```
```python
//和子网掩码作逻辑与运算
```
```python
return
```
```python
(i1==i2);
```
```python
//与子网掩码的逻辑与运算结果相同，则属于同一子网
```
```python
}
```
```python
char
```
```python
IP::whatKind()
{
```
```python
//IP地址的类型，请到百度百科中搜索《IP地址》
```
```python
if
```
```python
(seg[
```
```python
3
```
```python
]<
```
```python
128
```
```python
)
```
```python
return
```
```python
'A'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg[
```
```python
3
```
```python
]<
```
```python
192
```
```python
)
```
```python
return
```
```python
'B'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg[
```
```python
3
```
```python
]<
```
```python
224
```
```python
)
```
```python
return
```
```python
'C'
```
```python
;
```
```python
else
```
```python
if
```
```python
(seg[
```
```python
3
```
```python
]<
```
```python
240
```
```python
)
```
```python
return
```
```python
'D'
```
```python
;
```
```python
else
```
```python
return
```
```python
'E'
```
```python
;
}
```
```python
int
```
```python
main()
{
    IP ip1(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
116
```
```python
,
```
```python
97
```
```python
), ip2(
```
```python
202
```
```python
,
```
```python
194
```
```python
,
```
```python
119
```
```python
,
```
```python
102
```
```python
), mark(
```
```python
255
```
```python
,
```
```python
255
```
```python
,
```
```python
248
```
```python
,
```
```python
0
```
```python
);
```
```python
cout
```
```python
<<
```
```python
"ip1: "
```
```python
;
    ip1.showIP();
```
```python
cout
```
```python
<<
```
```python
"ip2: "
```
```python
;
    ip2.showIP();
```
```python
if
```
```python
(ip1.sameSubnet(ip2,mark))
```
```python
cout
```
```python
<<
```
```python
"两个IP在同一子网"
```
```python
<<endl;
```
```python
else
```
```python
cout
```
```python
<<
```
```python
"两个IP不在同一子网"
```
```python
<<endl;
```
```python
cout
```
```python
<<
```
```python
"ip1属于"
```
```python
<<ip1.whatKind()<<
```
```python
"类网络"
```
```python
<<endl;
```
```python
return
```
```python
0
```
```python
;
}
```

