
# python中利用最小二乘拟合二次抛物线函数 - bitcarmanlee的博客 - CSDN博客


2017年10月30日 23:07:10[bitcarmanlee](https://me.csdn.net/bitcarmanlee)阅读数：6108



## 1.最小二乘也可以拟合二次函数
我们都知道用最小二乘拟合线性函数没有问题，那么能不能拟合二次函数甚至更高次的函数呢？答案当然是可以的。下面我们就来试试用最小二乘来拟合抛物线形状的的图像。
对于二次函数来说，一般形状为 f(x) = a*x*x+b*x+c，其中a,b,c为三个我们需要求解的参数。为了确定a、b、c，我们需要根据给定的样本，然后通过调整这些参数，知道最后找出一组参数a、b、c，使这些所有的样本点距离f(x)的距离平方和最小。用什么方法来调整这些参数呢？最常见的自然就是我们的梯度下降喽。
spicy库中有名为leastsq的方法，只需要输入一系列样本点，给出待求函数的基本形状，就可以针对上述问题求解了。
## 2.抛物线拟合源码
```python
#!/usr/bin/env python
```
```python
# coding:utf-8
```
```python
import
```
```python
numpy
```
```python
as
```
```python
np
```
```python
import
```
```python
matplotlib.pyplot
```
```python
as
```
```python
plt
```
```python
from
```
```python
scipy.optimize
```
```python
import
```
```python
leastsq
```
```python
# 待拟合的数据
```
```python
X = np.array([
```
```python
1
```
```python
,
```
```python
2
```
```python
,
```
```python
3
```
```python
,
```
```python
4
```
```python
,
```
```python
5
```
```python
,
```
```python
6
```
```python
])
Y=np.array([
```
```python
9.1
```
```python
,
```
```python
18.3
```
```python
,
```
```python
32
```
```python
,
```
```python
47
```
```python
,
```
```python
69.5
```
```python
,
```
```python
94.8
```
```python
])
```
```python
# 二次函数的标准形式
```
```python
def
```
```python
func
```
```python
(params, x)
```
```python
:
```
```python
a, b, c = params
```
```python
return
```
```python
a * x * x + b * x + c
```
```python
# 误差函数，即拟合曲线所求的值与实际值的差
```
```python
def
```
```python
error
```
```python
(params, x, y)
```
```python
:
```
```python
return
```
```python
func(params, x) - y
```
```python
# 对参数求解
```
```python
def
```
```python
slovePara
```
```python
()
```
```python
:
```
```python
p0 = [
```
```python
10
```
```python
,
```
```python
10
```
```python
,
```
```python
10
```
```python
]
    Para = leastsq(error, p0, args=(X, Y))
```
```python
return
```
```python
Para
```
```python
# 输出最后的结果
```
```python
def
```
```python
solution
```
```python
()
```
```python
:
```
```python
Para = slovePara()
    a, b, c = Para[
```
```python
0
```
```python
]
```
```python
print
```
```python
"a="
```
```python
,a,
```
```python
" b="
```
```python
,b,
```
```python
" c="
```
```python
,c
```
```python
print
```
```python
"cost:"
```
```python
+ str(Para[
```
```python
1
```
```python
])
```
```python
print
```
```python
"求解的曲线是:"
```
```python
print(
```
```python
"y="
```
```python
+str(round(a,
```
```python
2
```
```python
))+
```
```python
"x*x+"
```
```python
+str(round(b,
```
```python
2
```
```python
))+
```
```python
"x+"
```
```python
+str(c))
    plt.figure(figsize=(
```
```python
8
```
```python
,
```
```python
6
```
```python
))
    plt.scatter(X, Y, color=
```
```python
"green"
```
```python
, label=
```
```python
"sample data"
```
```python
, linewidth=
```
```python
2
```
```python
)
```
```python
#   画拟合直线
```
```python
x=np.linspace(
```
```python
0
```
```python
,
```
```python
12
```
```python
,
```
```python
100
```
```python
)
```
```python
##在0-15直接画100个连续点
```
```python
y=a*x*x+b*x+c
```
```python
##函数式
```
```python
plt.plot(x,y,color=
```
```python
"red"
```
```python
,label=
```
```python
"solution line"
```
```python
,linewidth=
```
```python
2
```
```python
)
    plt.legend()
```
```python
#绘制图例
```
```python
plt.show()

solution()
```
上面的代码中，稍微注意的是如下几点：
1.func是待拟合的曲线的形状。本例中为二次函数的标准形式。
2.error为误差函数。很多同学会问不应该是最小平方和吗？为什么不是`func(params, x) - y * func(params, x) - y`？原因是名为lasts的方法中帮我们做了。看一下sklearn中源码的注释就知道什么情况了：
```python
Minimize
```
```python
the
```
```python
sum
```
```python
of
```
```python
squares
```
```python
of
```
```python
a
```
```python
set
```
```python
of
```
```python
equations.
        x = arg
```
```python
min
```
```python
(
```
```python
sum
```
```python
(func(y)**
```
```python
2
```
```python
,axis=
```
```python
0
```
```python
))
                 y
```
二次方的操作在源码中帮我们实现了。
3.p0里放的是a、b、c的初始值，这个值可以随意指定。往后随着迭代次数增加，a、b、c将会不断变化，使得error函数的值越来越小。
4.leastsq的返回值是一个tuple，它里面有两个元素，第一个元素是a、b、c的求解结果，第二个则为cost function的大小！
## 3.程序的最终结果与拟合曲线
程序最终的输出结果：
```python
a
```
```python
= 2.06607141425  b= 2.5975001036  c= 4.68999985496
cost:1
求解的曲线是:
```
```python
y
```
```python
=2.07x*x+2.6x+4.68999985496
```
最终的拟合曲线：
![这里写图片描述](https://img-blog.csdn.net/20171030225528839?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYml0Y2FybWFubGVl/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
## 4.模拟其他曲线
leastsq函数除了可以模拟线性函数二次函数等多项式，还适用于任何波形的模拟。
比如方波：
```python
def
```
```python
square_wave
```
```python
(x,p)
```
```python
:
```
```python
a, b, c, T = p
    y = np.where(np.mod(x-b,T)<T/
```
```python
2
```
```python
,
```
```python
1
```
```python
+c/a,
```
```python
0
```
```python
)
    y = np.where(np.mod(x-b,T)>T/
```
```python
2
```
```python
, -
```
```python
1
```
```python
+c/a, y)
```
```python
return
```
```python
a*y
```
比如高斯分布：
```python
def
```
```python
gaussian_wave
```
```python
(x,p)
```
```python
:
```
```python
a, b, c, d= p
```
```python
return
```
```python
a*np.exp(-(x-b)**
```
```python
2
```
```python
/(
```
```python
2
```
```python
*c**
```
```python
2
```
```python
))+d
```
只要将上面代码中的func换成对应的函数即可！

