# 图像搜索 API文档



# 简介

Hi，您好，欢迎使用百度图像搜索API服务。

本文档主要针对API开发者，描述百度以图搜图接口服务的相关技术内容。如果您对文档内容有任何疑问，可以通过以下几种方式联系我们：

- 在百度云控制台内[提交工单](http://ticket.bce.baidu.com/#/ticket/create)，咨询问题类型请选择**人工智能服务**
- 如有疑问，进入**AI社区交流**：<http://ai.baidu.com/forum/topic/list/170>
- 具有免费调用额度的接口，超过每天的免费额度后会返回错误码：17，错误信息：Open api daily request limit reached（每天流量超限额），**未上线计费的接口，可通过QQ群（630770006）联系群管、或提交工单手动提额；已上线计费的接口，请直接在控制台开通计费，调用量不受限制，按调用量阶梯计费，并保证10qps的并发**

## 服务说明

1、百度相同图/相似图/商品图检索API服务支持开发者基于自建图片库进行入库、检索、删除、更新操作。开发者在控制台创建应用后，需要在**控制台-应用详情页 申请建库**，建库成功后相关接口能力可正常调用。

2、申请建库时，图库的图片数量上限为50万，避免浪费资源；**如果容量不够用，可在控制台-应用详情页 申请扩容**，工作人员会在1-3个工作日内审批，每次扩容的申请上限也是50万，**可以反复申请扩容**，原则上图库总量无上限。 ![img](https://ai.bdstatic.com/file/C8E0EF4B4A804044A63D138DAE6F0211)

3、**图像搜索已上线图库管理功能，支持对图库里的图片进行可视化管理**，可小批量上传图片、预览大图、修改摘要和分类信息、删除图片、查询某张图是否在库里，入口在**控制台-应用详情页 管理图库**，注：大批量上传、修改、删除请调用API。 ![img](https://ai.bdstatic.com/file/40BBF19DD2894386A48F20C0577CE4E0)

## 接口能力

| 接口名称   | 接口能力简要描述                                             |
| :--------- | :----------------------------------------------------------- |
| 相同图检索 | 基于查询照片，返回自建图库中相同图片集合。                   |
| 相似图检索 | 基于查询照片，返回自建图库中的相似图片集合。                 |
| 商品检索   | 更适用于电商平台等场景下所使用的商品类型图片，基于查询商品类型照片，返回自建商品图库中的相同或相似图片集合。 |

## 请求格式

POST方式调用

**注意**：Content-Type为`application/x-www-form-urlencoded`，然后通过`urlencode`格式化请求体。

## 返回格式

JSON格式

## 请求限制

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。注意在请求时需去掉头部。

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求格式支持**：**PNG、JPG、JPEG、BMP、GIF**

| 接口名称   | 图片编码后大小限额                                         |
| :--------- | :--------------------------------------------------------- |
| 相同图检索 | base64编码后大小不超过4M，最短边至少15px，最长边最大4096px |
| 相似图检索 | base64编码后大小不超过4M，最短边至少15px，最长边最大4096px |
| 商品图检索 | base64编码后大小不超过4M，最短边至少15px，最长边最大4096px |

# 调用方式

调用AI服务相关的API接口有两种调用方式，两种不同的调用方式采用相同的接口URL。

区别在于**请求方式**和**鉴权方法**不一样，请求参数和返回结果一致。

## 调用方式一

**请求URL数据格式**

向API服务地址使用POST发送请求，必须在URL中带上参数：

**access_token**：必须参数，参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)”

> 注意：`access_token`的有效期为30天，需要每30天进行定期更换

POST中参数按照API接口说明调用即可

例如相同图检索—入库API，使用HTTPS POST发送：

```
https://aip.baidubce.com/rest/2.0/realtime_search/same_hq/add?access_token=24.f9ba9c5241b67688bb4adbed8bc91dec.2592000.1485570332.282335-8574074
```

**获取access_token示例代码**

bash

PHP

Java

Python

C++

C#

Node

```
#!/bin/bash
curl -i -k 'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=【百度云应用的AK】&client_secret=【百度云应用的SK】'
```

> **说明**：方式一鉴权使用的Access_token必须通过API Key和Secret Key获取。

## 调用方式二

**请求头域内容**

在请求的HTTP头域中包含以下信息：

- host（必填）
- x-bce-date （必填）
- x-bce-request-id（选填）
- authorization（必填）
- content-type（必填）
- content-length（选填）

作为示例，以下是一个标准的人脸识别的请求头域内容：

```
POST /rest/2.0/face/v1/detect HTTP/1.1
accept-encoding: gzip, deflate
x-bce-date: 2015-03-24T13:02:00Z
connection: keep-alive
accept: */*
host: aip.baidubce.com
x-bce-request-id: 73c4e74c-3101-4a00-bf44-fe246959c05e
content-type: application/x-www-form-urlencoded
authorization: bce-auth-v1/46bd9968a6194b4bbdf0341f2286ccce/2015-03-24T13:02:00Z/1800/host;x-bce-date/994014d96b0eb26578e039fa053a4f9003425da4bfedf33f4790882fb4c54903
```

> **说明**：方式二鉴权使用的[API认证机制](https://cloud.baidu.com/doc/Reference/AuthenticationMechanism.html)authorization必须通过百度云的[AK/SK](https://cloud.baidu.com/doc/Reference/GetAKSK.html)生成。

# 相同图检索

## 接口描述

该请求用于实时检索相同图片集合。即对于输入的一张图片（可正常解码，且长宽比适宜），返回自建图库中相同的图片集合。 相同图检索包含入库、检索、删除、更新4个子接口；**在正式使用之前请在控制台创建应用后，在应用详情页申请建库，建库成功后方可正常使用入库、检索、删除、更新接口**。

## 相同图检索—入库

### 请求说明

**该接口实现单张图片入库，入库时需要同步提交图片及可关联至本地图库的摘要信息（具体变量为brief，具体可传入图片在本地标记id、图片url、图片名称等）；同时可提交分类维度信息（具体变量为tags，最多可传入2个tag），方便对图库中的图片进行管理、分类检索。** **注：重复添加完全相同的图片会返回错误。**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。注意在请求时需去掉头部。

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/realtime_search/same_hq/add`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数  | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :---- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image | 否       | string | -                     | 图片base64编码，（**和url二选一，image优先级更高），注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px,支持jpg/png/bmp格式。重复添加会返回错误。 |
| url   | 否       | string | -                     | 图片URL，**和image二选一，image优先级更高**                  |
| brief | 是       | string | -                     | 检索时原样带回,最长256B。样例：{"name":"周杰伦", "id":"666"} 。**请注意，检索接口不返回原图，仅反馈当前填写的brief信息，所以调用该入库接口时，brief信息请尽量填写可关联至本地图库的图片id或者图片url、图片名称等信息** |
| tags  | 否       | string | 1 - 65535范围内的整数 | tag间以逗号分隔，最多2个tag。样例："100,11" ；**检索时可圈定分类维度进行检索** |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段      | 是否必选 | 类型   | 说明                       |
| :-------- | :------- | :----- | :------------------------- |
| log_id    | 是       | uint64 | 唯一的log id，用于问题定位 |
| cont_sign | 是       | string | 输入图片签名，可用于删除   |

**返回示例**

```
{
    "log_id": 2263663554,
    "cont_sign": "4261577168,501945506"
}
```

## 相同图检索—检索

完成入库后，可使用该接口实现相同图检索。**支持传入指定分类维度（具体变量tags）进行检索，返回结果支持翻页（具体变量pn、rn）。** **注意： 1、检索接口不返回原图，仅反馈当前填写的brief信息，请调用入库接口时尽量填写可关联至本地图库的图片id或者图片url等信息。**

**2、检索接口默认返回TOP 300的结果，如果图库里不满300张图片，会返回所有图片，请入库足量图片以便充分测试效果**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/realtime_search/same_hq/search`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :-------- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image     | 否       | string | -                     | 图像base64编码，**和url二选一，image优先级更高，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px,支持jpg/png/bmp格式 |
| url       | 否       | string | -                     | 图片URL，**和image二选一，image优先级更高**                  |
| tags      | 否       | string | 1 - 65535范围内的整数 | 分类维度信息，tag间以逗号分隔，最多可传入2个tag，示例："100,11" |
| tag_logic | 否       | string | 0,1                   | 检索时tag之间的逻辑， 0：逻辑and，1：逻辑or                  |
| pn        | 否       | string | 1 - 1000范围内的整数  | 分页功能，起始位置，例：0。**未指定分页时，默认返回前300个结果；接口返回数量最大限制1000条，例如：起始位置为900，截取条数500条，接口也只返回第900 - 1000条的结果，共计100条** |
| rn        | 否       | string | 1 - 1000范围内的整数  | 分页功能，截取条数，例：250                                  |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段       | 是否必选 | 类型     | 说明                                                         |
| :--------- | :------- | :------- | :----------------------------------------------------------- |
| log_id     | 是       | uint64   | 唯一的log id，用于问题定位                                   |
| result_num | 是       | uint32   | 检索结果数                                                   |
| result     | 是       | object[] | 结果数组                                                     |
| +cont_sign | 是       | string   | 图片签名，可以用来删除图片或定位问题                         |
| +score     | 是       | float    | 图片相关性，0-1                                              |
| +brief     | 是       | string   | 调用add接口添加的brief信息，为保证该结果有效性，请入库是填写有效可关联至本地图片库的有效id信息 |
| has_more   | 是       | bool     | 是否还有下一页，返回值：true、false；如果不分页，不用关注该字段 |

**返回示例**

```
{
    "result_num": 1,
    "result": [
        {
            "score": 0.97976700290421,
            "brief": "./data/jay1.jpg",
            "cont_sign": "475124309,1080176642"
        }
    ],
	"has_more": "false",
    "log_id": 1968648150
}
```

## 相同图检索—删除

### 请求说明

**删除图库中的图片，支持批量删除，批量删除时请传cont_sign参数，勿传image、url，最多支持1000个cont_sign**

**图片删除延时生效，每天数据库定时更新进行物理删除，刚删除时仍然可以在图库中检索到，请过一段时间再验证，一般最多延时4小时左右**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/realtime_search/same_hq/delete`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围 | 说明                                                         |
| :-------- | :------- | :----- | :--------- | :----------------------------------------------------------- |
| image     | 否       | string | -          | base64编码后的图片数据（和url、cont_sign三选一，**优先级：image > url > cont_sign**），**注意要去掉图片头部**，如`（data:image/jpg;base64,）`。要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式 |
| url       | 否       | string | -          | 图片URL，**和image、cont_sign三选一，image优先级更高**       |
| cont_sign | 否       | string | -          | 图片签名（和image、url三选一），**支持批量删除，批量删除时请勿传image、url，最多支持1000个cont_sign列表，**样例："932301884,1068006219;316336521,553141152;2491030726,1352091083" |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
  "log_id": 50488417
}
```

## 相同图检索—更新

### 请求说明

**更新图库中图片的摘要和分类信息（具体变量为brief、tags）**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/realtime_search/same_hq/update`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :-------- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image     | 否       | string | -                     | 图像base64编码，**和url、cont_sign三选一，优先级：image > url > cont_sign，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式；重复添加会返回错误。 |
| url       | 否       | string | -                     | 图片URL，**和image、cont_sign三选一，优先级：image > url > cont_sign** |
| cont_sign | 否       | string | -                     | 图片签名，**和image、url三选一，优先级：image > url > cont_sign；不支持批量传入签名**，样例："932301884,10680062193" |
| brief     | 否       | string | -                     | 更新的摘要信息，最长256B。样例：{"name":"周杰伦", "id":"666"} |
| tags      | 否       | string | 1 - 65535范围内的整数 | 更新的分类信息，tag间以逗号分隔，最多2个tag。样例："100,11"  |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
    "log_id": 2263663554
}
```

# 相似图检索

## 接口描述

1、该请求用于实时检索相似图片集合。即对于输入的一张图片（可正常解码，且长宽比适宜），返回自建图库中相似的图片集合。 2、相似图检索包含入库、检索、删除、更新4个子接口；**在正式使用之前请在控制台创建应用后，在应用详情页申请建库，建库成功后方可正常使用入库、检索、删除、更新接口。**

## 相似图检索—入库

### 请求说明

**该接口实现单张图片入库，入库时需要同步提交图片及可关联至本地图库的摘要信息（具体变量为brief，具体可传入图片在本地标记id、图片url、图片名称等）；同时可提交分类维度信息（具体变量为tags，最多可传入2个tag），方便对图库中的图片进行管理、分类检索。** **注：重复添加完全相同的图片会返回错误。**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/similar/add`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数  | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :---- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image | 否       | string | -                     | 图像数据，base64编码，**和url二选一，image优先级更高，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式。重复添加会返回错误 |
| url   | 否       | string | -                     | 图片URL，**和image二选一，image优先级更高**                  |
| brief | 否       | string | -                     | 检索时原样带回,最长256B。样例{"name":"周杰伦", "id":"666"} **请注意，检索接口不返回原图，仅反馈当前填写的brief信息，所以调用该入库接口时，brief信息请尽量填写可关联至本地图库的图片id或者图片url、图片名称等信息** |
| tags  | 否       | string | 1 - 65535范围内的整数 | tag间以逗号分隔，最多2个tag。样例："100,11" ；**检索时可圈定分类维度进行检索** |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段      | 是否必选 | 类型   | 说明                       |
| :-------- | :------- | :----- | :------------------------- |
| log_id    | 是       | uint64 | 唯一的log id，用于问题定位 |
| cont_sign | 是       | string | 输入图片签名，可用于删除   |

**返回示例**

```
{
    "log_id": 2263663554,
    "cont_sign": "4261577168,501945506"
}
```

## 相似图检索—检索

完成入库后，可使用该接口实现相似图检索。**支持传入指定分类维度（具体变量tags）进行检索，返回结果支持翻页（具体变量pn、rn）。** **注意： 1、检索接口不返回原图，仅反馈当前填写的brief信息，请调用入库接口时尽量填写可关联至本地图库的图片id或者图片url等信息。**

**2、检索接口默认返回TOP 300的结果，如果图库里不满300张图片，会返回所有图片，请入库足量图片以便充分测试效果**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/similar/search`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :-------- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image     | 否       | string | -                     | 图像数据，base64编码，**和url二选一，image优先级更高，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px,支持jpg/png/bmp格式. |
| url       | 否       | string | -                     | 图片URL，**和image二选一，image优先级更高**                  |
| tags      | 否       | string | 1 - 65535范围内的整数 | 分类维度信息，tag间以逗号分隔，最多可传入2个tag，示例："100,11" |
| tag_logic | 否       | string | 0,1                   | 检索时tag之间的逻辑， 0：逻辑and，1：逻辑or                  |
| pn        | 否       | string | 1 - 1000范围内的整数  | 分页功能，起始位置，例：0。**未指定分页时，默认返回前300个结果；接口返回数量最大限制1000条，例如：起始位置为900，截取条数500条，接口也只返回第900 - 1000条的结果，共计100条** |
| rn        | 否       | string | 1 - 1000范围内的整数  | 分页功能，截取条数，例：250                                  |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段       | 是否必选 | 类型     | 说明                                                         |
| :--------- | :------- | :------- | :----------------------------------------------------------- |
| log_id     | 是       | uint64   | 唯一的log id，用于问题定位                                   |
| result_num | 是       | uint32   | 检索结果数                                                   |
| result     | 是       | object[] | 结果数组                                                     |
| +cont_sign | 是       | string   | 图片签名，可以用来删除图片或定位问题                         |
| +score     | 是       | float    | 图片相关性，0-1                                              |
| +brief     | 是       | string   | add是添加的brief信息                                         |
| has_more   | 是       | bool     | 是否还有下一页，返回值：true、false；如果不分页，不用关注该字段 |

**返回示例**

```
{
    "result_num": 1,
    "result": [
        {
            "score": 0.97976700290421,
            "brief": "./data/jay1.jpg",
            "cont_sign": "475124309,1080176642"
        }
    ],
	"has_more": "false",
    "log_id": 1968648150
}
```

## 相似图检索—删除

### 请求说明

**删除图库中的图片，支持批量删除，批量删除时请传cont_sign参数，勿传image，最多支持1000个cont_sign**

**图片删除延时生效，每天数据库定时更新进行物理删除，刚删除时仍然可以在图库中检索到，请过一段时间再验证，一般最多延时4小时左右**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/similar/delete`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围 | 说明                                                         |
| :-------- | :------- | :----- | :--------- | :----------------------------------------------------------- |
| image     | 否       | string | -          | base64编码后的图片数据（和url、cont_sign三选一，**优先级：image > url > cont_sign**），**注意要去掉图片头部**，如`（data:image/jpg;base64,）`。要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式 |
| url       | 否       | string | -          | 图片URL，**和image、cont_sign三选一，image优先级更高**       |
| cont_sign | 否       | string | -          | 图片签名（和image、url三选一），**支持批量删除，批量删除时请勿传image、url，最多支持1000个cont_sign列表，**样例："932301884,1068006219;316336521,553141152;2491030726,1352091083" |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
  "log_id": 50488417
}
```

## 相似图检索—更新

### 请求说明

**更新图库中图片的摘要和分类信息（具体变量为brief、tags）**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/similar/update`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围            | 说明                                                         |
| :-------- | :------- | :----- | :-------------------- | :----------------------------------------------------------- |
| image     | 否       | string | -                     | 图像base64编码，**和url、cont_sign三选一，优先级：image > url > cont_sign，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式；重复添加会返回错误。 |
| url       | 否       | string | -                     | 图片URL，**和image、cont_sign三选一，优先级：image > url > cont_sign** |
| cont_sign | 否       | string | -                     | 图片签名，**和image、url三选一，优先级：image > url > cont_sign；不支持批量传入签名**，样例："932301884,10680062193" |
| brief     | 否       | string | -                     | 更新的摘要信息，最长256B。样例：{"name":"周杰伦", "id":"666"} |
| tags      | 否       | string | 1 - 65535范围内的整数 | 更新的分类信息，tag间以逗号分隔，最多2个tag。样例："100,11"  |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
    "log_id": 2263663554
}
```

# 商品检索

## 接口描述

1、该请求用于实时检索商品类型图片相同或相似的图片集合，适用于电商平台或商品展示等场景，即对于输入的一张图片（可正常解码，且长宽比适宜），返回自建商品库中相同或相似的图片集合。 2、商品检索包含入库、检索、删除、更新4个子接口；**在正式使用之前请在控制台创建应用后，在应用详情页申请建库，建库成功后方可正常使用入库、检索、删除、更新接口**。

## 商品检索—入库

### 请求说明

**该接口实现单张图片入库，入库时需要同步提交图片及可关联至本地图库的摘要信息（具体变量为brief，具体可传入图片在本地标记id、图片url、图片名称等）。同时可提交分类维度信息（具体变量为class_id1、class_id2），方便对图库中的图片进行管理、分类检索。** **注：重复添加完全相同的图片会返回错误。**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/product/add`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围          | 说明                                                         |
| :-------- | :------- | :----- | :------------------ | :----------------------------------------------------------- |
| image     | 否       | string | -                   | 图像数据，base64编码，**和url二选一，image优先级更高，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px,支持jpg/png/bmp格式.重复添加会返回错误。 |
| url       | 否       | string | -                   | 图片URL，**和image二选一，image优先级更高**                  |
| brief     | 否       | string | -                   | 检索时原样带回,最长256B。样例{"name":"周杰伦", "id":"666"} **请注意，检索接口不返回原图，仅反馈当前填写的brief信息，所以调用该入库接口时，brief信息请尽量填写可关联至本地图库的图片id或者图片url、图片名称等信息** |
| class_id1 | 否       | int32  | 1-65535范围内的整数 | 商品分类维度1，检索时可圈定该分类维度进行检索；**只传入class_id1，则检索结果中包含class_id1内容的都会被检索到；同时传入class_id1与class_id2，则检索结果中同时包含class_id1和class_id2内容的才会被检索到** |
| class_id2 | 否       | int32  | 1-65535范围内的整数 | 商品分类维度2，检索时可圈定该分类维度进行检索                |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段      | 是否必选 | 类型   | 说明                       |
| :-------- | :------- | :----- | :------------------------- |
| log_id    | 是       | uint64 | 唯一的log id，用于问题定位 |
| cont_sign | 是       | string | 输入图片签名，可用于删除   |

**返回示例**

```
{
    "log_id": 2263663554,
    "cont_sign": "4261577168,501945506"
}
```

## 商品检索—检索

完成入库后，可使用该接口实现商品检索。**支持传入指定分类维度（具体变量class_id1、class_id2）进行检索，返回结果支持翻页（具体变量pn、rn）。** **注意： 1、检索接口不返回原图，仅反馈入库时填写的brief信息，请调用入库接口时尽量填写可关联至本地图库的图片id或者图片url等信息。**

**2、检索接口默认返回TOP 300的结果，如果图库里不满300张图片，会返回所有图片，请入库足量图片以便充分测试效果**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/product/search`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token，参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围           | 说明                                                         |
| :-------- | :------- | :----- | :------------------- | :----------------------------------------------------------- |
| image     | 否       | string | -                    | 图像数据，base64编码，**和url二选一，image优先级更高，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式。 |
| url       | 否       | string | -                    | 图片URL，**和image二选一，image优先级更高**                  |
| class_id1 | 否       | int32  | -                    | 商品分类维度1，支持1-65535范围内的整数。                     |
| class_id2 | 否       | int32  | -                    | 商品分类维度2，支持1-65535范围内的整数。                     |
| tag_logic | 否       | string | 0,1                  | 检索时tag之间的逻辑， 0：逻辑and，1：逻辑or                  |
| pn        | 否       | string | 1 - 1000范围内的整数 | 分页功能，起始位置，例：0。**未指定分页时，默认返回前300个结果；接口返回数量最大限制1000条，例如：起始位置为900，截取条数500条，接口也只返回第900 - 1000条的结果，共计100条** |
| rn        | 否       | string | 1 - 1000范围内的整数 | 分页功能，截取条数，例：250                                  |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段       | 是否必选 | 类型                 | 说明                                                         |
| :--------- | :------- | :------------------- | :----------------------------------------------------------- |
| log_id     | 是       | uint64               | 唯一的log id，用于问题定位                                   |
| result_num | 是       | uint32               | 检索结果数                                                   |
| result     | 是       | realtime-search-item | 结果数组                                                     |
| +cont_sign | 是       | string               | 图片签名，可以用来删除图片或定位问题                         |
| +score     | 是       | float                | 图片相关性，0-1                                              |
| +brief     | 是       | string               | add是添加的brief信息                                         |
| has_more   | 是       | bool                 | 是否还有下一页，返回值：true、false；如果不分页，不用关注该字段 |

**返回示例**

```
{
    "result_num": 1,
    "result": [
        {
            "score": 0.97976700290421,
            "brief": "./data/jay1.jpg",
            "cont_sign": "475124309,1080176642"
        }
    ],
	"has_more" : "false",
    "log_id": 1968648150
}
```

## 商品检索—删除

### 请求说明

**删除图库中的图片，支持批量删除，批量删除时请传cont_sign参数，勿传image，最多支持1000个cont_sign**

**图片删除延时生效，每天数据库定时更新进行物理删除，刚删除时仍然可以在图库中检索到，请过一段时间再验证，一般最多延时4小时左右**。

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/product/delete`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token，参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围 | 说明                                                         |
| :-------- | :------- | :----- | :--------- | :----------------------------------------------------------- |
| image     | 否       | string | -          | base64编码后的图片数据（和url、cont_sign三选一，**优先级：image > url > cont_sign**），**注意要去掉图片头部**，如`（data:image/jpg;base64,）`。要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式 |
| url       | 否       | string | -          | 图片URL，**和image、cont_sign三选一，image优先级更高**       |
| cont_sign | 否       | string | -          | 图片签名（和image、url三选一，优先级最低），**支持批量删除，批量删除时请勿传image、url，最多支持1000个cont_sign列表，**样例："932301884,1068006219;316336521,553141152;2491030726,1352091083" |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
  "log_id": 50488417
}
```

## 商品检索—更新

### 请求说明

**更新图库中图片的摘要和分类信息（具体变量为brief、class_id1/class_id2）**

请求图片需经过`base64编码`：图片的base64编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后用Base64格式编码即可。**注意在请求时需去掉头部。**

**注意**：图片的base64编码是不包含图片头的，如`（data:image/jpg;base64,）`

**请求示例**

HTTP 方法：`POST`

请求URL： `https://aip.baidubce.com/rest/2.0/image-classify/v1/realtime_search/product/update`

URL参数：

| 参数         | 值                                                           |
| :----------- | :----------------------------------------------------------- |
| access_token | 通过API Key和Secret Key获取的access_token,参考“[Access Token获取](http://ai.baidu.com/docs#/Auth)” |

Header如下：

| 参数         | 值                                |
| :----------- | :-------------------------------- |
| Content-Type | application/x-www-form-urlencoded |

Body中放置请求参数，参数详情如下：

**请求参数**

| 参数      | 是否必选 | 类型   | 可选值范围 | 说明                                                         |
| :-------- | :------- | :----- | :--------- | :----------------------------------------------------------- |
| image     | 否       | string | -          | 图像base64编码，**和url、cont_sign三选一，优先级：image > url > cont_sign，注意要去掉图片头部**，如`（data:image/jpg;base64,）`，要求base64编码后大小不超过4M，最短边至少15px，最长边最大4096px，支持jpg/png/bmp格式；重复添加会返回错误。 |
| url       | 否       | string | -          | 图片URL，**和image、cont_sign三选一，优先级：image > url > cont_sign** |
| cont_sign | 否       | string | -          | 图片签名，**和image、url三选一，优先级：image > url > cont_sign；不支持批量传入签名**，样例："932301884,10680062193" |
| brief     | 否       | string | -          | 更新的摘要信息，最长256B。样例：{"name":"周杰伦", "id":"666"} |
| class_id1 | 否       | int32  | -          | 更新的商品分类1，支持1-65535范围内的整数。                   |
| class_id2 | 否       | int32  | -          | 更新的商品分类2，支持1-65535范围内的整数。                   |

**请求代码示例**

**提示一**：使用示例代码前，请记得替换其中的示例Token、图片地址或Base64信息。

**提示二**：部分语言依赖的类或库，请在代码注释中查看下载地址。

待补充

### 返回说明

**返回参数**

| 字段   | 是否必选 | 类型   | 说明                       |
| :----- | :------- | :----- | :------------------------- |
| log_id | 是       | uint64 | 唯一的log id，用于问题定位 |

**返回示例**

```
{
    "log_id": 2263663554
}
```

# 错误码

若请求错误，服务器将返回的JSON文本包含以下参数：

- **error_code**：错误码。
- **error_msg**：错误描述信息，帮助理解和解决发生的错误。

例如Access Token失效返回：

```
{
  "error_code": 110,
  "error_msg": "Access token invalid or no longer valid"
}
```

需要重新获取新的Access Token再次请求即可。

| 错误码 | 错误信息                                | 描述                                                         |
| :----- | :-------------------------------------- | :----------------------------------------------------------- |
| 1      | Unknown error                           | 服务器内部错误，请再次请求， 如果持续出现此类错误，请通过QQ群（630770006）或工单联系技术支持团队。 |
| 2      | Service temporarily unavailable         | 服务暂不可用，请再次请求， 如果持续出现此类错误，请通过QQ群（630770006）或工单联系技术支持团队。 |
| 3      | Unsupported openapi method              | 调用的API不存在，请检查后重新尝试                            |
| 4      | Open api request limit reached          | 集群超限额                                                   |
| 6      | No permission to access data            | 无权限访问该用户数据                                         |
| 13     | Get service token failed                | 获取token失败                                                |
| 14     | IAM Certification failed                | IAM 鉴权失败                                                 |
| 15     | app not exsits or create failed         | 应用不存在或者创建失败                                       |
| 17     | Open api daily request limit reached    | 每天请求量超限额；未上线计费的接口，可通过QQ群（630770006）联系群管、或[提交工单](http://ticket.bce.baidu.com/#/ticket/create)手动提额；已上线计费的接口，可直接在控制台开通计费，调用量不受限制，按调用量阶梯计费，并保证10qps的并发 |
| 18     | Open api qps request limit reached      | QPS超限额；未上线计费的接口，可通过QQ群（630770006）联系群管、或[提交工单](http://ticket.bce.baidu.com/#/ticket/create)手动提额；已上线计费的接口，可直接在控制台开通计费，调用量不受限制，按调用量阶梯计费，并保证10qps的并发 |
| 19     | Open api total request limit reached    | 请求总量超限额，请通过QQ群（630770006）联系群管手动提额      |
| 100    | Invalid parameter                       | 无效的access_token参数，请检查后重新尝试                     |
| 110    | Access token invalid or no longer valid | access_token无效                                             |
| 111    | Access token expired                    | access token过期                                             |
| 282000 | internal error                          | 服务器内部错误，请再次请求， 如果持续出现此类错误，请通过QQ群（630770006）或工单联系技术支持团队。 |
| 216017 | not initialized                         | 未建库，请先前往控制台申请建库                               |
| 216100 | invalid param                           | 请求中包含非法参数，请检查后重新尝试                         |
| 216101 | not enough param                        | 缺少必须的参数，请检查参数是否有遗漏                         |
| 216102 | service not support                     | 请求了不支持的服务，请检查调用的url                          |
| 216103 | param too long                          | 请求中某些参数过长，请检查后重新尝试                         |
| 216110 | appid not exist                         | appid不存在，请重新核对信息是否为后台应用列表中的appid       |
| 216200 | empty image                             | 图片为空，请检查后重新尝试                                   |
| 216201 | image format error                      | 上传的图片格式错误，现阶段我们支持的图片格式为：PNG、JPG、JPEG、BMP，请进行转码或更换图片 |
| 216202 | image size error                        | 上传的图片大小错误，现阶段我们支持的图片大小为：base64编码后小于4M，分辨率不高于4096*4096，请重新上传图片 |
| 216203 | image size error                        | 上传图片错误，通常情况下为图片base64编码错误，请重新上传图片 |
| 216630 | recognize error                         | 识别错误，请再次请求，如果持续出现此类错误，请通过QQ群（630770006）或工单联系技术支持团队。 |
| 216631 | recognize bank card error               | 识别银行卡错误，出现此问题的原因一般为：您上传的图片非银行卡正面，上传了异形卡的图片或上传的银行卡正品图片不完整 |
| 216633 | recognize idcard error                  | 识别身份证错误，出现此问题的原因一般为：您上传了非身份证图片或您上传的身份证图片不完整 |
| 216680 | item not exist                          | item不在库里                                                 |
| 216681 | item exist                              | item已经在库里，不能重复入库                                 |
| 216634 | detect error                            | 检测错误，请再次请求，如果持续出现此类错误，请通过QQ群（630770006）或工单联系技术支持团队。 |
| 282003 | missing parameters: {参数名}            | 请求参数缺失                                                 |
| 282005 | batch  processing error                 | 处理批量任务时发生部分或全部错误，请根据具体错误码排查       |
| 282006 | batch task  limit reached               | 批量任务处理数量超出限制，请将任务数量减少到10或10以下       |
| 282112 | url download timeout                    | url下载超时，请检查url对应的图床/图片无法下载或链路状况不好，您可以重新尝试一下，如果多次尝试后仍不行，建议更换图片地址 |
| 282113 | url response invalid                    | URL返回无效参数，一般是图片URL抓图失败，由于图床的差异性，抓图服务无法适配所有的图床，部分URL可能抓不到图，请将图片下载到本地转码后上传 |
| 282114 | url size error                          | 图片URL长度超过1024字节或为0                                 |
| 282808 | request id: xxxxx not exist             | request id xxxxx 不存在                                      |
| 282809 | result type error                       | 返回结果请求错误（不属于excel或json）                        |
| 282810 | image recognize error                   | 图像识别错误                                                 |
| 283300 | image recognize error                   | 数据格式有误，可以检查base64编码、代码格式等                 |