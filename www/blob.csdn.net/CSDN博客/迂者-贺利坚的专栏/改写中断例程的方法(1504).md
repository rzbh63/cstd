
# 改写中断例程的方法(1504) - 迂者-贺利坚的专栏 - CSDN博客

2017年05月17日 05:27:17[迂者-贺利坚](https://me.csdn.net/sxhelijian)阅读数：664标签：[汇编语言																](https://so.csdn.net/so/search/s.do?q=汇编语言&t=blog)个人分类：[汇编语言																](https://blog.csdn.net/sxhelijian/article/category/6698546)



本文为《汇编语言程序设计》1504小节例程。点击[链接…](http://blog.csdn.net/sxhelijian/article/details/56671827)进课程主页。
任务：安装一个新的int 9中断例程
功能：在DOS下，按F1键后改变当前屏幕的显示颜色，其他的键照常处理。
程序：
```python
assume cs:code
stack segment
     db
```
```python
128
```
```python
dup (
```
```python
0
```
```python
)
stack ends
code segment
```
```python
start:
```
```python
; 设置各段地址
```
```python
mov
```
```python
ax,stack
```
```python
; 栈段
```
```python
mov
```
```python
ss,ax
```
```python
mov
```
```python
sp,
```
```python
128
```
```python
push
```
```python
cs
```
```python
; ds与cs相同
```
```python
pop
```
```python
ds
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
; 附加段
```
```python
mov
```
```python
es,ax
```
```python
; 安装新程序
```
```python
mov
```
```python
si,offset int9
```
```python
mov
```
```python
di,
```
```python
204
```
```python
h
```
```python
mov
```
```python
cx,offset int9end - offset int9
     cld
     rep movsb
```
```python
; 将原中断地址保存在0:200单元处
```
```python
push
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
]
```
```python
pop
```
```python
es:[
```
```python
200
```
```python
h]
```
```python
push
```
```python
es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
+
```
```python
2
```
```python
]
```
```python
pop
```
```python
es:[
```
```python
202
```
```python
h]
```
```python
; 改变后中断的入口地址
```
```python
cli
```
```python
mov
```
```python
word ptr es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
],
```
```python
204
```
```python
h
```
```python
mov
```
```python
word ptr es:[
```
```python
9
```
```python
*
```
```python
4
```
```python
+
```
```python
2
```
```python
],
```
```python
0
```
```python
sti
```
```python
mov
```
```python
ax,
```
```python
4
```
```python
c00h
     int
```
```python
21
```
```python
h
```
```python
;定义新中断例程
```
```python
int9:
```
```python
push
```
```python
ax
```
```python
push
```
```python
bx
```
```python
push
```
```python
cx
```
```python
push
```
```python
es
```
```python
in
```
```python
al,
```
```python
60
```
```python
h
     pushf
```
```python
; 调用旧中断例程
```
```python
call
```
```python
dword ptr cs:[
```
```python
200
```
```python
h]
```
```python
; 处理F1键
```
```python
cmp al,
```
```python
3
```
```python
bh
     jne int9ret
```
```python
mov
```
```python
ax,
```
```python
0
```
```python
b800h
```
```python
mov
```
```python
es,ax
```
```python
mov
```
```python
bx,
```
```python
1
```
```python
mov
```
```python
cx,
```
```python
2000
```
```python
s:
```
```python
inc
```
```python
byte ptr es:[bx]
```
```python
add
```
```python
bx,
```
```python
2
```
```python
loop s
```
```python
int9ret:
```
```python
pop
```
```python
es
```
```python
pop
```
```python
cx
```
```python
pop
```
```python
bx
```
```python
pop
```
```python
ax
     iret
```
```python
int9end:
```
```python
nop
```
```python
code ends
end start
```

