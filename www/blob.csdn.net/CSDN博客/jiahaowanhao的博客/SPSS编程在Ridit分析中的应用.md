
# SPSS编程在Ridit分析中的应用 - jiahaowanhao的博客 - CSDN博客


2018年03月04日 20:49:01[数据分析技术](https://me.csdn.net/jiahaowanhao)阅读数：198标签：[SPSS																](https://so.csdn.net/so/search/s.do?q=SPSS&t=blog)


[SPSS编程在Ridit分析中的应用](http://cda.pinggu.org/view/24901.html)
多样本有序分类资料（或等级资料）我们一般采用非参数检验——H检验（Kruskal-Wallis法），但其结论只得出三组或多组间总的有差别，若要知道两两间是否有差别，则没有Ridit分析只要一次就能得出两两比较结果那么方便。Ridit分析是一种关于等级资料进行对比组与标准组比较的假设检验方法，其基本思想是先确定一个标准组（常用以往积累资料或样本含量相当大的资料）作为特定总体，求得各等级的R值，标准组平均R值理论上可以证明等于0.5，其它各组与标准组比较，看其可信区间是否与0.5重叠，来判断组间的统计学显著性[1]，最后得出专业解释。而Ridit分析在SPSS中却没有现成的模块，但我们可以通过编程可以方便的实现之，兹介绍下：
1．  建立或调用SPSS数据文件
某医生用三种方剂治疗某妇科病，疗效如表1，问三种方剂的疗效有无差别[2]。首先建立表1的1~4列数据文件，EFFECT：疗效（1：无效，2：好转，3：显效，4：控制）；A：糖衣片频数；B：黄酮片频数；C：复方组频数。
表1 三种方剂疗效比较的SPSS数据文件（第1~4  列）及编辑后运行的各等级Ridit值计算表
疗效 糖衣片 黄酮片
A EFFECT B
② ① ③
1 48 5
2 184 16
3 77 18
4 52 19
2．SPSS程序的编制和运行
（1）在数据编辑窗口（Data Editor），通过通过菜单选择：File→New→Syntax，打开语句编辑窗口（Syntax Editor）；若已经建立程序，可通过Open→Syntax直接打开。
（2）在语句编辑窗口，用键盘输入表2的程序。
表2 Ridit分析的SPSS程序（不要输入行号）
行号  程序  行号  程序
1  CREATE L=CSUM(A).  17  T-TEST
2  COMPUTE L1=LAG(L,1).  18   /TESTVAL=0
3  IF (effect=1) L1=0.  19   /VARIABLES=R
4  COMPUTE D=A/2.  20   /CRITERIA=CIN (.95) .
5  COMPUTE T=L1+D.  21  WEIGHT BY B .
6  IF (EFFECT=4) S=L.  22  T-TEST
7  SORT CASES BY EFFECT(D).  23   /TESTVAL=0
8  LOOP IF (EFFECT<4).  24   /VARIABLES=R_B
9  COMPUTE S1=LAG(S,1).  25   /CRITERIA=CIN (.95) .
10  COMPUTE S=S1.  26  WEIGHT BY C .
11  END LOOP IF (EFFECT=1).  27  T-TEST
12  COMPUTE R=T/S.  28   /TESTVAL=0
13  SORT CASES BY EFFECT(A).  29   /VARIABLES=R_C
14  COMPUTE R_B=R.  30   /CRITERIA=CIN (.95) .
15  COMPUTE R_C=R.  31  EXECUTE.
16  WEIGHT BY A .
以上程序在语句编辑窗口输入时，不要输入行号，程序中的英文字母不分大、小写。另外该程序也可在Word、记事本等其他文本编辑软件中编辑，然后只要通过复制将程序粘贴到Syntax Editor窗口。
（3）在语句编辑窗口，通过菜单选择：Run→All运行程序。
3．结果解释
以上程序是以糖衣片（A）组作为标准组计算R值，L：累积频数（为求L1的中间变量）；L1：累积频数下移一行；D：标准组各等级之半；T：为L1栏加上D栏的值；S：标准组的总例数；S1（为求S的中间变量）；R：标准组的R值。程序运行后，还可在Output窗口中查看到A、B、C三组的平均R值及95%的可信区间：糖衣片的平均R值为0.5，与理论相符，说明计算正确；黄酮片：平均R值为0.6493，95%CI（0.5758，0.7228）；复方片：平均R值为0.5045，95%CI（0.4371，0.5718）。根据可信区间是否与标准组（理论上为0.5）相交来决定各对比组间的显著性水平，如图1，糖衣片的R值对应于0.5，复方片95%的可信区间与糖衣片平均R值（理论上为0.5）重叠，所以P>0.05，故复方片与糖衣片之间的疗效无统计学显著性，尚不能认为两者疗效间有统计学差异；而黄酮片可信区间与理论R值0.5不重叠，则P<0.05，故黄酮片与糖衣片之间的疗效存在统计学显著性；同理可知，黄酮片与复方片的可信区间也不重叠，故两者疗效存在统计学差异。
图2 标准组平均R值、对比组平均R值及95%可信区间
4．程序解释
第1~3行：计算标准组累计频数（移下一行）。CSUM（Cumulative sum）为计算标准组的累加和L，LAG（variable,ncases）为数值型函数或字符型函数[2]，返回数据集中某一变量（variable）的ncases之前的观测值所属变量的值，对第1个观察值来说，将返回缺失值（数值型变量）或空格（字符型变量）[3]。本例实际上是将变量L的值下移一行。
第4行：计算D标准组各频数之半。
第5行：计算T，即标准组各频数之半与累计频数（移下一行）之和。
第6~11行：计算标准组总例数S，其中S1是为了计算S而设定的中间变量，LOOP和END LOOP为循环语句，必结合使用，可同时控制变量转换的次数和条件，本例中的第一次循环，对EFFECT<4的个例进行变量转换；第二次循环时，对EFFECT<3的个体进行变量变换，直至EFFECT=1，循环结束。
第12~15行：产生标准组及A组（变量A_R）和B组（变量B_R）的R值，这三组的R值是一样，其中A组与B组的R值是为了计算A、B两组的可信区间作准备。
第16~31行：分组计算糖衣片A（标准组）、黄酮片B及复方组C的95%的可信区间，可在Output窗口中查看。第16、21、26行分别对A、B、C各组的频数进行加权（Weight），第17~20行是调用T-Test程序计算标准组的平均R值。第22~25行和第27~30行为分别计算黄酮片（B组）及复方组（C组）的平均R值及95%的可信区间。
5．组内不能确定标准组时SPSS的处理方法
若标准组数量很大时，可看作总体（如上例把糖衣片看成标准组），不必计算抽样误差，将对比组作为样本进行检验。但有时相互比较的各组样本中往往并无例数很多的组别，如仍将其中一组作为标准组依照上例方法处理是不适当，这时可将各组的等级合并，以其合计数作为各等级的标准分布，计算各等级的Ridit值。在以上程序中只要利用COMPUTE命令产生一个新的变量来表示各组的等级合并，如在第1行插入：COMPUTE Tf（合计频数）=A+B+C；再将上面的程序作适当的修改，即可算出各组的平均R值。然后用u检验公式（两组时用）或χ2检验公式（多组时用）进行假设检验[2]，u值或χ2值计算可以在Transform→Compute菜单中利用软件提供的各种函数和表达式来实现，同时也可利用其中的统计函数u值累积分布函数（CDF.NORM（u，0，1））或χ2累积分布函数（CDF.CHISQ（χ2，df））直接返回相应的P值，具体过程不多加详述。

